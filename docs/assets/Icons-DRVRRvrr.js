import{E as p,I as L,O as T,R as _,_ as N,c as H,d as J,f as m,h as K,l as t,lt as u,m as Q,o as W,u as X,w as Y}from"./codemirror-B25QCqWr.js";import{f as M}from"./vendor-vue-fZ-TTK_Z.js";import{n as Z,t as ee}from"./index-R3-RO9Tt.js";var te={class:"p-6 space-y-6 bg-gray-900 text-gray-100 min-h-full"},re={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},ae={class:"relative"},oe={class:"relative bg-gray-800/50 backdrop-blur-sm border border-blue-500/20 rounded-lg p-4"},se={class:"flex items-center space-x-3"},le={class:"relative group"},ne={class:"relative bg-gray-800/50 backdrop-blur-sm border border-emerald-500/20 rounded-lg p-4 hover:border-emerald-400/40 transition-all duration-300"},ie={class:"block cursor-pointer"},de={class:"relative"},ue={class:"relative bg-gray-800/50 backdrop-blur-sm border border-purple-500/20 rounded-lg overflow-hidden"},ce={class:"p-4 border-b border-gray-700/50"},ve={class:"font-bold text-lg bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent flex items-center"},ge={key:0,class:"p-8 text-center"},pe={class:"text-gray-500 text-lg font-medium mb-2"},be={class:"text-gray-600 text-sm"},me={key:1,class:"max-h-96 overflow-y-auto custom-scrollbar"},fe={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4"},xe={class:"aspect-square bg-gray-800/50 rounded-lg mb-3 flex items-center justify-center overflow-hidden"},he=["src","alt"],ye={class:"space-y-1"},_e=["title"],we={class:"text-xs text-gray-500 space-y-0.5"},ke={class:"flex space-x-1 mt-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200"},je=["onClick"],Ie=["onClick"],Be={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"},Le={class:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4 border border-gray-600"},Me={class:"space-y-4"},Ce={class:"text-sm text-gray-500"},C="lowcode-icons",c="icons",Ne=N({__name:"IconLibraryManager",props:{projectId:{}},emits:["library:update"],setup(w,{emit:k}){const f=w;let v=null;function x(){return new Promise((r,e)=>{const o=indexedDB.open(C);o.onsuccess=()=>{const a=o.result;if(a.objectStoreNames.contains(c))r(a);else{const s=a.version+1;a.close();const n=indexedDB.open(C,s);n.onupgradeneeded=()=>{const l=n.result;l.objectStoreNames.contains(c)||l.createObjectStore(c,{keyPath:"id"})},n.onsuccess=()=>r(n.result),n.onerror=()=>e(n.error)}},o.onerror=()=>e(o.error)})}async function S(){const r=v||(v=await x());return new Promise((e,o)=>{const a=r.transaction(c,"readonly").objectStore(c).getAll();a.onsuccess=()=>{const s=a.result,n=f.projectId?s.filter(l=>l.projectId===f.projectId):s.filter(l=>!l.projectId);e(n)},a.onerror=()=>o(a.error)})}async function U(r){const e=v||(v=await x());return new Promise((o,a)=>{const s=e.transaction(c,"readwrite").objectStore(c),{url:n,...l}=r,d=s.add(l);d.onsuccess=()=>o(),d.onerror=()=>a(d.error)})}async function E(r){const e=v||(v=await x());return new Promise((o,a)=>{const s=e.transaction(c,"readwrite").objectStore(c),{url:n,...l}=r,d=s.put(l);d.onsuccess=()=>o(),d.onerror=()=>a(d.error)})}async function z(r){const e=v||(v=await x());return new Promise((o,a)=>{const s=e.transaction(c,"readwrite").objectStore(c).delete(r);s.onsuccess=()=>o(),s.onerror=()=>a(s.error)})}const g=_([]),b=_(""),i=_(null),h=_(!1),R=k,j=H(()=>{if(!b.value.trim())return g.value;const r=b.value.toLowerCase();return g.value.filter(e=>e.name.toLowerCase().includes(r)||e.originalName.toLowerCase().includes(r))});function P(r,e){let o=r,a=1;for(;e.includes(o);)o=`${r}${a}`,a++;return o}function V(r){return new Promise((e,o)=>{const a=new Image,s=URL.createObjectURL(r);a.onload=()=>{URL.revokeObjectURL(s),e({width:a.width,height:a.height})},a.onerror=()=>{URL.revokeObjectURL(s),o(new Error("无法加载图片"))},a.src=s})}function D(r){r.forEach(e=>{if(!e.url){const o=new Blob([e.buffer],{type:e.mime});e.url=URL.createObjectURL(o)}})}async function y(){const r=await S();g.value=r,D(r),R("library:update",r)}async function q(r){const e=r.target,o=e.files;if(!o||o.length===0)return;const a=g.value.map(s=>s.name);for(const s of Array.from(o))try{const n=await s.arrayBuffer(),l=await V(s),d=s.name.replace(/\.(png|jpg|jpeg|gif|svg|webp|PNG|JPG|JPEG|GIF|SVG|WEBP)$/,""),B=P(d,a);a.push(B);const F={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:B,originalName:s.name,mime:s.type||"application/octet-stream",buffer:n,width:l.width,height:l.height,size:s.size,projectId:f.projectId};await U(F)}catch(n){console.error(`上传图标 ${s.name} 失败:`,n)}await y(),e.value=""}async function O(r){const e=g.value.find(o=>o.id===r);e!=null&&e.url&&URL.revokeObjectURL(e.url),await z(r),await y()}function $(r){i.value={...r},h.value=!0}async function A(){if(i.value){if(g.value.filter(r=>r.id!==i.value.id).map(r=>r.name).includes(i.value.name)){Z("图标名称已存在，请使用其他名称","warning");return}await E(i.value),await y(),h.value=!1,i.value=null}}function G(){h.value=!1,i.value=null}function I(r){if(r===0)return"0 Bytes";const e=1024,o=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,a)).toFixed(2))+" "+o[a]}return Y(()=>{y()}),(r,e)=>{var o,a,s,n;return p(),m("div",te,[e[12]||(e[12]=Q('<div class="relative" data-v-0c11af94><div class="absolute inset-0 bg-gradient-to-r from-orange-500/10 to-red-500/10 rounded-lg blur-xl" data-v-0c11af94></div><div class="relative bg-gray-800/50 backdrop-blur-sm border border-orange-500/20 rounded-lg p-4" data-v-0c11af94><h2 class="font-bold text-xl bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent flex items-center" data-v-0c11af94><svg class="w-6 h-6 mr-3 text-orange-400" fill="currentColor" viewBox="0 0 20 20" data-v-0c11af94><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" data-v-0c11af94></path></svg> 图标库管理 </h2><p class="text-sm text-gray-400 mt-2 leading-relaxed" data-v-0c11af94> 上传图标文件（png/jpg/gif/svg/webp），将保存到本地并可在构建器中使用。 <span class="text-orange-400" data-v-0c11af94>支持自动命名和重复处理。</span></p></div></div>',1)),t("div",re,[t("div",ae,[e[4]||(e[4]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg blur-xl"},null,-1)),t("div",oe,[t("div",se,[e[3]||(e[3]=t("svg",{class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),L(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"text",placeholder:"搜索图标...",class:"flex-1 bg-transparent border-none outline-none text-gray-100 placeholder-gray-500"},null,512),[[M,b.value]])])])]),t("div",le,[e[6]||(e[6]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 rounded-lg blur-xl group-hover:blur-2xl transition-all duration-300"},null,-1)),t("div",ne,[t("label",ie,[e[5]||(e[5]=t("div",{class:"flex items-center justify-center space-x-3"},[t("svg",{class:"w-6 h-6 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),t("span",{class:"font-semibold text-emerald-400"},"上传图标")],-1)),t("input",{type:"file",accept:"image/*",multiple:"",onChange:q,class:"hidden"},null,32)])])])]),t("div",de,[e[9]||(e[9]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg blur-xl"},null,-1)),t("div",ue,[t("div",ce,[t("h3",ve,[e[7]||(e[7]=t("svg",{class:"w-5 h-5 mr-2 text-purple-400",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),K(" 图标库 ("+u(j.value.length)+"/"+u(g.value.length)+") ",1)])]),j.value.length===0?(p(),m("div",ge,[e[8]||(e[8]=t("svg",{class:"w-16 h-16 mx-auto text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t("div",pe,u(b.value?"未找到匹配的图标":"暂无图标"),1),t("div",be,u(b.value?"尝试其他搜索关键词":"上传图标文件开始使用"),1)])):(p(),m("div",me,[t("div",fe,[(p(!0),m(W,null,T(j.value,l=>(p(),m("div",{key:l.id,class:"bg-gray-700/30 rounded-lg p-3 hover:bg-gray-700/50 transition-all duration-200 group border border-gray-600/30 hover:border-purple-400/50"},[t("div",xe,[t("img",{src:l.url,alt:l.name,class:"max-w-full max-h-full object-contain",loading:"lazy",onError:e[1]||(e[1]=d=>{d.target.style.display="none"})},null,40,he)]),t("div",ye,[t("div",{class:"font-medium text-gray-100 text-sm truncate",title:l.name},u(l.name),9,_e),t("div",we,[t("div",null,u(l.width)+"×"+u(l.height),1),t("div",null,u(I(l.size)),1)])]),t("div",ke,[t("button",{onClick:d=>$(l),class:"flex-1 px-2 py-1 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/30 hover:border-blue-400/50 rounded text-blue-400 hover:text-blue-300 transition-all duration-200 text-xs"}," 编辑 ",8,je),t("button",{onClick:d=>O(l.id),class:"flex-1 px-2 py-1 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 hover:border-red-400/50 rounded text-red-400 hover:text-red-300 transition-all duration-200 text-xs"}," 删除 ",8,Ie)])]))),128))])]))])]),h.value?(p(),m("div",Be,[t("div",Le,[e[11]||(e[11]=t("h3",{class:"text-lg font-bold text-gray-100 mb-4"},"编辑图标",-1)),t("div",Me,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm text-gray-400 mb-2"},"图标名称",-1)),L(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.name=l),type:"text",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-gray-100 focus:border-blue-400 focus:outline-none",placeholder:"输入图标名称"},null,512),[[M,i.value.name]])]),t("div",Ce,[t("div",null,"原始文件名: "+u((o=i.value)==null?void 0:o.originalName),1),t("div",null,"尺寸: "+u((a=i.value)==null?void 0:a.width)+"×"+u((s=i.value)==null?void 0:s.height),1),t("div",null,"大小: "+u(I(((n=i.value)==null?void 0:n.size)||0)),1)])]),t("div",{class:"flex space-x-3 mt-6"},[t("button",{onClick:A,class:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors duration-200"}," 保存 "),t("button",{onClick:G,class:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors duration-200"}," 取消 ")])])])):J("",!0)])}}}),Se=ee(Ne,[["__scopeId","data-v-0c11af94"]]),Ue=N({__name:"index",props:{projectId:{}},setup(w){const k=w;return(f,v)=>(p(),X(Se,{"project-id":k.projectId},null,8,["project-id"]))}}),Pe=Ue;export{Pe as default};
