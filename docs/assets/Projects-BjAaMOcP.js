import{E as m,H as N,I as V,O as X,R as P,_ as q,c as Y,d as F,f as b,h as T,l as e,lt as w,m as Z,o as ee,u as te,w as re}from"./codemirror-B25QCqWr.js";import{f as E,h as oe,m as ae,s as J}from"./vendor-vue-C93_ecI2.js";import{t as ne}from"./index-BuLERHzw.js";import{t as c}from"./componentStorage-k4mRdpgu.js";var U="lowcode-projects",f="projects";async function H(){return new Promise((x,v)=>{const i=indexedDB.open(U);i.onsuccess=()=>{const d=i.result;if(d.objectStoreNames.contains(f))x(d);else{const g=d.version+1;d.close();const u=indexedDB.open(U,g);u.onupgradeneeded=()=>{const k=u.result;k.objectStoreNames.contains(f)||k.createObjectStore(f,{keyPath:"id"})},u.onsuccess=()=>x(u.result),u.onerror=()=>v(u.error)}},i.onerror=()=>v(i.error)})}function se(){const x=J(),v=P([]);async function i(){try{const r=(await H()).transaction(f,"readonly").objectStore(f).getAll();return await new Promise(a=>{r.onsuccess=()=>{v.value=(r.result||[]).sort((l,_)=>_.updatedAt-l.updatedAt),a(v.value)}})}catch(r){return console.warn("加载项目失败：",r),[]}}async function d(r){try{await(await H()).transaction(f,"readwrite").objectStore(f).put(r),await i()}catch(a){console.warn("保存项目失败：",a)}}async function g(r){try{await(await H()).transaction(f,"readwrite").objectStore(f).delete(r),await i()}catch(a){console.warn("删除项目失败：",a)}}async function u(r){if(confirm("确认删除此项目吗？这将清空项目相关的所有数据（图标、字体、画布等）。")){await g(r);try{await c.clearProjectResources(r),await c.clearBuilderStateForProject(r)}catch(a){console.warn("清空项目相关资源失败：",a)}await i()}}function k(r,a){const l={id:`project-${Date.now()}`,name:r.trim(),description:(a==null?void 0:a.trim())||"",createdAt:Date.now(),updatedAt:Date.now()};return d(l)}function A(r,a){var _,M;const l={...r,name:((_=a.name)!=null?_:r.name).trim(),description:(((M=a.description)!=null?M:r.description)||"").trim(),updatedAt:Date.now()};return d(l)}async function p(r){await A(r,{}),x.push(`/project/${r.id}/builder`)}function h(r){return new Date(r).toLocaleString("zh-CN")}return{projects:v,loadProjects:i,saveProject:d,deleteProject:g,deleteProjectWithResources:u,createProject:k,updateProject:A,enterProject:p,formatDate:h}}var ie={class:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white relative overflow-hidden"},le={class:"relative z-10 container mx-auto px-6 py-8"},de={class:"flex flex-col md:flex-row gap-4 mb-8"},ue={class:"flex-1"},ce={class:"relative"},ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},pe={class:"flex items-start justify-between mb-4"},me={class:"flex-1"},fe={class:"text-xl font-semibold text-cyan-300 mb-2"},ge={key:0,class:"text-gray-400 text-sm mb-3 clamp-2"},ye={class:"flex gap-2"},be=["onClick"],we=["onClick"],he=["onClick"],xe={class:"text-xs text-gray-500 mb-4"},ke=["onClick"],_e={key:1,class:"text-center py-16"},je={class:"text-xl font-semibold text-gray-400 mb-2"},Ce={class:"text-gray-500 mb-6"},Pe={class:"bg-gray-800 border border-purple-500/30 rounded-xl p-6 w-full max-w-md"},Ae={class:"text-xl font-semibold text-cyan-300 mb-4"},Me={class:"space-y-4"},De={class:"flex gap-3 mt-6"},Be=["disabled"],Se=q({__name:"ProjectManager",setup(x){const v=J(),{projects:i,loadProjects:d,saveProject:g,deleteProjectWithResources:u,enterProject:k,formatDate:A}=se(),p=P(""),h=P(!1),r=P(null),a=P(""),l=P("");function _(s){return`${s}-${Math.random().toString(36).slice(2,8)}`}function M(s){const t=new Map,o=j=>{j.forEach(n=>{const C=_(n.type||"el");t.set(n.id,C),(n.type==="group"||n.type==="container")&&Array.isArray(n.children)&&o(n.children)})};o(s);const y=j=>{j.forEach(n=>{t.has(n.id)&&(n.id=t.get(n.id)),n.elementId&&(n.elementId=`${n.elementId.split("_")[0]||n.elementId.split("-")[0]||"el"}_${Math.random().toString(36).slice(2,6)}`),(n.type==="group"||n.type==="container")&&Array.isArray(n.children)&&y(n.children)})};y(s)}function L(){if(!a.value.trim())return;const s={id:`project-${Date.now()}`,name:a.value.trim(),description:l.value.trim(),createdAt:Date.now(),updatedAt:Date.now()};g(s),D()}function O(){if(!r.value||!a.value.trim())return;const s={...r.value,name:a.value.trim(),description:l.value.trim(),updatedAt:Date.now()};g(s),D()}function K(s){r.value=s,a.value=s.name,l.value=s.description||"",h.value=!0}function D(){h.value=!1,r.value=null,a.value="",l.value=""}async function W(s){try{const t=`${s.name} 副本`,o=prompt("请输入新项目名称",t);if(o==null)return;const y=o.trim()||t,j={id:`project-${Date.now()}`,name:y,description:s.description||"",createdAt:Date.now(),updatedAt:Date.now()};await g(j);const n=s.id,C=j.id,[R,S,$,I]=await Promise.all([c.getBuilderStateForProject(n),c.getFontsByComponentId(n),c.getIconsForComponent(n),c.getDatabaseObjectsByComponentId(n)]);if(R){const B=JSON.parse(JSON.stringify(R));B.elements&&Array.isArray(B.elements)&&M(B.elements),await c.saveBuilderStateForProject(C,B)}Array.isArray(S)&&S.length>0&&await c.saveFontsForComponent(C,S),Array.isArray($)&&$.length>0&&await c.saveIconsForComponent(C,$),Array.isArray(I)&&I.length>0&&await c.saveDatabaseObjectsForComponent(C,I),await d(),alert("项目复制成功")}catch(t){console.warn("复制项目失败：",t),alert("复制项目失败，请重试")}}const z=Y(()=>{if(!p.value.trim())return i.value;const s=p.value.toLowerCase();return i.value.filter(t=>t.name.toLowerCase().includes(s)||t.description&&t.description.toLowerCase().includes(s))});function Q(s){u(s)}re(()=>{d()});function G(){v.push("/low-code")}return(s,t)=>(m(),b("div",ie,[t[17]||(t[17]=Z('<div class="absolute inset-0 opacity-10" data-v-8821ec25><div class="absolute top-10 left-10 w-32 h-32 border border-cyan-400 rotate-45 animate-pulse" data-v-8821ec25></div><div class="absolute top-32 right-20 w-24 h-24 border border-purple-400 rounded-full animate-spin" style="animation-duration:20s;" data-v-8821ec25></div><div class="absolute bottom-20 left-1/4 w-40 h-40 border border-blue-400 rotate-12 animate-bounce" style="animation-duration:3s;" data-v-8821ec25></div><div class="absolute bottom-32 right-1/3 w-28 h-28 border border-green-400 rounded-lg rotate-45 animate-pulse" style="animation-delay:1s;" data-v-8821ec25></div></div><div class="absolute inset-0 opacity-5" style="background-image:linear-gradient(cyan 1px, transparent 1px), linear-gradient(90deg, cyan 1px, transparent 1px);background-size:50px 50px;" data-v-8821ec25></div>',2)),e("div",le,[e("div",{class:"flex items-center justify-between mb-12"},[e("button",{onClick:G,class:"flex items-center gap-2 px-3 py-2 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg border border-cyan-500/30 text-gray-300 hover:text-white transition-all duration-200"},[...t[7]||(t[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),T(" 返回 ",-1)])]),t[8]||(t[8]=e("h1",{class:"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent"}," 项目管理 ",-1))]),e("div",de,[e("div",ue,[e("div",ce,[V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),type:"text",placeholder:"搜索项目...",class:"w-full px-4 py-3 pl-12 bg-gray-800/50 border border-cyan-500/30 rounded-xl text-gray-100 placeholder-gray-400 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none transition-all duration-200"},null,512),[[E,p.value]]),t[9]||(t[9]=e("div",{class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("button",{onClick:t[1]||(t[1]=o=>h.value=!0),class:"px-6 py-3 bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 text-white rounded-xl font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-emerald-500/25"},[...t[10]||(t[10]=[e("span",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]),T(" 新建项目 ")],-1)])])]),z.value.length>0?(m(),b("div",ve,[(m(!0),b(ee,null,X(z.value,o=>(m(),b("div",{key:o.id,class:"pm-card bg-gray-800/50 backdrop-blur-sm border border-purple-500/30 rounded-xl p-6 hover:border-purple-400/50 transition-all duration-200 transform hover:scale-105 hover:shadow-lg hover:shadow-purple-500/20 flex flex-col"},[e("div",pe,[e("div",me,[e("h3",fe,w(o.name),1),o.description?(m(),b("p",ge,w(o.description),1)):F("",!0)]),e("div",ye,[e("button",{onClick:y=>W(o),class:"p-2 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/20 rounded-lg transition-colors duration-200",title:"复制项目"},[...t[11]||(t[11]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h8a2 2 0 012 2v8M16 17H8a2 2 0 01-2-2V7m3 0V5a2 2 0 012-2h6a2 2 0 012 2v2"})],-1)])],8,be),e("button",{onClick:y=>K(o),class:"p-2 text-blue-400 hover:text-blue-300 hover:bg-blue-500/20 rounded-lg transition-colors duration-200",title:"编辑项目"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,we),e("button",{onClick:y=>Q(o.id),class:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded-lg transition-colors duration-200",title:"删除项目"},[...t[13]||(t[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,he)])]),e("div",xe,[e("div",null,"创建时间: "+w(N(A)(o.createdAt)),1),e("div",null,"更新时间: "+w(N(A)(o.updatedAt)),1)]),e("button",{onClick:y=>N(k)(o),class:"mt-auto w-full px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-purple-500/25"}," 进入编辑 ",8,ke)]))),128))])):(m(),b("div",_e,[t[14]||(t[14]=e("div",{class:"w-24 h-24 mx-auto mb-6 bg-gray-800/50 rounded-full flex items-center justify-center"},[e("svg",{class:"w-12 h-12 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})])],-1)),e("h3",je,w(p.value?"未找到匹配的项目":"还没有项目"),1),e("p",Ce,w(p.value?"尝试使用其他关键词搜索":"创建您的第一个可视化组件项目"),1),p.value?F("",!0):(m(),b("button",{key:0,onClick:t[2]||(t[2]=o=>h.value=!0),class:"px-6 py-3 bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 text-white rounded-xl font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-emerald-500/25"}," 创建项目 "))]))]),h.value?(m(),b("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:oe(D,["self"])},[e("div",Pe,[e("h3",Ae,w(r.value?"编辑项目":"创建新项目"),1),e("div",Me,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"项目名称",-1)),V(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value=o),type:"text",placeholder:"输入项目名称...",class:"w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-100 placeholder-gray-400 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200",onKeyup:t[4]||(t[4]=ae(o=>r.value?O():L(),["enter"]))},null,544),[[E,a.value]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"项目描述（可选）",-1)),V(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>l.value=o),placeholder:"输入项目描述...",rows:"3",class:"w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-gray-100 placeholder-gray-400 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200 resize-none"},null,512),[[E,l.value]])])]),e("div",De,[e("button",{onClick:D,class:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg font-medium transition-colors duration-200"}," 取消 "),e("button",{onClick:t[6]||(t[6]=o=>r.value?O():L()),disabled:!a.value.trim(),class:"flex-1 px-4 py-2 bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 disabled:from-gray-600 disabled:to-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-all duration-200"},w(r.value?"保存":"创建"),9,Be)])])])):F("",!0)]))}}),$e=ne(Se,[["__scopeId","data-v-8821ec25"]]),Ie=q({__name:"index",setup(x){return(v,i)=>(m(),te($e))}}),He=Ie;export{He as default};
