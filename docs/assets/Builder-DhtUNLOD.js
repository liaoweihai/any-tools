import{i as fl}from"./rolldown-runtime-CKFmjIRy.js";import{C as Qr,E as A,H as ml,I as me,L as ol,O as Ut,P as mt,R as xe,S as Yr,_ as Et,b as kt,c as Ge,ct as ot,d as Y,f as j,g as ut,h as gr,i as $l,l as r,lt as Qe,m as Jr,n as kl,o as Ft,r as El,st as Ue,t as Sl,u as Xr,w as Zr}from"./codemirror-B25QCqWr.js";import{d as sl,f as ke,h as yl,m as Hr,n as Ml,o as Cl,p as Nl,r as Il,s as Fl,u as qr}from"./vendor-vue-C93_ecI2.js";import{t as en}from"./index-DmvoIV1C.js";import{t as Xe}from"./componentStorage-DB4dbTb9.js";import"./echarts-xBohgwka.js";import{t as Al}from"./DraggableBox-T2raC6AV.js";function Wr(b){return b.replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o]||o)}function jl(b){var c,w;const o=b.style||{},e=[];if(e.push("position:absolute"),e.push(`left:${Math.round(b.left||0)}px`),e.push(`top:${Math.round(b.top||0)}px`),b.autoSize||(b.width&&e.push(`width:${Math.round(b.width)}px`),b.height&&e.push(`height:${Math.round(b.height)}px`)),o.opacity!==void 0&&e.push(`opacity:${o.opacity}`),o.border&&!(b.type==="container"&&o.border==="1px dashed rgba(148,163,184,0.6)")&&e.push(`border:${o.border}`),o.borderRadius&&e.push(`border-radius:${o.borderRadius}`),o.backgroundColor&&e.push(`background-color:${o.backgroundColor}`),o.boxShadow&&e.push(`box-shadow:${o.boxShadow}`),o.backgroundGradient&&((c=o.backgroundGradient.colors)!=null&&c.length)){const I=o.backgroundGradient.angle||0,_=o.backgroundGradient.colors[0]||"#000000",oe=o.backgroundGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${I}deg, ${_}, ${oe})`),e.push("background-size:cover"),e.push("background-repeat:no-repeat")}if(b.type==="text"){o.fontFamily&&e.push(`font-family:${o.fontFamily}`),o.fontSize!==void 0&&e.push(`font-size:${o.fontSize}px`),o.color&&e.push(`color:${o.color}`),o.fontWeight&&e.push(`font-weight:${o.fontWeight}`),o.letterSpacing!==void 0&&o.letterSpacing!==null&&e.push(`letter-spacing:${o.letterSpacing}px`),o.lineHeight!==void 0&&e.push(`line-height:${o.lineHeight}`),o.fontStyle&&e.push(`font-style:${o.fontStyle}`),o.textAlign&&e.push(`text-align:${o.textAlign}`),o.textDecoration&&e.push(`text-decoration:${o.textDecoration}`);const I=o.textOrientation;if(I==="vertical"?(e.push("writing-mode:vertical-rl"),e.push("text-orientation:upright")):I==="horizontal"&&e.push("writing-mode:horizontal-tb"),o.textGradient&&((w=o.textGradient.colors)!=null&&w.length)){const _=o.textGradient.angle||0,oe=o.textGradient.colors[0]||"#000000",$e=o.textGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${_}deg, ${oe}, ${$e})`),e.push("-webkit-background-clip:text"),e.push("background-clip:text"),e.push("color:transparent")}}return b.type==="image"&&o.objectFit&&e.push(`object-fit:${o.objectFit}`),e.join(";")}function bl(b){return String(b).split(";").map(o=>o.trim()).filter(Boolean).map(o=>o.includes("!important")?o:`${o} !important`).join("; ")}function zl(b){return String(b).replace(/\{([^}]*)\}/g,(o,e)=>`{ ${bl(e)} }`)}function Ol(b){const o=[],e=c=>{c.forEach(w=>{if((w.type==="group"||w.type==="container")&&Array.isArray(w.children))e(w.children);else{const I=(w.className||"").trim(),_=w.customClassCss?String(w.customClassCss).trim():"";if(!I||!_)return;/\{[^}]*\}/.test(_)?o.push(zl(_)):o.push(`.${I} { ${bl(_)} }`)}})};return e(b),o.join(`
`)}function al(b,o,e,c,w){const I=b.replace(/[^A-Za-z0-9_]/g,"_");let _=0;const oe=[],$e=[],C=o.backgroundUrl||"",pe=o.backgroundColor||"transparent",P=o.globalFontFamily||"",K=o.globalFontSize||14,se=o.globalColor||"#000000",X=e.some(v=>v.type==="chart");function k(v){const q=String(v||"").trim();if(!q)return"";let ne=q.replace(/[^A-Za-z0-9_]/g,"_");return/[A-Za-z_]/.test(ne[0]||"")||(ne="_"+ne),ne}function d(v){if(!v.hidden)return"";const q=k(v.hiddenLabel);return q?` ${c&&c.hideDirective==="show"?"v-show":"v-if"}="${q}"`:""}function U(v,q){var Ve,He,Ye,Ke,nt,vt,ct,At,Fe,ye,pt,gt,yt,St,jt;const ne=jl(v),y=v.zIndex||1,t=v.className&&v.className.trim()?` class="${v.className.trim()}"`:"",re=v.eventBinding,Z=re&&re.enabled&&re.handlerName?` @click="${String(re.handlerName)}($event)"`:"";if(v.type==="group"&&Array.isArray(v.children)){const Se=v.children.map((Ne,Te)=>U(Ne,Te)).join(`
        `);return`<div${t}${d(v)} style="${ne};z-index:${y}">
        ${Se}
      </div>`}if(v.type==="text"){const Se=(()=>{var it;const Je=((it=v.style)==null?void 0:it.textAlign)||"left";return Je==="center"?"text-flex-center":Je==="right"?"text-flex-right":"text-flex-left"})(),Ne=[(Ve=v.className)==null?void 0:Ve.trim(),Se].filter(Boolean).join(" "),Te=Ne?` class="${Ne}"`:"",Le=v.style||{},et=v.elementId&&v.elementId.trim()?v.elementId.trim():`text_${q}`,at=!!(Le.textWave&&Le.textWave.enabled),We=!!Le.skewFlowEnabled;if(at||We){const Je=v.dynamic&&v.dynamic.enabled&&v.dynamic.objectName&&v.dynamic.propertyPath?{type:"dynamic",obj:v.dynamic.objectName,path:v.dynamic.propertyPath}:{type:"static",text:v.text||""};oe.push(`'${et.replace(/'/g,"\\'")}' : ${JSON.stringify(Je)}`);const it={textWaveEnabled:at,amplitude:(Ye=(He=Le.textWave)==null?void 0:He.amplitude)!=null?Ye:0,frequency:(nt=(Ke=Le.textWave)==null?void 0:Ke.frequency)!=null?nt:0,phase:(ct=(vt=Le.textWave)==null?void 0:vt.phase)!=null?ct:0,skewFlowEnabled:We,skewAngle:(At=Le.skewAngle)!=null?At:0,textOrientation:Le.textOrientation||"horizontal",fontSize:(Fe=Le.fontSize)!=null?Fe:K,letterSpacing:(ye=Le.letterSpacing)!=null?ye:0};return $e.push(`'${et.replace(/'/g,"\\'")}' : ${JSON.stringify(it)}`),`<div${Te}${d(v)}${Z} style="${ne};z-index:${y}">
        <span v-for="(p,pi) in getTextPieces('${et.replace(/'/g,"\\'")}')" :key="pi" :style="p.style">{{ p.char }}</span>
      </div>`}if(v.dynamic&&v.dynamic.enabled&&v.dynamic.objectName&&v.dynamic.propertyPath){const Je=`${v.dynamic.objectName}.${v.dynamic.propertyPath}`;return`<div${Te}${d(v)}${Z} style="${ne};z-index:${y}">{{ ${Je} }}</div>`}else{const Je=Wr(v.text||"");return`<div${Te}${d(v)}${Z} style="${ne};z-index:${y}">${Je}</div>`}}if(v.type==="image"){if(c!=null&&c.imageFileMap&&c.imageFileMap[v.id]){const Te=c.imageFileMap[v.id],Le=v.elementId&&v.elementId.trim()?` id="${v.elementId.trim()}"`:"";return`<img${t}${Le}${d(v)}${Z} src="./imgs/${Te}" style="${ne};z-index:${y}" alt="" />`}if(c!=null&&c.imageFileNames&&c.imageFileNames[_]){const Te=c.imageFileNames[_++],Le=v.elementId&&v.elementId.trim()?` id="${v.elementId.trim()}"`:"";return`<img${t}${Le}${d(v)}${Z} src="./imgs/${Te}" style="${ne};z-index:${y}" alt="" />`}const Se=v.elementId&&v.elementId.trim()?v.elementId.trim():`img_${q}`,Ne=v.elementId&&v.elementId.trim()?` id="${v.elementId.trim()}"`:"";return`<img${t}${Ne}${d(v)}${Z} :src="images['${Se}']" style="${ne};z-index:${y}" alt="" />`}if(v.type==="chart"){const Se=Wr(v.text||"chart"),Ne=v.elementId&&v.elementId.trim()?v.elementId.trim():`chart_${q}`;return`<div${t}${d(v)}${Z} id="${Ne}" style="${ne};z-index:${y}">${Se}</div>`}if(v.type==="container"){const Se=v.elementId&&v.elementId.trim()?` id="${v.elementId.trim()}"`:"",Ne=v.comment?`<!-- ${v.comment.replace(/-->/g,"")} -->
      `:"";if(Array.isArray(v.children)){const Le=v.children.map((et,at)=>U(et,at)).join(`
        `);return`${Ne}<div${t}${d(v)}${Z}${Se} style="${ne};z-index:${y}">
        ${Le}
      </div>`}const Te=Wr(v.text||"");return`${Ne}<div${t}${d(v)}${Z}${Se} style="${ne};z-index:${y}">${Te}</div>`}if(v.type==="line"){const Se=v.style||{},Ne=Se.lineColor||"#ffffff",Te=(pt=Se.lineThickness)!=null?pt:2,Le=Se.lineOrientation||"horizontal",et=Se.lineStyle==="dashed",at=(gt=Se.lineDashLength)!=null?gt:6,We=(yt=Se.lineDashGap)!=null?yt:4,Je=Math.max(1,Math.round((St=v.width)!=null?St:Le==="horizontal"?200:2)),it=Math.max(1,Math.round((jt=v.height)!=null?jt:Le==="horizontal"?2:200)),zt=Math.round(it/2),ht=Math.round(Je/2),wt=et?` stroke-dasharray="${at} ${We}"`:"";return Le==="horizontal"?`<svg${t}${d(v)}${Z} viewBox="0 0 ${Je} ${it}" preserveAspectRatio="none" style="${ne};z-index:${y}"><line x1="0" y1="${zt}" x2="${Je}" y2="${zt}" stroke="${Ne}" stroke-width="${Te}"${wt} fill="none" /></svg>`:`<svg${t}${d(v)}${Z} viewBox="0 0 ${Je} ${it}" preserveAspectRatio="none" style="${ne};z-index:${y}"><line x1="${ht}" y1="0" x2="${ht}" y2="${it}" stroke="${Ne}" stroke-width="${Te}"${wt} fill="none" /></svg>`}const rt=Wr(v.text||"element");return`<div${t}${d(v)}${Z} style="${ne};z-index:${y}">${rt}</div>`}const H=e.map((v,q)=>U(v,q)).join(`
      `),Q=Ol(e);function T(v,q){v.forEach(ne=>{(ne.type==="group"||ne.type==="container")&&Array.isArray(ne.children)?(q(ne),T(ne.children,q)):q(ne)})}const J=new Set;T(e,v=>{v.type==="text"&&v.dynamic&&v.dynamic.enabled&&v.dynamic.objectName&&J.add(String(v.dynamic.objectName))});const we=Array.from(J),W=!w||we.length===0?"":we.map(v=>{try{const q=w[v],ne=JSON.stringify(q!=null?q:{});return`      ${v}: ${ne},`}catch{return`      ${v}: {},`}}).join(`
`),D=(()=>{const v=[];let q=0;return T(e,ne=>{if(ne.type==="chart"){const y=ne.elementId&&ne.elementId.trim()?ne.elementId.trim():`chart_${q}`;q++;const t=ne.chartOption||{};try{v.push(`'${y.replace(/'/g,"\\'")}' : ${JSON.stringify(t)}`)}catch{v.push(`'${y.replace(/'/g,"\\'")}' : {}`)}}}),`{ ${v.join(", ")} }`})(),R=(()=>{const v=new Set;return T(e,q=>{const ne=String(q.hiddenLabel||"").trim(),y=k(ne),t=!!q.hidden;y&&t&&v.add(y)}),Array.from(v).map(q=>`      ${q}: false,`).join(`
`)})(),Ae=(()=>{const v=new Map;function q(y){y.forEach(t=>{const re=t.eventBinding;re&&re.enabled&&re.handlerName&&v.set(String(re.handlerName),String(re.code||"")),Array.isArray(t.children)&&q(t.children)})}q(e);const ne=Array.from(v.entries());return ne.length?ne.map(([y,t])=>`${y}(e) {
${t}
}`).join(`,
`):""})();return`
<template>
  <div class="container" :style="containerStyle">
    ${H}
  </div>
</template>

<script>
${X?`import * as echarts from 'echarts';
`:""}
export default {
  name: '${I}',
  data() {
    return {
      config: {
        width: ${Math.round(o.width)},
        height: ${Math.round(o.height)},
        backgroundColor: '${pe.replace(/'/g,"\\'")}',
        globalFontFamily: '${P.replace(/'/g,"\\'")}',
        globalFontSize: ${Math.round(K)},
        globalColor: '${se}',
      },
      backgroundUrl: ${c!=null&&c.backgroundFileName?`(() => { try { return require('./imgs/${c.backgroundFileName.replace(/'/g,"\\'")}'); } catch(e) { return './imgs/${c.backgroundFileName.replace(/'/g,"\\'")}'; } })()`:`'${C.replace(/'/g,"\\'")}'`},
      ${c!=null&&c.imageFileNames?`// 使用本地资源路径，动态映射不再需要
      images: {},`:`// 图片 src 动态映射，初始写入 base64（若存在），blob 留空待替换
      images: {},`}
      // 图表配置导出，键为元素ID或序号
      chartOptions: ${D},
      ${W?`// 数据库对象（按页面引用注入到 data）
${W}`:""}
      ${oe.length?`// 文本数据源映射（支持静态/动态）
      textSources: { ${oe.join(", ")} },`:""}
      ${$e.length?`// 文本效果参数映射（波形与倾斜跟随）
      textEffects: { ${$e.join(", ")} },`:""}
      ${R}
    };
  },
  computed: {
    containerStyle() {
      const base = {
        position: 'relative',
        width: this.config.width + 'px',
        height: this.config.height + 'px',
        fontFamily: this.config.globalFontFamily,
        fontSize: this.config.globalFontSize + 'px',
        color: this.config.globalColor,
        backgroundColor: this.config.backgroundColor || 'transparent',
      };
      if (this.backgroundUrl) {
        return Object.assign({}, base, {
          backgroundImage: 'url(' + this.backgroundUrl + ')',
          backgroundSize: 'cover',
          backgroundRepeat: 'no-repeat',
        });
      }
      return base;
    }
  },
  methods: {
    getByPath(obj, path) {
      try {
        const segs = String(path).split('.');
        return segs.reduce((acc, k) => (acc ? acc[k] : undefined), obj);
      } catch(e) {
        return undefined;
      }
    },
    getTextValue(id) {
      const srcMap = this.textSources || {};
      const src = srcMap[id];
      if (!src) return '';
      if (src.type === 'static') return String(src.text || '');
      const root = this[src.obj] || {};
      const v = this.getByPath(root, src.path);
      return v != null ? String(v) : '';
    },
    getTextPieces(id) {
      const text = this.getTextValue(id);
      const effMap = this.textEffects || {};
      const eff = effMap[id] || {};
      const orientation = eff.textOrientation || 'horizontal';
      const fontSize = Number(eff.fontSize || (this.config && this.config.globalFontSize) || 14);
      const letterSpacing = Number(eff.letterSpacing || 0);
      const step = fontSize * 0.6 + letterSpacing;

      const amp = eff.textWaveEnabled ? Number(eff.amplitude || 0) : 0;
      const freq = eff.textWaveEnabled ? Number(eff.frequency || 0) : 0;
      const phase = eff.textWaveEnabled ? Number(eff.phase || 0) : 0;

      const skewAngle = eff.skewFlowEnabled ? Number(eff.skewAngle || 0) : 0;
      const tan = Math.tan(skewAngle * Math.PI / 180);

      const pieces = [];
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const wave = amp ? amp * Math.sin(i * freq + phase) : 0;
        let dx = 0, dy = 0;
        if (orientation === 'horizontal') {
          dy += wave;
          dy += tan * step * i;
        } else {
          dx += wave;
          dx += tan * step * i;
        }
        const style = 'display:inline-block;white-space:pre;transform: translate(' + Math.round(dx) + 'px, ' + Math.round(dy) + 'px);';
        pieces.push({ char: ch, style });
      }
      return pieces;
    }${Ae?`,
${Ae}`:""}
  },
  mounted() {
    // 使用 npm 依赖的 echarts 初始化图表实例
    Object.keys(this.chartOptions || {}).forEach((id) => {
      const el = document.getElementById(id);
      if (el) {
        const inst = echarts.init(el);
        inst.setOption(this.chartOptions[id], true);
      }
    });
  }
};
<\/script>

${c!=null&&c.fontFaces&&c.fontFaces.length>0?`
<style>
${c.fontFaces.map(v=>`@font-face { font-family: '${v.family.replace(/'/g,"\\'")}'; src: url('./fonts/${v.file}'); font-weight: normal; font-style: normal; }`).join(`
`)}
</style>
`:""}
<style scoped>
.container { box-sizing: border-box; }
/* 文本对齐公共样式，减少重复的内联 CSS */
.text-flex-left { display:flex; align-items:center; justify-content:flex-start; }
.text-flex-center { display:flex; align-items:center; justify-content:center; }
.text-flex-right { display:flex; align-items:center; justify-content:flex-end; }
${Q}
</style>
`}function Kr(b){return b.replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o]||o)}function Bl(b){var w,I;const o=b.style||{},e=[];if(e.push("position:absolute"),e.push(`left:${Math.round(b.left||0)}px`),e.push(`top:${Math.round(b.top||0)}px`),b.autoSize||(b.width&&e.push(`width:${Math.round(b.width)}px`),b.height&&e.push(`height:${Math.round(b.height)}px`)),o.opacity!==void 0&&e.push(`opacity:${o.opacity}`),o.border&&!(b.type==="container"&&o.border==="1px dashed rgba(148,163,184,0.6)")&&e.push(`border:${o.border}`),o.borderRadius&&e.push(`border-radius:${o.borderRadius}`),o.backgroundColor&&e.push(`background-color:${o.backgroundColor}`),o.boxShadow&&e.push(`box-shadow:${o.boxShadow}`),o.backgroundGradient&&((w=o.backgroundGradient.colors)!=null&&w.length)){const _=o.backgroundGradient.angle||0,oe=o.backgroundGradient.colors[0]||"#000000",$e=o.backgroundGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${_}deg, ${oe}, ${$e})`),e.push("background-size:cover"),e.push("background-repeat:no-repeat")}if(b.type==="text"&&(o.fontFamily&&e.push(`font-family:${o.fontFamily}`),o.fontSize!==void 0&&e.push(`font-size:${o.fontSize}px`),o.color&&e.push(`color:${o.color}`),o.fontWeight&&e.push(`font-weight:${o.fontWeight}`),o.letterSpacing!==void 0&&o.letterSpacing!==null&&e.push(`letter-spacing:${o.letterSpacing}px`),o.lineHeight!==void 0&&e.push(`line-height:${o.lineHeight}`),o.fontStyle&&e.push(`font-style:${o.fontStyle}`),o.textAlign&&e.push(`text-align:${o.textAlign}`),o.textDecoration&&e.push(`text-decoration:${o.textDecoration}`),o.textOrientation==="vertical"&&(e.push("writing-mode:vertical-rl"),e.push("text-orientation:upright")),o.textGradient&&((I=o.textGradient.colors)!=null&&I.length))){const _=o.textGradient.angle||0,oe=o.textGradient.colors[0]||"#000000",$e=o.textGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${_}deg, ${oe}, ${$e})`),e.push("-webkit-background-clip:text"),e.push("background-clip:text"),e.push("color:transparent")}b.type==="image"&&o.objectFit&&e.push(`object-fit:${o.objectFit}`);const c=b.eventBinding;return c&&c.enabled&&c.cursor&&e.push(`cursor:${c.cursor}`),e.join(";")}function xl(b){return String(b).split(";").map(o=>o.trim()).filter(Boolean).map(o=>o.includes("!important")?o:`${o} !important`).join("; ")}function Dl(b){return String(b).replace(/\{([^}]*)\}/g,(o,e)=>`{ ${xl(e)} }`)}function Gl(b){const o=[],e=c=>{c.forEach(w=>{if((w.type==="group"||w.type==="container")&&Array.isArray(w.children))e(w.children);else{const I=(w.className||"").trim(),_=w.customClassCss?String(w.customClassCss).trim():"";if(!I||!_)return;/\{[^}]*\}/.test(_)?o.push(Dl(_)):o.push(`.${I} { ${xl(_)} }`)}})};return e(b),o.join(`
`)}function vl(b){const o=String(b||"").trim();if(!o)return"";let e=o.replace(/[^A-Za-z0-9_]/g,"_");return/[A-Za-z_]/.test(e[0]||"")||(e="_"+e),e}function Ll(b,o){if(!b.hidden)return"";const e=vl(b.hiddenLabel);return e?` ${o!=null&&o.useShow?"v-show":"v-if"}="${e}"`:""}function il(b,o,e,c){let w=0;const I=e.some(d=>d.type==="chart");function _(d,U){var R,Ae,v,q,ne;const H=Bl(d),Q=d.zIndex||1,T=d.className&&d.className.trim()?` class="${d.className.trim()}"`:"",J=Ll(d,{useShow:(c==null?void 0:c.hideDirective)==="show"}),we=d.eventBinding,W=we&&we.enabled&&we.handlerName?` @click="${String(we.handlerName)}($event)"`:"",D=d.elementId&&d.elementId.trim()?` id="${d.elementId.trim()}"`:"";if((d.type==="group"||d.type==="container")&&Array.isArray(d.children)){const y=d.children.map((t,re)=>_(t,re)).join(`
        `);return`<div${T}${J}${W}${D} style="${H};z-index:${Q}">
        ${y}
      </div>`}if(d.type==="text"){const y=Kr(d.text||"");return`<div${T}${J}${W} style="${H};z-index:${Q}">${y}</div>`}if(d.type==="image"){if(c!=null&&c.imageFileMap&&c.imageFileMap[d.id]){const y=c.imageFileMap[d.id],t=d.elementId&&d.elementId.trim()?` id="${d.elementId.trim()}"`:"";return`<img${T}${t}${J}${W} :src="assetUrl('./imgs/${y}')" style="${H};z-index:${Q}" alt="" />`}if(c!=null&&c.imageFileNames&&c.imageFileNames[w]){const y=c.imageFileNames[w++],t=d.elementId&&d.elementId.trim()?` id="${d.elementId.trim()}"`:"";return`<img${T}${t}${J}${W} :src="assetUrl('./imgs/${y}')" style="${H};z-index:${Q}" alt="" />`}return`<div${T}${J}${W} style="${H};z-index:${Q}"></div>`}if(d.type==="line"){const y=d.style||{},t=y.lineColor||"#ffffff",re=(R=y.lineThickness)!=null?R:2,Z=y.lineOrientation||"horizontal",rt=y.lineStyle==="dashed",Ve=(Ae=y.lineDashLength)!=null?Ae:6,He=(v=y.lineDashGap)!=null?v:4,Ye=Math.max(1,Math.round((q=d.width)!=null?q:Z==="horizontal"?200:2)),Ke=Math.max(1,Math.round((ne=d.height)!=null?ne:Z==="horizontal"?2:200)),nt=Math.round(Ke/2),vt=Math.round(Ye/2),ct=rt?` stroke-dasharray="${Ve} ${He}"`:"";return Z==="horizontal"?`<svg${T}${J}${W} viewBox="0 0 ${Ye} ${Ke}" preserveAspectRatio="none" style="${H};z-index:${Q}"><line x1="0" y1="${nt}" x2="${Ye}" y2="${nt}" stroke="${t}" stroke-width="${re}"${ct} fill="none" /></svg>`:`<svg${T}${J}${W} viewBox="0 0 ${Ye} ${Ke}" preserveAspectRatio="none" style="${H};z-index:${Q}"><line x1="${vt}" y1="0" x2="${vt}" y2="${Ke}" stroke="${t}" stroke-width="${re}"${ct} fill="none" /></svg>`}if(d.type==="chart"){const y=d.elementId&&d.elementId.trim()?d.elementId.trim():`chart_${U}`,t=Kr(d.text||"chart");return`<div${T}${J}${W} id="${y}" style="${H};z-index:${Q}">${t}</div>`}return`<div${T}${J}${W} style="${H};z-index:${Q}">${Kr(d.text||"")}</div>`}const oe=e.map((d,U)=>_(d,U)).join(`
      `),$e=Gl(e),C=o.backgroundUrl||"",pe=o.backgroundColor||"transparent",P=o.globalFontFamily||"",K=o.globalFontSize||14,se=o.globalColor||"#000000",X=(()=>{const d=[];let U=0;return e.forEach(H=>{if(H.type==="chart"){const Q=H.elementId&&H.elementId.trim()?H.elementId.trim():`chart_${U}`;U++;const T=H.chartOption||{};try{d.push(`'${Q.replace(/'/g,"\\'")}' : ${JSON.stringify(T)}`)}catch{d.push(`'${Q.replace(/'/g,"\\'")}' : {}`)}}}),`{ ${d.join(", ")} }`})(),k=(()=>{const d=new Set;return e.forEach(U=>{const H=String(U.hiddenLabel||"").trim(),Q=vl(H),T=!!U.hidden;Q&&T&&d.add(Q)}),Array.from(d).map(U=>`const ${U} = ref(false)`).join(`
`)})();return`
<template>
  <div class="container" :style="containerStyle">
    ${oe}
  </div>
</template>

<script setup lang="ts">
import { onMounted, ref, computed } from 'vue'
${I?`import * as echarts from 'echarts'
`:""}
function assetUrl(p: string): string { try { return new URL(p, import.meta.url).href } catch { return p } }
const config = {
  width: ${Math.round(o.width)},
  height: ${Math.round(o.height)},
  backgroundColor: '${pe.replace(/'/g,"\\'")}',
  globalFontFamily: '${P.replace(/'/g,"\\'")}',
  globalFontSize: ${Math.round(K)},
  globalColor: '${se}',
}
const backgroundUrl: string = ${c!=null&&c.backgroundFileName?`assetUrl('./imgs/${String(c.backgroundFileName).replace(/'/g,"\\'")}')`:`'${C.replace(/'/g,"\\'")}'`}
const images: Record<string, string> = {}
${I?`const chartOptions: Record<string, any> = ${X}`:""}
${k?`${k}
`:""}
const containerStyle = computed(() => {
  const base: Record<string, string> = {
    position: 'relative',
    width: config.width + 'px',
    height: config.height + 'px',
    fontFamily: config.globalFontFamily,
    fontSize: config.globalFontSize + 'px',
    color: config.globalColor,
    backgroundColor: (config.backgroundColor || 'transparent') as string,
  }
  if (backgroundUrl) {
    return Object.assign({}, base, {
      backgroundImage: 'url(' + backgroundUrl + ')',
      backgroundSize: 'cover',
      backgroundRepeat: 'no-repeat',
    }) as Record<string, string>
  }
  return base
})
// 事件处理函数
${(()=>{const d=new Map,U=H=>{H.forEach(Q=>{const T=Q.eventBinding;T&&T.enabled&&T.handlerName&&d.set(String(T.handlerName),String(T.code||"")),Array.isArray(Q.children)&&U(Q.children)})};return U(e),Array.from(d.entries()).map(([H,Q])=>`function ${H}(e: MouseEvent){
${Q}
}`).join(`
`)})()}
${I?`onMounted(() => {
  Object.keys(chartOptions || {}).forEach((id) => {
    const el = document.getElementById(id)
    if (el && (echarts as any)) { const inst = (echarts as any).init(el); inst.setOption((chartOptions as any)[id], true) }
  })
})`:""}
<\/script>

<style scoped>
.container { box-sizing: border-box; }
.text-flex-left { display:flex; align-items:center; justify-content:flex-start; }
.text-flex-center { display:flex; align-items:center; justify-content:center; }
.text-flex-right { display:flex; align-items:center; justify-content:flex-end; }
${$e}
</style>
`}function pr(b){return String(b).replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o]||o)}function Ul(b){const o=b.style||{},e=[];if(e.push("position:absolute"),e.push(`left:${Math.round(b.left||b.x||0)}px`),e.push(`top:${Math.round(b.top||b.y||0)}px`),b.autoSize||(b.width&&e.push(`width:${Math.round(b.width)}px`),b.height&&e.push(`height:${Math.round(b.height)}px`)),o.opacity!==void 0&&e.push(`opacity:${o.opacity}`),o.border&&!(b.type==="container"&&o.border==="1px dashed rgba(148,163,184,0.6)")&&e.push(`border:${o.border}`),o.borderRadius&&e.push(`border-radius:${o.borderRadius}`),o.backgroundColor&&e.push(`background-color:${o.backgroundColor}`),o.boxShadow&&e.push(`box-shadow:${o.boxShadow}`),o.backgroundGradient&&o.backgroundGradient.colors&&o.backgroundGradient.colors.length){const w=o.backgroundGradient.angle||0,I=o.backgroundGradient.colors[0]||"#000000",_=o.backgroundGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${w}deg, ${I}, ${_})`),e.push("background-size:cover"),e.push("background-repeat:no-repeat")}if(b.type==="text"&&(o.fontFamily&&e.push(`font-family:${o.fontFamily}`),o.fontSize!==void 0&&e.push(`font-size:${o.fontSize}px`),o.color&&e.push(`color:${o.color}`),o.fontWeight&&e.push(`font-weight:${o.fontWeight}`),o.letterSpacing!==void 0&&o.letterSpacing!==null&&e.push(`letter-spacing:${o.letterSpacing}px`),o.lineHeight!==void 0&&e.push(`line-height:${o.lineHeight}`),o.fontStyle&&e.push(`font-style:${o.fontStyle}`),o.textAlign&&e.push(`text-align:${o.textAlign}`),o.textDecoration&&e.push(`text-decoration:${o.textDecoration}`),o.textOrientation==="vertical"&&(e.push("writing-mode:vertical-rl"),e.push("text-orientation:upright")),o.textGradient&&o.textGradient.colors&&o.textGradient.colors.length)){const w=o.textGradient.angle||0,I=o.textGradient.colors[0]||"#000000",_=o.textGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${w}deg, ${I}, ${_})`),e.push("-webkit-background-clip:text"),e.push("background-clip:text"),e.push("color:transparent")}b.type==="image"&&o.objectFit&&e.push(`object-fit:${o.objectFit}`);const c=b.eventBinding;return c&&c.enabled&&c.cursor&&e.push(`cursor:${c.cursor}`),b.hidden&&e.push("display:none"),e.join(";")}function hl(b){return String(b).split(";").map(o=>o.trim()).filter(Boolean).map(o=>o.includes("!important")?o:`${o} !important`).join("; ")}function Rl(b){return String(b).replace(/\{([^}]*)\}/g,(o,e)=>`{ ${hl(e)} }`)}function Tl(b){const o=[],e=c=>{c.forEach(w=>{if((w.type==="group"||w.type==="container")&&Array.isArray(w.children))e(w.children);else{const I=(w.className||"").trim(),_=w.customClassCss?String(w.customClassCss).trim():"";if(!I||!_)return;/\{[^}]*\}/.test(_)?o.push(Rl(_)):o.push(`.${I} { ${hl(_)} }`)}})};return e(b),o.join(`
`)}function dl(b,o,e,c){function w(d){for(const U of d)if((U.type==="group"||U.type==="container")&&Array.isArray(U.children)){if(w(U.children))return!0}else if(U.type==="chart")return!0;return!1}const I=w(e),_=o.backgroundUrl||"",oe=c!=null&&c.backgroundFileName?`background-image:url('./imgs/${c.backgroundFileName}');background-size:cover;background-repeat:no-repeat;`:_?`background-image:url('${_}');background-size:cover;background-repeat:no-repeat;`:"";let $e=0;const C={};(function(U){let H=0;const Q=T=>{T.forEach(J=>{if((J.type==="group"||J.type==="container")&&Array.isArray(J.children))Q(J.children);else if(J.type==="chart"){const we=J.elementId&&String(J.elementId).trim()?String(J.elementId).trim():`chart_${H++}`;C[J.id]=we}})};Q(U)})(e);function pe(d){var W,D,R,Ae,v;const U=Ul(d),H=d.zIndex||1,Q=d.className&&d.className.trim()?` class="${d.className.trim()}"`:"",T=d.eventBinding,J=T&&T.enabled&&T.handlerName?` onclick="${String(T.handlerName)}(event)"`:"",we=d.elementId&&d.elementId.trim()?` id="${d.elementId.trim()}"`:"";if((d.type==="group"||d.type==="container")&&Array.isArray(d.children)&&d.children.length>0){const q=d.children.map(ne=>pe(ne)).join(`
        `);return`<div${Q}${J}${we} style="${U};z-index:${H}">
        ${q}
      </div>`}if(d.type==="text"){const q=(d.style||{}).textAlign||"left",ne=q==="center"?"text-flex-center":q==="right"?"text-flex-right":"text-flex-left",y=[(d.className||"").trim(),ne].filter(Boolean).join(" ");return`<div${y?` class="${y}"`:""}${J} style="${U};z-index:${H}">${pr(d.text||"")}</div>`}if(d.type==="image"){if(c!=null&&c.imageFileMap&&c.imageFileMap[d.id]){const q=c.imageFileMap[d.id];return`<img${Q}${J} src="./imgs/${q}" style="${U};z-index:${H}" alt="" />`}if(c!=null&&c.imageFileNames&&c.imageFileNames[$e]){const q=c.imageFileNames[$e++];return`<img${Q}${J} src="./imgs/${q}" style="${U};z-index:${H}" alt="" />`}return`<div${Q}${J} style="${U};z-index:${H}"></div>`}if(d.type==="line"){const q=d.style||{},ne=q.lineColor||"#ffffff",y=(W=q.lineThickness)!=null?W:2,t=q.lineOrientation||"horizontal",re=q.lineStyle==="dashed",Z=(D=q.lineDashLength)!=null?D:6,rt=(R=q.lineDashGap)!=null?R:4,Ve=Math.max(1,Math.round((Ae=d.width)!=null?Ae:t==="horizontal"?200:2)),He=Math.max(1,Math.round((v=d.height)!=null?v:t==="horizontal"?2:200)),Ye=Math.round(He/2),Ke=Math.round(Ve/2),nt=re?` stroke-dasharray="${Z} ${rt}"`:"";return t==="horizontal"?`<svg${Q}${J} viewBox="0 0 ${Ve} ${He}" preserveAspectRatio="none" style="${U};z-index:${H}"><line x1="0" y1="${Ye}" x2="${Ve}" y2="${Ye}" stroke="${ne}" stroke-width="${y}"${nt} fill="none" /></svg>`:`<svg${Q}${J} viewBox="0 0 ${Ve} ${He}" preserveAspectRatio="none" style="${U};z-index:${H}"><line x1="${Ke}" y1="0" x2="${Ke}" y2="${He}" stroke="${ne}" stroke-width="${y}"${nt} fill="none" /></svg>`}if(d.type==="chart"){const q=C[d.id]||String(d.elementId||"");return`<div${Q}${J} id="${q}" style="${U};z-index:${H}">${pr(d.text||"chart")}</div>`}return d.type==="container"?`<div${Q}${J} style="${U};z-index:${H}">${pr(d.text||"")}</div>`:`<div${Q}${J} style="${U};z-index:${H}">${pr(d.text||"")}</div>`}const P=e.map(d=>pe(d)).join(`
      `),K=Tl(e),se=c!=null&&c.fontFaces&&c.fontFaces.length>0?c.fontFaces.map(d=>`@font-face { font-family: '${String(d.family).replace(/'/g,"\\'")}'; src: url('./fonts/${String(d.file)}'); font-weight: normal; font-style: normal; }`).join(`
`):"";function X(d,U){d.forEach(H=>{if((H.type==="group"||H.type==="container")&&Array.isArray(H.children))X(H.children,U);else if(H.type==="chart"){const Q=C[H.id]||String(H.elementId||"");try{U.push(`chartOptions['${Q.replace(/'/g,"\\'")}'] = ${JSON.stringify(H.chartOption||{})};`)}catch{U.push(`chartOptions['${Q.replace(/'/g,"\\'")}'] = {};`)}}})}const k=I?`
    (function(){
      var chartOptions = {};
      ${(()=>{const d=[];return X(e,d),d.join(`
      `)})()}
      Object.keys(chartOptions).forEach(function(id){
        var el = document.getElementById(id);
        if (el && window.echarts) { var inst = window.echarts.init(el); inst.setOption(chartOptions[id], true); }
      });
    })();
  `:"";return`<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>${pr(b)}</title>
<style>
.container { position:relative; width:${Math.round(o.width)}px; height:${Math.round(o.height)}px; font-family:${String(o.globalFontFamily||"").replace(/'/g,"\\'")}; font-size:${Math.round(o.globalFontSize)}px; color:${String(o.globalColor)}; background-color:${String(o.backgroundColor||"transparent")}; ${oe} }
.text-flex-left { display:flex; align-items:center; justify-content:flex-start; }
.text-flex-center { display:flex; align-items:center; justify-content:center; }
.text-flex-right { display:flex; align-items:center; justify-content:flex-end; }
${se}
${K}
</style>
${I?'<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"><\/script>':""}
</head>
<body>
<div class="container">
  ${P}
</div>
<script>
${(()=>{const d=new Map,U=H=>{H.forEach(Q=>{const T=Q.eventBinding;T&&T.enabled&&T.handlerName&&d.set(String(T.handlerName),String(T.code||"")),Array.isArray(Q.children)&&U(Q.children)})};return U(e),Array.from(d.entries()).map(([H,Q])=>`function ${H}(event){
${Q}
}`).join(`
`)})()}
${k}
<\/script>
</body>
</html>`}function _r(b){return b.replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o]||o)}function ul(b){var c,w;const o=b.style||{},e=[];if(e.push("position:absolute"),e.push(`left:${Math.round(b.left||0)}px`),e.push(`top:${Math.round(b.top||0)}px`),b.autoSize||(b.width&&e.push(`width:${Math.round(b.width)}px`),b.height&&e.push(`height:${Math.round(b.height)}px`)),o.opacity!==void 0&&e.push(`opacity:${o.opacity}`),o.border&&!(b.type==="container"&&o.border==="1px dashed rgba(148,163,184,0.6)")&&e.push(`border:${o.border}`),o.borderRadius&&e.push(`border-radius:${o.borderRadius}`),o.backgroundColor&&e.push(`background-color:${o.backgroundColor}`),o.boxShadow&&e.push(`box-shadow:${o.boxShadow}`),o.backgroundGradient&&((c=o.backgroundGradient.colors)!=null&&c.length)){const I=o.backgroundGradient.angle||0,_=o.backgroundGradient.colors[0]||"#000000",oe=o.backgroundGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${I}deg, ${_}, ${oe})`),e.push("background-size:cover"),e.push("background-repeat:no-repeat")}if(b.type==="text"&&(o.fontFamily&&e.push(`font-family:${o.fontFamily}`),o.fontSize!==void 0&&e.push(`font-size:${o.fontSize}px`),o.color&&e.push(`color:${o.color}`),o.fontWeight&&e.push(`font-weight:${o.fontWeight}`),o.letterSpacing!==void 0&&o.letterSpacing!==null&&e.push(`letter-spacing:${o.letterSpacing}px`),o.lineHeight!==void 0&&e.push(`line-height:${o.lineHeight}`),o.fontStyle&&e.push(`font-style:${o.fontStyle}`),o.textAlign&&e.push(`text-align:${o.textAlign}`),o.textDecoration&&e.push(`text-decoration:${o.textDecoration}`),o.textOrientation==="vertical"&&(e.push("writing-mode:vertical-rl"),e.push("text-orientation:upright")),o.textGradient&&((w=o.textGradient.colors)!=null&&w.length))){const I=o.textGradient.angle||0,_=o.textGradient.colors[0]||"#000000",oe=o.textGradient.colors[1]||"#000000";e.push(`background-image:linear-gradient(${I}deg, ${_}, ${oe})`),e.push("-webkit-background-clip:text"),e.push("background-clip:text"),e.push("color:transparent")}return b.type==="image"&&o.objectFit&&e.push(`object-fit:${o.objectFit}`),b.hidden&&e.push("display:none"),e.join(";")}function wl(b){return String(b).split(";").map(o=>o.trim()).filter(Boolean).map(o=>o.includes("!important")?o:`${o} !important`).join("; ")}function Vl(b){return String(b).replace(/\{([^}]*)\}/g,(o,e)=>`{ ${wl(e)} }`)}function Pl(b){const o=[],e=c=>{c.forEach(w=>{if((w.type==="group"||w.type==="container")&&Array.isArray(w.children))e(w.children);else{const I=(w.className||"").trim(),_=w.customClassCss?String(w.customClassCss).trim():"";if(!I||!_)return;/\{[^}]*\}/.test(_)?o.push(Vl(_)):o.push(`.${I} { ${wl(_)} }`)}})};return e(b),o.join(`
`)}function cl(b,o,e,c){const w=e.some(P=>P.type==="chart");let I=0;const _=e.map((P,K)=>{var d,U,H,Q,T;const se=ul(P),X=P.zIndex||1,k=P.className&&P.className.trim()?` class="${P.className.trim()}"`:"";if((P.type==="group"||P.type==="container")&&Array.isArray(P.children)){const J=P.children.map(W=>{const D=ul(W),R=W.zIndex||1,Ae=W.className&&W.className.trim()?` class="${W.className.trim()}"`:"",v=W.elementId&&W.elementId.trim()?` id="${W.elementId.trim()}"`:"";if(W.type==="image"){if(c!=null&&c.imageFileMap&&c.imageFileMap[W.id]){const q=c.imageFileMap[W.id];return`<img${Ae}${v} src="/imgs/${q}" style="${D};z-index:${R}" alt="" />`}if(c!=null&&c.imageFileNames&&c.imageFileNames[I]){const q=c.imageFileNames[I++];return`<img${Ae}${v} src="/imgs/${q}" style="${D};z-index:${R}" alt="" />`}}return`<div${Ae}${v} style="${D};z-index:${R}">${_r(W.text||"")}</div>`}).join(`
        `),we=P.elementId&&P.elementId.trim()?` id="${P.elementId.trim()}"`:"";return`<div${k}${we} style="${se};z-index:${X}">${J}</div>`}if(P.type==="text")return`<div${k} style="${se};z-index:${X}">${_r(P.text||"")}</div>`;if(P.type==="image"){if(c!=null&&c.imageFileMap&&c.imageFileMap[P.id]){const J=c.imageFileMap[P.id];return`<img${k} src="/imgs/${J}" style="${se};z-index:${X}" alt="" />`}if(c!=null&&c.imageFileNames&&c.imageFileNames[I]){const J=c.imageFileNames[I++];return`<img${k} src="/imgs/${J}" style="${se};z-index:${X}" alt="" />`}return`<div${k} style="${se};z-index:${X}"></div>`}if(P.type==="line"){const J=P.style||{},we=J.lineColor||"#ffffff",W=(d=J.lineThickness)!=null?d:2,D=J.lineOrientation||"horizontal",R=J.lineStyle==="dashed",Ae=(U=J.lineDashLength)!=null?U:6,v=(H=J.lineDashGap)!=null?H:4,q=Math.max(1,Math.round((Q=P.width)!=null?Q:D==="horizontal"?200:2)),ne=Math.max(1,Math.round((T=P.height)!=null?T:D==="horizontal"?2:200)),y=Math.round(ne/2),t=Math.round(q/2),re=R?` stroke-dasharray="${Ae} ${v}"`:"";return D==="horizontal"?`<svg${k} viewBox="0 0 ${q} ${ne}" preserveAspectRatio="none" style="${se};z-index:${X}"><line x1="0" y1="${y}" x2="${q}" y2="${y}" stroke="${we}" stroke-width="${W}"${re} fill="none" /></svg>`:`<svg${k} viewBox="0 0 ${q} ${ne}" preserveAspectRatio="none" style="${se};z-index:${X}"><line x1="${t}" y1="0" x2="${t}" y2="${ne}" stroke="${we}" stroke-width="${W}"${re} fill="none" /></svg>`}if(P.type==="chart"){const J=P.elementId&&P.elementId.trim()?P.elementId.trim():`chart_${K}`;return`<div${k} id="${J}" style="${se};z-index:${X}">${_r(P.text||"chart")}</div>`}return`<div${k} style="${se};z-index:${X}">${_r(P.text||"")}</div>`}).join(`
      `),oe=Pl(e),$e=c!=null&&c.fontFaces&&c.fontFaces.length>0?c.fontFaces.map(P=>`@font-face { font-family: '${P.family.replace(/'/g,"\\'")}'; src: url('/fonts/${P.file}'); font-weight: normal; font-style: normal; }`).join(`
`):"",C=(()=>{const P=[];return e.forEach((K,se)=>{if(K.type==="chart"){const X=K.elementId&&K.elementId.trim()?K.elementId.trim():`chart_${se}`,k=K.chartOption||{};try{P.push(`'${X.replace(/'/g,"\\'")}' : ${JSON.stringify(k)}`)}catch{P.push(`'${X.replace(/'/g,"\\'")}' : {}`)}}}),`{ ${P.join(", ")} }`})(),pe=c!=null&&c.backgroundFileName?`'/imgs/${String(c.backgroundFileName).replace(/'/g,"\\'")}'`:`'${(o.backgroundUrl||"").replace(/'/g,"\\'")}'`;return`import React, { useEffect } from 'react';
${w?`import * as echarts from 'echarts';
`:""}
export default function ${b.replace(/[^A-Za-z0-9_]/g,"_")}() {
  const config = { width: ${Math.round(o.width)}, height: ${Math.round(o.height)}, backgroundColor: '${(o.backgroundColor||"transparent").replace(/'/g,"\\'")}', globalFontFamily: '${(o.globalFontFamily||"").replace(/'/g,"\\'")}', globalFontSize: ${Math.round(o.globalFontSize)}, globalColor: '${o.globalColor}' };
  const backgroundUrl = ${pe};
  ${w?`const chartOptions = ${C};
  useEffect(() => {
    Object.keys(chartOptions || {}).forEach((id) => {
      const el = document.getElementById(id);
      if (el) { const inst = echarts.init(el); inst.setOption(chartOptions[id], true); }
    });
  }, []);
`:""}  const containerStyle = { position:'relative', width: config.width + 'px', height: config.height + 'px', fontFamily: config.globalFontFamily, fontSize: config.globalFontSize + 'px', color: config.globalColor, backgroundColor: config.backgroundColor, ...(backgroundUrl ? { backgroundImage: 'url(' + backgroundUrl + ')', backgroundSize: 'cover', backgroundRepeat: 'no-repeat' } : {}) };
  return (
    <div className="container" style={containerStyle}>
      <style>{\`.text-flex-left{display:flex;align-items:center;justify-content:flex-start}.text-flex-center{display:flex;align-items:center;justify-content:center}.text-flex-right{display:flex;align-items:center;justify-content:flex-end${$e?"\\n"+$e:""}${oe?"\\n"+oe:""}\`}</style>
      <div dangerouslySetInnerHTML={{ __html: \`${_.replace(/`/g,"\\`")}\` }} />
    </div>
  );
}
`}var pl=fl(Ml()),Hl=["placeholder"],Wl={key:0,class:"absolute z-10 bg-gray-900 border border-gray-700 rounded w-full mt-1 max-h-40 overflow-auto shadow custom-scrollbar"},_l=["onMousedown"],Jl={key:0,class:"px-2 py-2 text-xs text-gray-400"},ql=Et({__name:"SearchableSelect",props:{modelValue:{},options:{},placeholder:{},numeric:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:o}){const e=b,c=o,w=xe(!1),I=xe(""),_=xe(null),oe=xe("");let $e=null;const C=xe(!1);mt(()=>e.modelValue,T=>{T==null?I.value="":I.value=String(T)},{immediate:!0});const pe=Ge(()=>e.options.map(T=>String(T))),P=Ge(()=>{const T=oe.value.trim().toLowerCase();return T?pe.value.filter(J=>J.toLowerCase().includes(T)):pe.value});function K(T){I.value=T;const J=e.numeric?Number(T):T;c("update:modelValue",J),w.value=!1}function se(){const T=I.value.trim();if(!T){c("update:modelValue",(e.numeric,null)),w.value=!1;return}const J=e.numeric?Number(T):T;c("update:modelValue",J),w.value=!1}function X(){C.value=!1,w.value=!0,U(I.value)}function k(){}function d(T){T.key==="Enter"&&se()}function U(T){$e&&window.clearTimeout($e),$e=window.setTimeout(()=>{oe.value=T},180)}function H(){C.value=!0,w.value=!0,U(I.value)}function Q(T){_.value&&(_.value.contains(T.target)||(w.value=!1))}return Zr(()=>{window.addEventListener("click",Q),oe.value=I.value}),Qr(()=>{window.removeEventListener("click",Q),$e&&window.clearTimeout($e)}),(T,J)=>(A(),j("div",{class:"relative",ref_key:"root",ref:_},[me(r("input",{class:"border border-gray-700 bg-gray-900 text-gray-100 rounded w-full px-2 py-1",placeholder:b.placeholder||"搜索选择或直接输入","onUpdate:modelValue":J[0]||(J[0]=we=>I.value=we),onInput:H,onFocus:X,onBlur:k,onKeydown:d},null,40,Hl),[[ke,I.value]]),w.value?(A(),j("div",Wl,[(A(!0),j(Ft,null,Ut(P.value,we=>(A(),j("div",{key:we,class:"px-2 py-1 hover:bg-gray-700 cursor-pointer text-sm text-gray-100",onMousedown:yl(W=>K(we),["prevent"])},Qe(we),41,_l))),128)),P.value.length===0?(A(),j("div",Jl,"无匹配项，回车使用当前输入")):Y("",!0)])):Y("",!0)],512))}}),It=ql,Xl={class:"space-y-3"},Yl={class:"flex items-center justify-between"},Kl={class:"inline-flex items-center cursor-pointer"},Zl={class:"flex items-center justify-between"},Ql={class:"inline-flex items-center cursor-pointer"},eo=Et({__name:"CanvasSettingsPanel",props:{spacingEnabled:{type:Boolean},alignmentEnabled:{type:Boolean}},emits:["update:spacingEnabled","update:alignmentEnabled"],setup(b,{emit:o}){const e=b,c=o,w=Ge({get:()=>e.spacingEnabled,set:_=>c("update:spacingEnabled",_)}),I=Ge({get:()=>e.alignmentEnabled,set:_=>c("update:alignmentEnabled",_)});return(_,oe)=>(A(),j("div",Xl,[oe[6]||(oe[6]=r("h3",{class:"text-sm font-medium text-cyan-300 border-b border-cyan-500/30 pb-1"},"辅助间距",-1)),r("div",Yl,[oe[3]||(oe[3]=r("label",{class:"text-xs text-gray-400"},"显示间距标注",-1)),r("label",Kl,[me(r("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":oe[0]||(oe[0]=$e=>w.value=$e)},null,512),[[qr,w.value]]),oe[2]||(oe[2]=r("div",{class:"relative w-12 h-6 rounded-full bg-gray-700/60 transition-all duration-200 shadow-inner peer-checked:bg-gradient-to-r peer-checked:from-cyan-600 peer-checked:to-blue-600"},[r("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 peer-checked:translate-x-6"})],-1)),r("span",{class:Ue(["ml-3 text-xs",w.value?"text-cyan-300":"text-gray-300"])},Qe(w.value?"已开启":"已关闭"),3)])]),r("div",Zl,[oe[5]||(oe[5]=r("label",{class:"text-xs text-gray-400"},"显示对齐参考线",-1)),r("label",Ql,[me(r("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":oe[1]||(oe[1]=$e=>I.value=$e)},null,512),[[qr,I.value]]),oe[4]||(oe[4]=r("div",{class:"relative w-12 h-6 rounded-full bg-gray-700/60 transition-all duration-200 shadow-inner peer-checked:bg-gradient-to-r peer-checked:from-cyan-600 peer-checked:to-blue-600"},[r("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 peer-checked:translate-x-6"})],-1)),r("span",{class:Ue(["ml-3 text-xs",I.value?"text-cyan-300":"text-gray-300"])},Qe(I.value?"已开启":"已关闭"),3)])])]))}}),to=eo,ro={class:"space-y-3"},no={key:0,class:"text-sm text-gray-400"},lo={key:1,class:"space-y-2"},oo=Et({__name:"LayersList",props:{elements:{},selectedId:{}},emits:["select","reorderTop"],setup(b,{emit:o}){const e=b,c=o,w=Ge(()=>e.elements),I=xe({});function _(X){I.value[X]=!I.value[X]}function oe(X){const k=X.children;return Array.isArray(k)&&k.length>0}function $e(X){const k=X.children;return Array.isArray(k)?k:[]}const C=xe(null),pe=xe(null);function P(X){const k=(X.elementId||"").trim(),d=(X.className||"").trim(),U=(X.text||"").trim();return k||d||U||X.id}function K(X){const k=String(X.type||"").toLowerCase();return k==="text"?{label:"文本",cls:"bg-blue-600/30 text-blue-200"}:k==="image"?{label:"图片",cls:"bg-emerald-600/30 text-emerald-200"}:k==="chart"?{label:"图表",cls:"bg-orange-600/30 text-orange-200"}:k==="line"?{label:"线条",cls:"bg-slate-600/30 text-slate-200"}:k==="container"?{label:"容器",cls:"bg-cyan-600/30 text-cyan-200"}:k==="group"?{label:"分组",cls:"bg-purple-600/30 text-purple-200"}:{label:"元素",cls:"bg-gray-600/30 text-gray-200"}}const se=Et({name:"LayerNode",props:{node:{type:Object,required:!0},selectedId:{type:String,default:null},depth:{type:Number,default:0},index:{type:Number,default:-1}},emits:["select","reorderTop"],setup(X,{emit:k}){return()=>{const d=X.node,U=X.depth===0,H=d.id===X.selectedId,Q=K(d),T=kt("div",{class:"flex items-center gap-2"},[U&&X.index>=0?kt("span",{class:"px-1.5 py-0.5 text-[10px] rounded bg-cyan-600/30 text-cyan-200"},String(X.index+1)):null,oe(d)?kt("button",{class:"px-2 py-1 text-xs bg-gray-700/60 hover:bg-gray-600/60 rounded text-gray-200",onClick:W=>{W.stopPropagation(),_(d.id)},title:I.value[d.id]?"收起":"展开"},I.value[d.id]?"▼":"▶"):null,kt("span",{class:`px-1.5 py-0.5 text-[10px] rounded ${Q.cls}`},Q.label),kt("span",{class:"text-left text-sm text-gray-100 truncate whitespace-nowrap max-w-[180px]",title:P(d)},P(d))]),J=kt("div",{class:["bg-gray-800/60 border border-cyan-500/20 rounded-lg px-3 py-2 cursor-grab hover:bg-gray-700/60 transition-colors",H?"ring-2 ring-cyan-400/40 bg-gray-700/70":"",U&&pe.value===X.index?"border-purple-400":"",X.depth>0?"ml-3":""].filter(Boolean).join(" "),onClick:()=>k("select",d.id),draggable:U?!0:void 0,onDragstart:W=>{U&&(C.value=X.index,W.target.classList.add("cursor-grabbing"))},onDragover:W=>{U&&(W.preventDefault(),pe.value=X.index)},onDragenter:()=>{U&&(pe.value=X.index)},onDrop:W=>{if(!U)return;W.preventDefault();const D=C.value,R=X.index;C.value=null,pe.value=null,typeof D=="number"&&typeof R=="number"&&D!==R&&k("reorderTop",{from:D,to:R})},onDragend:W=>{C.value=null,pe.value=null,W.target.classList.remove("cursor-grabbing")}},[T,null]),we=I.value[d.id]&&oe(d)?kt("div",{class:"mt-2 space-y-2 pl-3"},[...$e(d)].map(W=>kt(se,{node:W,selectedId:X.selectedId,depth:X.depth+1,index:-1,onSelect:D=>k("select",D)}))):null;return kt("div",{},[J,we])}}});return(X,k)=>(A(),j("div",ro,[k[2]||(k[2]=r("div",{class:"text-xs text-gray-400"},"所有元素按层叠从上到下显示，支持展开分组/容器",-1)),w.value.length===0?(A(),j("div",no,"暂无元素")):(A(),j("div",lo,[(A(!0),j(Ft,null,Ut(w.value,(d,U)=>(A(),Xr(ml(se),{key:d.id,node:d,selectedId:b.selectedId,depth:0,index:U,onSelect:k[0]||(k[0]=H=>c("select",H)),onReorderTop:k[1]||(k[1]=H=>c("reorderTop",H))},null,8,["node","selectedId","index"]))),128))]))]))}}),so=oo,ao={class:"w-80 min-w-[300px] bg-gray-900/80 backdrop-blur-sm border border-cyan-500/30 rounded-xl shadow-2xl shadow-cyan-500/20 flex flex-col"},io={class:"p-4 space-y-4 overflow-y-auto flex-1 custom-scrollbar"},uo={class:"flex items-center gap-2"},co={key:0,class:"space-y-2"},po={key:1,class:"space-y-2"},go={class:"grid grid-cols-2 gap-2"},fo={key:2,class:"space-y-2"},mo={class:"flex gap-2"},yo={key:3,class:"space-y-2"},bo={class:"flex gap-2"},xo=["value"],vo={key:4,class:"space-y-3"},ho={class:"space-y-2"},wo={class:"space-y-2"},$o={class:"space-y-2"},ko={key:6,class:"space-y-2 pt-4 border-t border-cyan-500/30"},Eo={class:"relative"},So={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Mo={class:"relative w-[520px] max-w-[90vw] p-4 bg-gray-900/95 backdrop-blur-md border border-emerald-500/40 rounded-xl shadow-2xl"},Co={class:"flex items-center justify-between mb-3"},No={class:"grid grid-cols-2 gap-2"},Io={key:7,class:"space-y-3"},Fo=Et({__name:"CanvasSidebar",props:{exportName:{},config:{},fontLibrary:{},spacingEnabled:{type:Boolean},alignmentEnabled:{type:Boolean},elements:{},selectedId:{}},emits:["update:exportName","update:configWidth","update:configHeight","update:backgroundColor","update:globalFontFamily","update:globalFontSize","update:globalColor","update:spacingEnabled","update:alignmentEnabled","backgroundFileChange","openPreview","downloadByFormat","downloadAllFormats","resetCanvas","selectElement","moveElementUp","moveElementDown","moveElementTop","moveElementBottom","reorderTopElements"],setup(b,{emit:o}){const e=b,c=o,w=Ge({get:()=>e.exportName,set:W=>c("update:exportName",W)}),I=Ge({get:()=>e.config.width,set:W=>c("update:configWidth",W)}),_=Ge({get:()=>e.config.height,set:W=>c("update:configHeight",W)}),oe=Ge({get:()=>e.config.backgroundColor||"",set:W=>c("update:backgroundColor",W)}),$e=Ge({get:()=>e.config.globalFontFamily||"",set:W=>c("update:globalFontFamily",W)}),C=Ge({get:()=>e.config.globalFontSize||14,set:W=>c("update:globalFontSize",W)}),pe=Ge({get:()=>e.config.globalColor||"#ffffff",set:W=>c("update:globalColor",W)}),P=Ge({get:()=>e.spacingEnabled,set:W=>c("update:spacingEnabled",W)}),K=Ge({get:()=>e.alignmentEnabled,set:W=>c("update:alignmentEnabled",W)});function se(W){try{return String(W||"#000000")}catch{return"#000000"}}const X=Ge({get:()=>k.value,set:W=>k.value=W}),k=xe(!1),d=xe("settings");function U(W){c("backgroundFileChange",W)}function H(){c("openPreview")}function Q(){k.value=!k.value}function T(W){c("downloadByFormat",W),k.value=!1}function J(){c("downloadAllFormats"),k.value=!1}function we(){c("resetCanvas")}return(W,D)=>(A(),j("div",ao,[D[31]||(D[31]=r("div",{class:"p-4 border-b border-cyan-500/30 bg-gradient-to-r from-cyan-600/20 to-blue-600/20 flex-shrink-0"},[r("h2",{class:"text-lg font-bold text-cyan-300 flex items-center gap-2"},[r("span",{class:"w-2 h-2 bg-cyan-400 rounded-full animate-pulse"}),gr(" 画布设置 ")])],-1)),r("div",io,[r("div",uo,[r("button",{class:Ue(["px-3 py-1 text-xs rounded bg-gradient-to-r from-cyan-600 to-blue-600 text-white",d.value==="settings"?"":"opacity-50"]),onClick:D[0]||(D[0]=R=>d.value="settings")},"设置",2),r("button",{class:Ue(["px-3 py-1 text-xs rounded bg-gradient-to-r from-purple-600 to-pink-600 text-white",d.value==="layers"?"":"opacity-50"]),onClick:D[1]||(D[1]=R=>d.value="layers")},"容器层级",2)]),d.value==="settings"?(A(),j("div",co,[D[21]||(D[21]=r("label",{class:"block text-sm font-medium text-cyan-300"},"组件名称",-1)),me(r("input",{"onUpdate:modelValue":D[2]||(D[2]=R=>w.value=R),class:"w-full px-3 py-2 bg-gray-800/50 border border-cyan-500/30 rounded-lg text-gray-100 placeholder-gray-400 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200",placeholder:"GeneratedComponent"},null,512),[[ke,w.value]])])):Y("",!0),d.value==="settings"?(A(),j("div",po,[D[22]||(D[22]=r("label",{class:"block text-sm font-medium text-cyan-300"},"画布尺寸",-1)),r("div",go,[me(r("input",{"onUpdate:modelValue":D[3]||(D[3]=R=>I.value=R),type:"number",class:"px-3 py-2 bg-gray-800/50 border border-cyan-500/30 rounded-lg text-gray-100 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200",placeholder:"宽度"},null,512),[[ke,I.value,void 0,{number:!0}]]),me(r("input",{"onUpdate:modelValue":D[4]||(D[4]=R=>_.value=R),type:"number",class:"px-3 py-2 bg-gray-800/50 border border-cyan-500/30 rounded-lg text-gray-100 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200",placeholder:"高度"},null,512),[[ke,_.value,void 0,{number:!0}]])])])):Y("",!0),d.value==="settings"?(A(),j("div",fo,[D[23]||(D[23]=r("label",{class:"block text-sm font-medium text-cyan-300"},"背景图片",-1)),r("div",mo,[r("input",{type:"file",onChange:U,accept:"image/*",class:"flex-1 text-xs text-gray-300 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:bg-cyan-600 file:text-white hover:file:bg-cyan-500 file:cursor-pointer"},null,32)])])):Y("",!0),d.value==="settings"?(A(),j("div",yo,[D[24]||(D[24]=r("label",{class:"block text-sm font-medium text-cyan-300"},"背景颜色",-1)),r("div",bo,[r("input",{value:se(oe.value),type:"color",onInput:D[5]||(D[5]=R=>c("update:backgroundColor",R.target.value)),class:"w-16 h-8 bg-gray-800/50 border border-cyan-500/30 rounded cursor-pointer"},null,40,xo),me(r("input",{"onUpdate:modelValue":D[6]||(D[6]=R=>oe.value=R),type:"text",class:"flex-1 px-3 py-2 bg-gray-800/50 border border-cyan-500/30 rounded-lg text-gray-100 placeholder-gray-400 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200",placeholder:"#000000 或 rgba(...)"},null,512),[[ke,oe.value]])])])):Y("",!0),d.value==="settings"?(A(),j("div",vo,[D[28]||(D[28]=r("h3",{class:"text-sm font-medium text-cyan-300 border-b border-cyan-500/30 pb-1"},"全局字体设置",-1)),r("div",ho,[D[25]||(D[25]=r("label",{class:"block text-xs text-gray-400"},"字体族",-1)),ut(It,{options:b.fontLibrary,modelValue:$e.value,"onUpdate:modelValue":D[7]||(D[7]=R=>$e.value=R),placeholder:"选择字体"},null,8,["options","modelValue"])]),r("div",wo,[D[26]||(D[26]=r("label",{class:"block text-xs text-gray-400"},"字号 (px)",-1)),me(r("input",{"onUpdate:modelValue":D[8]||(D[8]=R=>C.value=R),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-cyan-500/30 rounded text-gray-100 text-sm focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all duration-200"},null,512),[[ke,C.value,void 0,{number:!0}]])]),r("div",$o,[D[27]||(D[27]=r("label",{class:"block text-xs text-gray-400"},"颜色",-1)),me(r("input",{"onUpdate:modelValue":D[9]||(D[9]=R=>pe.value=R),type:"color",class:"w-full h-8 bg-gray-800/50 border border-cyan-500/30 rounded cursor-pointer"},null,512),[[ke,pe.value]])])])):Y("",!0),d.value==="settings"?(A(),Xr(to,{key:5,spacingEnabled:P.value,alignmentEnabled:K.value,"onUpdate:spacingEnabled":D[10]||(D[10]=R=>P.value=R),"onUpdate:alignmentEnabled":D[11]||(D[11]=R=>K.value=R)},null,8,["spacingEnabled","alignmentEnabled"])):Y("",!0),d.value==="settings"?(A(),j("div",ko,[r("button",{onClick:H,class:"w-full px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-cyan-500/25"},"预览（新窗口）"),r("div",Eo,[r("button",{onClick:Q,class:"w-full px-4 py-2 bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-emerald-500/25"},"导出"),X.value?(A(),j("div",So,[r("div",{class:"absolute inset-0 bg-black/60",onClick:D[12]||(D[12]=R=>X.value=!1)}),r("div",Mo,[r("div",Co,[D[29]||(D[29]=r("h3",{class:"text-sm font-medium text-emerald-300"},"选择导出格式",-1)),r("button",{class:"px-2 py-1 text-xs bg-gray-700/60 hover:bg-gray-600/60 rounded text-gray-200",onClick:D[13]||(D[13]=R=>X.value=!1)},"关闭")]),r("div",No,[r("button",{onClick:D[14]||(D[14]=R=>T("vue2")),class:"px-3 py-2 text-xs bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-500 hover:to-cyan-500 text-white rounded"},"Vue2 组件"),r("button",{onClick:D[15]||(D[15]=R=>T("vue3")),class:"px-3 py-2 text-xs bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-500 hover:to-cyan-500 text-white rounded"},"Vue3 组件"),r("button",{onClick:D[16]||(D[16]=R=>T("react")),class:"px-3 py-2 text-xs bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded"},"React 组件"),r("button",{onClick:D[17]||(D[17]=R=>T("html")),class:"px-3 py-2 text-xs bg-gradient-to-r from-slate-600 to-gray-700 hover:from-slate-500 hover:to-gray-600 text-white rounded"},"纯 HTML 页面"),r("button",{onClick:D[18]||(D[18]=R=>J()),class:"px-3 py-2 text-xs bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white rounded col-span-2"},"一键导出（全部）")])])])):Y("",!0)]),r("button",{onClick:we,class:"w-full px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-500 hover:to-pink-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-red-500/25"},"清空画布")])):Y("",!0),d.value==="layers"?(A(),j("div",Io,[D[30]||(D[30]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"容器层级",-1)),ut(so,{elements:e.elements||[],selectedId:e.selectedId||null,onSelect:D[19]||(D[19]=R=>c("selectElement",R)),onReorderTop:D[20]||(D[20]=R=>c("reorderTopElements",R))},null,8,["elements","selectedId"])])):Y("",!0)])]))}}),Ao=Fo,gl=fl(Il()),jo={class:"relative w-full"},zo=Et({__name:"CssEditor",props:{modelValue:{},height:{},debounceMs:{}},emits:["update:modelValue"],setup(b,{emit:o}){const e=b,c=o,w=xe(e.modelValue||"");let I=null;const _=typeof e.debounceMs=="number"?Math.max(0,e.debounceMs):250;mt(()=>e.modelValue,P=>{I&&(clearTimeout(I),I=null);const K=P||"";K!==w.value&&(w.value=K)}),mt(w,P=>{I&&clearTimeout(I),I=window.setTimeout(()=>{c("update:modelValue",P),I=null},_)}),Qr(()=>{I&&(clearTimeout(I),I=null)});function oe(){const P=w.value||"";if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function")navigator.clipboard.writeText(P).catch(()=>{try{const K=document.createElement("textarea");K.value=P,document.body.appendChild(K),K.select(),document.execCommand("copy"),document.body.removeChild(K)}catch{}});else try{const K=document.createElement("textarea");K.value=P,document.body.appendChild(K),K.select(),document.execCommand("copy"),document.body.removeChild(K)}catch{}}function $e(){I&&(clearTimeout(I),I=null),w.value="",c("update:modelValue","")}const C=[$l,kl(),Sl],pe=Ge(()=>{var P;return(P=e.height)!=null?P:"180px"});return(P,K)=>(A(),j("div",jo,[r("div",{class:"absolute right-2 top-2 z-10 flex gap-2"},[r("button",{type:"button",class:"px-2 py-1 text-xs bg-gray-700/70 hover:bg-gray-700 text-gray-100 rounded",onClick:oe},"复制"),r("button",{type:"button",class:"px-2 py-1 text-xs bg-red-600/70 hover:bg-red-600 text-white rounded",onClick:$e},"清空")]),ut(ml(El),{modelValue:w.value,"onUpdate:modelValue":K[0]||(K[0]=se=>w.value=se),extensions:C,style:ot({height:pe.value,width:"100%"}),class:"w-full rounded border border-purple-500/30 bg-gray-800/50"},null,8,["modelValue","style"])]))}}),Oo=en(zo,[["__scopeId","data-v-c1c6cbbe"]]);function Bo(b,o,e,c,w,I){b&&(b.style=b.style||{},b.style.boxShadow=`${o}px ${e}px ${c}px ${w}px ${I}`)}function Do(b){b.style=b.style||{},b.style.textGradient=b.style.textGradient||{colors:["#00A3FF","#ffffff"],angle:0}}function Go(b){b.style=b.style||{},b.style.backgroundGradient=b.style.backgroundGradient||{colors:["#00A3FF","#ffffff"],angle:90}}function Lo(b,o){var pe,P,K;const e=(pe=o==null?void 0:o.maxDepth)!=null?pe:6,c=(P=o==null?void 0:o.maxEntries)!=null?P:400,w=(K=o==null?void 0:o.includeIntermediate)!=null?K:!1,I=[],_=new WeakSet;function oe(se){return Object.prototype.toString.call(se)==="[object Object]"}function $e(se){I.length<c&&I.push(se)}function C(se,X,k){if(!(k>e)&&se!=null){if(typeof se!="object"){$e(X);return}if(!_.has(se)){if(_.add(se),Array.isArray(se)){$e(X);const d=Math.min(se.length,20);for(let U=0;U<d;U++)C(se[U],`${X}[${U}]`,k+1);return}if(oe(se)){w&&$e(X);const d=Object.keys(se).slice(0,50);for(const U of d)C(se[U],X?`${X}.${U}`:U,k+1);return}$e(X)}}}return C(b,"",0),I.filter(Boolean)}function Uo(b,o){try{if(!b||!o)return"";const e=o.replace(/\[(\d+)\]/g,".$1").replace(/\['([^']+)'\]/g,".$1").replace(/\["([^\"]+)"\]/g,".$1").split(".").filter(Boolean);let c=b;for(const w of e){if(c==null)return"";c=c[w]}return typeof c=="object"?JSON.stringify(c):c!=null?c:""}catch{return""}}function Ro(b,o){var w;if(!o||!((w=o.dynamic)!=null&&w.enabled)||!o.dynamic.objectName||!o.dynamic.propertyPath)return"";const e=o.dynamic,c=b[e.objectName];return String(Uo(c,e.propertyPath))}var To={class:"w-80 min-w-[300px] bg-gray-900/80 backdrop-blur-sm border border-purple-500/30 rounded-xl shadow-2xl shadow-purple-500/20 flex flex-col"},Vo={key:0,class:"p-4 space-y-4 overflow-y-auto flex-1 custom-scrollbar"},Po={class:"space-y-3"},Ho={class:"grid grid-cols-2 gap-2"},Wo={class:"col-span-2"},_o={class:"space-y-3"},Jo={class:"flex items-center justify-between"},qo={class:"inline-flex items-center cursor-pointer"},Xo={key:0,class:"grid grid-cols-2 gap-2"},Yo={key:1},Ko={class:"space-y-3"},Zo={class:"space-y-2"},Qo={class:"flex items-center justify-between"},es={key:0},ts={class:"flex gap-2"},rs={key:1},ns={key:2},ls={key:3,class:"space-y-2 pt-2 border-t border-purple-500/20"},os={class:"flex items-center justify-between"},ss={class:"inline-flex items-center cursor-pointer"},as=["checked"],is={key:0,class:"space-y-1"},ds=["value"],us={key:0,class:"space-y-3"},cs={class:"flex items-center gap-2"},ps=["value"],gs=["value"],fs={class:"space-y-2"},ms={class:"flex items-center justify-between"},ys={class:"flex items-center gap-1 text-xs text-gray-300"},bs=["checked"],xs={key:0,class:"grid grid-cols-3 gap-2 items-end"},vs={class:"flex items-center gap-2"},hs=["value"],ws=["value"],$s={class:"flex items-center gap-2"},ks=["value"],Es=["value"],Ss={class:"space-y-1"},Ms=["value"],Cs=["value"],Ns={class:"space-y-2"},Is={class:"flex items-center justify-between"},Fs={class:"flex items-center gap-1 text-xs text-gray-300"},As=["checked"],js={key:0,class:"space-y-1"},zs={class:"flex items-center gap-2"},Os={key:0,class:"space-y-1"},Bs=["value"],Ds=["value"],Gs={key:1,class:"space-y-1"},Ls=["value"],Us={class:"flex items-center gap-1"},Rs=["value"],Ts={class:"space-y-2"},Vs={class:"flex items-center justify-between"},Ps={class:"flex items-center gap-1 text-xs text-gray-300"},Hs=["checked"],Ws={key:0,class:"space-y-2"},_s=["value"],Js={class:"space-y-1"},qs={class:"flex items-center gap-2"},Xs=["value"],Ys=["value"],Ks={class:"space-y-1"},Zs={class:"flex items-center gap-2"},Qs=["value"],ea=["value"],ta={class:"space-y-1"},ra={class:"flex items-center gap-2"},na=["value"],la=["value"],oa={class:"space-y-1"},sa={class:"flex items-center gap-2"},aa=["value"],ia=["value"],da={class:"space-y-1"},ua={key:0,class:"flex items-center gap-2"},ca=["value"],pa=["value"],ga={key:1,class:"space-y-3"},fa={class:"flex items-center gap-2"},ma={key:0,class:"space-y-2"},ya=["value"],ba={class:"grid grid-cols-2 gap-2"},xa=["value"],va=["value"],ha={key:0,class:"grid grid-cols-2 gap-2"},wa=["value"],$a=["value"],ka={key:1,class:"grid grid-cols-2 gap-2"},Ea={key:2,class:"grid grid-cols-3 gap-2 items-end"},Sa={key:1},Ma={class:"flex items-center justify-between mt-2"},Ca={key:0,class:"text-xs text-red-400"},Na={key:2,class:"space-y-3"},Ia={class:"space-y-2"},Fa={class:"flex gap-1"},Aa=["value"],ja=["value"],za={class:"grid grid-cols-2 gap-2"},Oa={class:"grid grid-cols-2 gap-1"},Ba=["value"],Da={class:"grid grid-cols-2 gap-2"},Ga=["value"],La={key:0},Ua=["value"],Ra={key:0,class:"grid grid-cols-2 gap-2"},Ta=["value"],Va={key:3,class:"space-y-3"},Pa={class:"space-y-2"},Ha={class:"space-y-2 mt-2"},Wa={class:"flex items-center gap-2"},_a=["checked"],Ja={key:0,class:"space-y-2 p-2 bg-gray-800/30 rounded"},qa={class:"text-xs text-gray-400"},Xa={class:"space-y-2"},Ya={class:"grid grid-cols-2 gap-1"},Ka={class:"grid grid-cols-2 gap-2"},Za={class:"grid grid-cols-2 gap-2"},Qa={class:"grid grid-cols-2 gap-2"},ei=["value"],ti=["value"],ri={class:"space-y-2"},ni={class:"flex gap-1"},li=["value","disabled"],oi=["value","disabled"],si={key:0,class:"text-xs text-yellow-400 mt-1"},ai={class:"space-y-2"},ii={class:"flex gap-1"},di=["value"],ui=["value"],ci={class:"space-y-2"},pi={class:"grid grid-cols-3 gap-1"},gi={class:"space-y-2"},fi={class:"grid grid-cols-2 gap-1"},mi={class:"space-y-2"},yi={class:"flex items-center gap-2"},bi={class:"flex items-center gap-2 mt-1"},xi={class:"space-y-2"},vi={class:"flex items-center justify-between"},hi={class:"flex gap-1"},wi={key:0,class:"grid grid-cols-3 gap-2 items-center"},$i={class:"col-span-1"},ki={class:"col-span-1"},Ei={class:"col-span-1"},Si={class:"space-y-2"},Mi={class:"grid grid-cols-3 gap-1"},Ci={class:"space-y-2"},Ni={class:"flex items-center justify-between"},Ii={class:"flex gap-1"},Fi={key:0,class:"space-y-2 p-2 bg-gray-800/30 rounded"},Ai={class:"grid grid-cols-2 gap-2"},ji={class:"flex gap-1"},zi={class:"flex gap-1"},Oi={class:"block text-xs text-gray-400 mb-1"},Bi={class:"space-y-2"},Di={class:"flex items-center justify-between"},Gi={class:"flex gap-1"},Li={key:0,class:"space-y-2 p-2 bg-gray-800/30 rounded"},Ui={class:"grid grid-cols-2 gap-2"},Ri={class:"flex gap-1"},Ti={class:"flex gap-1"},Vi={class:"block text-xs text-gray-400 mb-1"},Pi={key:4,class:"space-y-3"},Hi={class:"space-y-2"},Wi={key:0,class:"space-y-2"},_i={class:"max-h-32 overflow-y-auto custom-scrollbar bg-gray-800/30 rounded p-2"},Ji={class:"grid grid-cols-4 gap-2"},qi=["onClick"],Xi=["src","alt"],Yi={key:0,class:"text-xs text-gray-500 text-center py-2"},Ki={class:"grid grid-cols-3 gap-2"},Zi={class:"space-y-2"},Qi={class:"pt-4 border-t border-purple-500/30 space-y-2"},ed={key:1,class:"p-4 text-center text-gray-400 flex-1 flex flex-col justify-center"},td={},rd=Et({...td,__name:"ElementSettingsPanel",props:{selectedEl:{},config:{},fontLibrary:{},fontSizeLibrary:{},fontWeightOptions:{},fontStyleOptions:{},databaseObjects:{},dbMap:{},iconLibrary:{},defaultChartOption:{type:Function},safeHex:{type:Function},initCustomClassSkeleton:{type:Function},refreshAllCustomClassCss:{type:Function},removeCustomClassCssForElement:{type:Function},getIconDataUrlById:{type:Function}},emits:["duplicateSelected","removeSelected","saveSelectedAsComponent"],setup(b,{emit:o}){const e=b,c=o,w=xe("visual"),I=xe(""),_=xe("");mt(()=>{var y;return(y=e.selectedEl)==null?void 0:y.id},()=>{var t;const y=e.selectedEl;y&&y.type==="chart"&&(w.value="visual",_.value="",I.value=JSON.stringify((t=y.chartOption)!=null?t:e.defaultChartOption(y.chartType||"line"),null,2))});const oe=Ge(()=>{var re,Z;const y=(Z=(re=e.selectedEl)==null?void 0:re.dynamic)==null?void 0:Z.objectName;if(!y)return[];const t=e.dbMap[y];try{return Lo(t,{maxDepth:6,maxEntries:400})}catch{return[]}});function $e(y){return Ro(e.dbMap,y)}function C(y){return typeof y=="string"&&y.trim().endsWith("%")?"%":"px"}function pe(y){if(y==null)return 0;if(typeof y=="number")return y;const t=String(y).trim();if(t.endsWith("%")){const Z=Number(t.replace("%",""));return Number.isFinite(Z)?Z:0}const re=Number(t.replace("px",""));return Number.isFinite(re)?re:0}function P(y,t){const re=e.selectedEl;re&&(re.style=re.style||{},re.style.borderRadius=`${y}${t}`)}function K(y){const t={x:0,y:8,blur:24,spread:0,color:"#000000"};if(!y||!y.trim())return t;const re=y.split(/\s+/).filter(Boolean);if(re.length<3)return t;const Z=re.slice(0,4).map(nt=>Number(String(nt).replace("px",""))),rt=re.slice(4).join(" ")||t.color,[Ve=NaN,He=NaN,Ye=NaN,Ke=NaN]=Z;return{x:Number.isFinite(Ve)?Ve:t.x,y:Number.isFinite(He)?He:t.y,blur:Number.isFinite(Ye)?Ye:t.blur,spread:Number.isFinite(Ke)?Ke:t.spread,color:rt}}function se(y,t,re,Z,rt){Bo(e.selectedEl,y,t,re,Z,rt)}function X(y){Do(y)}function k(y){Go(y)}function d(){_.value="";try{const y=JSON.parse(I.value);e.selectedEl&&e.selectedEl.type==="chart"&&(e.selectedEl.chartOption=y)}catch(y){_.value=`JSON 解析失败：${(y==null?void 0:y.message)||String(y)}`}}function U(y,t){if(!e.selectedEl||e.selectedEl.type!=="chart"||!e.selectedEl.chartOption)return;const re=e.selectedEl.chartOption,Z=re.series||[],rt={type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:y},{offset:1,color:t}],global:!1};Z.forEach(Ve=>{Ve.type==="bar"&&(Ve.itemStyle=Ve.itemStyle||{},Ve.itemStyle.color=rt)}),I.value=JSON.stringify(re,null,2)}function H(){const y=e.selectedEl;return!y||y.type!=="chart"?null:(y.chartOption||(y.chartOption=e.defaultChartOption(y.chartType||"line")),y.chartOption)}function Q(y){const t=H();t&&(t.title=t.title||{},t.title.text=y,I.value=JSON.stringify(t,null,2))}function T(y){const t=H();t&&(t.color=y.split(",").map(re=>re.trim()).filter(Boolean),I.value=JSON.stringify(t,null,2))}function J(y){const t=H();t&&(t.legend=t.legend||{},t.legend.show=y==="1",I.value=JSON.stringify(t,null,2))}function we(y){var re;const t=(re=y.target.files)==null?void 0:re[0];if(t&&e.selectedEl){const Z=new FileReader;Z.onload=()=>{e.selectedEl&&(e.selectedEl.src=String(Z.result),e.selectedEl.iconId=void 0)},Z.readAsDataURL(t)}}async function W(y){const t=e.selectedEl;if(!t||t.type!=="image")return;const re=await e.getIconDataUrlById(y.id);if(!re)return;t.src=re,t.iconId=y.id;const Z=new Image;Z.onload=()=>{e.selectedEl&&e.selectedEl.id===t.id&&(e.selectedEl.width=Z.naturalWidth,e.selectedEl.height=Z.naturalHeight)},Z.src=re}function D(){const y=e.selectedEl;if(!y||y.type!=="image"||!y.src)return;const t=new Image;t.onload=()=>{e.selectedEl&&(e.selectedEl.width=t.naturalWidth,e.selectedEl.height=t.naturalHeight)},t.src=y.src}function R(){}const Ae=Ge({get(){const y=e.selectedEl;return!!(y&&y.eventBinding&&y.eventBinding.enabled)},set(y){const t=e.selectedEl;t&&(t.eventBinding=t.eventBinding||{enabled:!1,cursor:"pointer",handlerName:"handleClick",code:""},t.eventBinding.enabled=y,(t.eventBinding.handlerName==null||String(t.eventBinding.handlerName).trim()==="")&&(t.eventBinding.handlerName="handleClick"),(t.eventBinding.cursor==null||String(t.eventBinding.cursor).trim()==="")&&(t.eventBinding.cursor="pointer"),t.eventBinding.code==null&&(t.eventBinding.code=""))}}),v=Ge({get(){var y,t;return(t=(y=e.selectedEl)==null?void 0:y.eventBinding)==null?void 0:t.cursor},set(y){const t=e.selectedEl;t&&(t.eventBinding=t.eventBinding||{enabled:!0,cursor:"pointer",handlerName:"handleClick",code:""},t.eventBinding.cursor=y)}}),q=Ge({get(){var y,t;return(t=(y=e.selectedEl)==null?void 0:y.eventBinding)==null?void 0:t.handlerName},set(y){const t=e.selectedEl;t&&(t.eventBinding=t.eventBinding||{enabled:!0,cursor:"pointer",handlerName:"handleClick",code:""},t.eventBinding.handlerName=y)}}),ne=Ge({get(){var y,t;return(t=(y=e.selectedEl)==null?void 0:y.eventBinding)==null?void 0:t.code},set(y){const t=e.selectedEl;t&&(t.eventBinding=t.eventBinding||{enabled:!0,cursor:"pointer",handlerName:"handleClick",code:""},t.eventBinding.code=y)}});return(y,t)=>{var re,Z,rt,Ve,He,Ye,Ke,nt,vt,ct,At,Fe,ye,pt,gt,yt,St,jt,Se,Ne,Te,Le,et,at,We,Je,it,zt,ht,wt,$t,fr,mr,yr,Mt,Ot,br,Xt,xr,vr,Yt,hr,wr,$r,kr,Kt,Zt,Rt,Tt,Er,Sr,Mr,Bt,bt,Qt,Dt,er,Cr,Nr,Ir,qe,Ct,Fr,Ar,tr,rr,nr,jr,Gt,Vt,Pt,Ht,lr,or,zr,sr,dt,lt,Or,Br,Dr,Gr,Lr,Ur,ar,Wt,_t,ir,Jt,qt,Rr,Lt,dr,Tr,ur,Vr,cr,n,l,s,u,g,p,M,F,N,m,a,E,L,ue,ge,Ie,Me,ve,ce,ee,ae,ie,de,Ce,f,h,z,$,O,le,x,V,G,te,he,fe,Ee,Re,Pe,tt,_e,st,Ze,ft,xt,Nt,Pr,tn,rn,nn,ln,on,sn,an,dn,un,cn,pn,gn,fn,mn,yn,bn,xn,vn,hn,wn,$n,kn,En,Sn,Mn,Cn,Nn,In,Fn,An,jn,zn,On,Bn,Dn,Gn,Ln,Un,Rn,Tn,Vn,Pn,Hn,Wn,_n,Jn,qn,Xn,Yn,Kn,Zn,Qn,el,tl,rl,nl,ll;return A(),j("div",To,[t[234]||(t[234]=r("div",{class:"p-4 border-b border-purple-500/30 bg-gradient-to-r from-purple-600/20 to-pink-600/20 flex-shrink-0"},[r("h2",{class:"text-lg font-bold text-purple-300 flex items-center gap-2"},[r("span",{class:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),gr(" 元素设置 ")])],-1)),e.selectedEl?(A(),j("div",Vo,[r("div",Po,[t[128]||(t[128]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"位置和尺寸",-1)),r("div",Ho,[r("div",null,[t[123]||(t[123]=r("label",{class:"block text-xs text-gray-400 mb-1"},"X",-1)),me(r("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>e.selectedEl.left=i),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.left,void 0,{number:!0}]])]),r("div",null,[t[124]||(t[124]=r("label",{class:"block text-xs text-gray-400 mb-1"},"Y",-1)),me(r("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>e.selectedEl.top=i),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.top,void 0,{number:!0}]])]),r("div",null,[t[125]||(t[125]=r("label",{class:"block text-xs text-gray-400 mb-1"},"宽度",-1)),me(r("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>e.selectedEl.width=i),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.width,void 0,{number:!0}]])]),r("div",null,[t[126]||(t[126]=r("label",{class:"block text-xs text-gray-400 mb-1"},"高度",-1)),me(r("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>e.selectedEl.height=i),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.height,void 0,{number:!0}]])]),r("div",Wo,[t[127]||(t[127]=r("label",{class:"block text-xs text-gray-400 mb-1"},"层级（z-index）",-1)),me(r("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>e.selectedEl.zIndex=i),type:"number",min:"0",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.zIndex,void 0,{number:!0}]])])])]),r("div",_o,[t[135]||(t[135]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"事件绑定",-1)),r("div",Jo,[t[130]||(t[130]=r("label",{class:"text-xs text-gray-400"},"开启事件绑定",-1)),r("label",qo,[me(r("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":t[5]||(t[5]=i=>Ae.value=i)},null,512),[[qr,Ae.value]]),t[129]||(t[129]=r("div",{class:"relative w-12 h-6 rounded-full bg-gray-700/60 transition-all duration-200 shadow-inner peer-checked:bg-gradient-to-r peer-checked:from-cyan-600 peer-checked:to-blue-600"},[r("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 peer-checked:translate-x-6"})],-1)),r("span",{class:Ue(["ml-3 text-xs",Ae.value?"text-cyan-300":"text-gray-300"])},Qe(Ae.value?"已开启":"已关闭"),3)])]),Ae.value?(A(),j("div",Xo,[r("div",null,[t[132]||(t[132]=r("label",{class:"block text-xs text-gray-400 mb-1"},"Cursor",-1)),me(r("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>v.value=i),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},[...t[131]||(t[131]=[Jr('<option value="pointer" data-v-e92e54ba>pointer</option><option value="default" data-v-e92e54ba>default</option><option value="move" data-v-e92e54ba>move</option><option value="crosshair" data-v-e92e54ba>crosshair</option><option value="grab" data-v-e92e54ba>grab</option>',5)])],512),[[sl,v.value]])]),r("div",null,[t[133]||(t[133]=r("label",{class:"block text-xs text-gray-400 mb-1"},"函数名",-1)),me(r("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>q.value=i),type:"text",placeholder:"handleClick",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,512),[[ke,q.value]])])])):Y("",!0),Ae.value?(A(),j("div",Yo,[t[134]||(t[134]=r("label",{class:"block text-xs text-gray-400 mb-1"},"事件代码",-1)),me(r("textarea",{"onUpdate:modelValue":t[8]||(t[8]=i=>ne.value=i),rows:"6",placeholder:"function body...",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,512),[[ke,ne.value]])])):Y("",!0)]),r("div",Ko,[t[145]||(t[145]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"元素属性",-1)),r("div",Zo,[r("div",Qo,[t[136]||(t[136]=r("label",{class:"text-xs text-gray-400"},"启用 Class 样式",-1)),me(r("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=i=>e.selectedEl.enableClassStyle=i),onChange:t[10]||(t[10]=i=>{e.selectedEl&&i.target.checked?(e.initCustomClassSkeleton(e.selectedEl),e.refreshAllCustomClassCss()):e.selectedEl&&!i.target.checked&&e.removeCustomClassCssForElement(e.selectedEl.id)}),class:"rounded border-purple-500/30 text-purple-400 focus:ring-purple-400"},null,544),[[qr,e.selectedEl.enableClassStyle]])]),(re=e.selectedEl)!=null&&re.enableClassStyle?(A(),j("div",es,[t[137]||(t[137]=r("label",{class:"block text-xs text-gray-400 mb-1"},"CSS Class",-1)),r("div",ts,[me(r("input",{"onUpdate:modelValue":t[11]||(t[11]=i=>e.selectedEl.className=i),type:"text",placeholder:"自动生成唯一类名，可修改",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.className]]),r("button",{type:"button",onClick:t[12]||(t[12]=()=>{e.selectedEl&&(e.selectedEl.className=`cls-${String(e.selectedEl.id).slice(0,8)}`,e.initCustomClassSkeleton(e.selectedEl),e.refreshAllCustomClassCss())}),class:"px-2 py-1 text-xs bg-purple-600/60 hover:bg-purple-600 rounded text-white"},"生成默认")])])):Y("",!0),(Z=e.selectedEl)!=null&&Z.enableClassStyle?(A(),j("div",rs,[t[138]||(t[138]=r("label",{class:"block text-xs text-gray-400 mb-1"},"自定义样式（CSS 声明）",-1)),ut(Oo,{modelValue:String((rt=e.selectedEl.customClassCss)!=null?rt:""),"onUpdate:modelValue":t[13]||(t[13]=i=>{e.selectedEl.customClassCss=i,e.refreshAllCustomClassCss()}),height:"180px"},null,8,["modelValue"]),t[139]||(t[139]=r("p",{class:"text-[11px] text-gray-500 mt-1"},"提示：已为当前类名生成 .className { } 模板；也可直接填写声明，系统会自动包裹并追加 !important。",-1))])):Y("",!0),e.selectedEl&&(e.selectedEl.type==="chart"||e.selectedEl.type==="container")?(A(),j("div",ns,[t[140]||(t[140]=r("label",{class:"block text-xs text-gray-400 mb-1"},"元素ID",-1)),me(r("input",{"onUpdate:modelValue":t[14]||(t[14]=i=>e.selectedEl.elementId=i),type:"text",placeholder:"输入元素ID",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.elementId]])])):Y("",!0),e.selectedEl?(A(),j("div",ls,[t[144]||(t[144]=r("h3",{class:"text-sm font-medium text-purple-300"},"显示与隐藏",-1)),r("div",os,[t[142]||(t[142]=r("label",{class:"text-xs text-gray-400"},"隐藏该元素",-1)),r("label",ss,[r("input",{type:"checkbox",class:"sr-only peer",checked:!!e.selectedEl.hidden,onChange:t[15]||(t[15]=i=>{const B=i.target.checked;e.selectedEl&&(e.selectedEl.hidden=B,B&&!e.selectedEl.hiddenLabel&&(e.selectedEl.hiddenLabel=`hidden-${String(e.selectedEl.id).slice(0,8)}`))})},null,40,as),t[141]||(t[141]=r("div",{class:"relative w-12 h-6 rounded-full bg-gray-700/60 transition-all duration-200 shadow-inner peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-pink-600"},[r("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transform transition-transform duration-200 peer-checked:translate-x-6"})],-1)),r("span",{class:Ue(["ml-3 text-xs",e.selectedEl.hidden?"text-purple-300":"text-gray-300"])},Qe(e.selectedEl.hidden?"已隐藏":"显示中"),3)])]),e.selectedEl.hidden?(A(),j("div",is,[t[143]||(t[143]=r("label",{class:"block text-xs text-gray-400"},"隐藏标识",-1)),r("input",{type:"text",value:e.selectedEl.hiddenLabel||"",onInput:t[16]||(t[16]=i=>{e.selectedEl&&(e.selectedEl.hiddenLabel=i.target.value)}),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1",placeholder:"hidden-xxxx"},null,40,ds)])):Y("",!0)])):Y("",!0)])]),e.selectedEl&&e.selectedEl.type==="container"?(A(),j("div",us,[t[167]||(t[167]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"容器样式",-1)),r("div",null,[t[146]||(t[146]=r("label",{class:"block text-xs text-gray-400 mb-1"},"背景色（HEX）",-1)),r("div",cs,[r("input",{type:"color",value:((He=(Ve=e.selectedEl)==null?void 0:Ve.style)==null?void 0:He.backgroundColor)||"#000000",onInput:t[17]||(t[17]=i=>{const B=i.target.value;e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.backgroundColor=B)}),class:"w-10 h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,40,ps),r("input",{type:"text",value:((Ke=(Ye=e.selectedEl)==null?void 0:Ye.style)==null?void 0:Ke.backgroundColor)||"",placeholder:"#1e293b 或 transparent",onInput:t[18]||(t[18]=i=>{const B=i.target.value.trim();e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.backgroundColor=B)}),class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,gs)]),t[147]||(t[147]=r("p",{class:"text-[11px] text-gray-500 mt-1"},"支持 #RGB/#RRGGBB 或 CSS 颜色名；启用渐变时该颜色被覆盖。",-1))]),r("div",null,[t[148]||(t[148]=r("label",{class:"block text-xs text-gray-400 mb-1"},"容器注释（导出可见）",-1)),me(r("textarea",{"onUpdate:modelValue":t[19]||(t[19]=i=>e.selectedEl.comment=i),rows:"2",placeholder:"输入注释，方便代码维护...",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.comment]])]),r("div",fs,[r("div",ms,[t[150]||(t[150]=r("label",{class:"block text-xs text-gray-400 mb-1"},"渐变背景",-1)),r("label",ys,[r("input",{type:"checkbox",checked:!!((vt=(nt=e.selectedEl)==null?void 0:nt.style)!=null&&vt.backgroundGradient),onChange:t[20]||(t[20]=i=>{const B=i.target.checked;e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},B?e.selectedEl.style.backgroundGradient||(e.selectedEl.style.backgroundGradient={colors:["#42b883","#0ea5e9"],angle:90}):delete e.selectedEl.style.backgroundGradient)})},null,40,bs),t[149]||(t[149]=gr(" 启用 ",-1))])]),(At=(ct=e.selectedEl)==null?void 0:ct.style)!=null&&At.backgroundGradient?(A(),j("div",xs,[r("div",null,[t[151]||(t[151]=r("label",{class:"block text-[11px] text-gray-400 mb-1"},"起始色（HEX）",-1)),r("div",vs,[r("input",{type:"color",value:((gt=(pt=(ye=(Fe=e.selectedEl)==null?void 0:Fe.style)==null?void 0:ye.backgroundGradient)==null?void 0:pt.colors)==null?void 0:gt[0])||"#42b883",onInput:t[21]||(t[21]=i=>{var be;const B=i.target.value;if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.colors=(be=S.colors)!=null&&be.length?S.colors:["","#"],S.colors[0]=B,e.selectedEl.style.backgroundGradient=S}),class:"w-10 h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,40,hs),r("input",{type:"text",value:((Se=(jt=(St=(yt=e.selectedEl)==null?void 0:yt.style)==null?void 0:St.backgroundGradient)==null?void 0:jt.colors)==null?void 0:Se[0])||"",placeholder:"#42b883",onInput:t[22]||(t[22]=i=>{var be;const B=i.target.value.trim();if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.colors=(be=S.colors)!=null&&be.length?S.colors:["","#"],S.colors[0]=B,e.selectedEl.style.backgroundGradient=S}),class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,ws)])]),r("div",null,[t[152]||(t[152]=r("label",{class:"block text-[11px] text-gray-400 mb-1"},"结束色（HEX）",-1)),r("div",$s,[r("input",{type:"color",value:((et=(Le=(Te=(Ne=e.selectedEl)==null?void 0:Ne.style)==null?void 0:Te.backgroundGradient)==null?void 0:Le.colors)==null?void 0:et[1])||"#0ea5e9",onInput:t[23]||(t[23]=i=>{var be;const B=i.target.value;if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.colors=(be=S.colors)!=null&&be.length?S.colors:["","#"],S.colors[1]=B,e.selectedEl.style.backgroundGradient=S}),class:"w-10 h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,40,ks),r("input",{type:"text",value:((it=(Je=(We=(at=e.selectedEl)==null?void 0:at.style)==null?void 0:We.backgroundGradient)==null?void 0:Je.colors)==null?void 0:it[1])||"",placeholder:"#0ea5e9",onInput:t[24]||(t[24]=i=>{var be;const B=i.target.value.trim();if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.colors=(be=S.colors)!=null&&be.length?S.colors:["","#"],S.colors[1]=B,e.selectedEl.style.backgroundGradient=S}),class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,Es)])]),r("div",Ss,[t[153]||(t[153]=r("label",{class:"block text-[11px] text-gray-400"},"角度（0-360）",-1)),r("input",{type:"range",min:"0",max:"360",step:"1",value:($t=(wt=(ht=(zt=e.selectedEl)==null?void 0:zt.style)==null?void 0:ht.backgroundGradient)==null?void 0:wt.angle)!=null?$t:90,onInput:t[25]||(t[25]=i=>{const B=Number(i.target.value)||0;if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.angle=B,e.selectedEl.style.backgroundGradient=S}),class:"w-full"},null,40,Ms),r("input",{type:"number",value:(Mt=(yr=(mr=(fr=e.selectedEl)==null?void 0:fr.style)==null?void 0:mr.backgroundGradient)==null?void 0:yr.angle)!=null?Mt:90,onInput:t[26]||(t[26]=i=>{const B=Number(i.target.value)||0;if(!e.selectedEl)return;e.selectedEl.style=e.selectedEl.style||{};const S=e.selectedEl.style.backgroundGradient||{colors:["","#"],angle:90};S.angle=B,e.selectedEl.style.backgroundGradient=S}),class:"w-24 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,Cs)])])):Y("",!0),t[154]||(t[154]=r("p",{class:"text-[11px] text-gray-500"},"提示：仅在启用后显示渐变设置；未启用时使用背景色。",-1))]),r("div",Ns,[r("div",Is,[t[156]||(t[156]=r("label",{class:"block text-xs text-gray-400"},"圆角",-1)),r("label",Fs,[r("input",{type:"checkbox",checked:!!((br=(Ot=e.selectedEl)==null?void 0:Ot.style)!=null&&br.borderRadius)&&pe((xr=(Xt=e.selectedEl)==null?void 0:Xt.style)==null?void 0:xr.borderRadius)>0,onChange:t[27]||(t[27]=i=>{const B=i.target.checked;e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},B?e.selectedEl.style.borderRadius||(e.selectedEl.style.borderRadius="8px"):e.selectedEl.style.borderRadius="0")})},null,40,As),t[155]||(t[155]=gr(" 启用 ",-1))])]),(Yt=(vr=e.selectedEl)==null?void 0:vr.style)!=null&&Yt.borderRadius&&pe((wr=(hr=e.selectedEl)==null?void 0:hr.style)==null?void 0:wr.borderRadius)>=0?(A(),j("div",js,[r("div",zs,[t[157]||(t[157]=r("span",{class:"text-[11px] text-gray-400"},"单位",-1)),r("button",{type:"button",class:Ue(["px-2 py-0.5 rounded text-[11px]",C((kr=($r=e.selectedEl)==null?void 0:$r.style)==null?void 0:kr.borderRadius)==="px"?"bg-purple-600/60":"bg-gray-700"]),onClick:t[28]||(t[28]=()=>{var B,S;const i=pe((S=(B=e.selectedEl)==null?void 0:B.style)==null?void 0:S.borderRadius);P(i,"px")})},"px",2),r("button",{type:"button",class:Ue(["px-2 py-0.5 rounded text-[11px]",C((Zt=(Kt=e.selectedEl)==null?void 0:Kt.style)==null?void 0:Zt.borderRadius)==="%"?"bg-purple-600/60":"bg-gray-700"]),onClick:t[29]||(t[29]=()=>{var B,S;const i=pe((S=(B=e.selectedEl)==null?void 0:B.style)==null?void 0:S.borderRadius);P(i,"%")})},"%",2)]),C((Tt=(Rt=e.selectedEl)==null?void 0:Rt.style)==null?void 0:Tt.borderRadius)==="px"?(A(),j("div",Os,[r("input",{type:"range",min:"0",max:"64",step:"1",value:pe((Sr=(Er=e.selectedEl)==null?void 0:Er.style)==null?void 0:Sr.borderRadius),onInput:t[30]||(t[30]=i=>{const B=Number(i.target.value)||0;P(B,"px")}),class:"w-full"},null,40,Bs),r("input",{type:"number",value:pe((Bt=(Mr=e.selectedEl)==null?void 0:Mr.style)==null?void 0:Bt.borderRadius),onInput:t[31]||(t[31]=i=>{const B=Number(i.target.value)||0;P(B,"px")}),class:"w-24 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,Ds)])):(A(),j("div",Gs,[r("input",{type:"range",min:"0",max:"100",step:"1",value:pe((Qt=(bt=e.selectedEl)==null?void 0:bt.style)==null?void 0:Qt.borderRadius),onInput:t[32]||(t[32]=i=>{const B=Number(i.target.value)||0;P(B,"%")}),class:"w-full"},null,40,Ls),r("div",Us,[r("input",{type:"number",value:pe((er=(Dt=e.selectedEl)==null?void 0:Dt.style)==null?void 0:er.borderRadius),onInput:t[33]||(t[33]=i=>{const B=Number(i.target.value)||0;P(B,"%")}),class:"w-20 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,Rs),t[158]||(t[158]=r("span",{class:"text-xs text-gray-400"},"%",-1))])]))])):Y("",!0)]),r("div",Ts,[r("div",Vs,[t[160]||(t[160]=r("label",{class:"block text-xs text-gray-400"},"阴影（box-shadow）",-1)),r("label",Ps,[r("input",{type:"checkbox",checked:!!((Nr=(Cr=e.selectedEl)==null?void 0:Cr.style)!=null&&Nr.boxShadow),onChange:t[34]||(t[34]=i=>{const B=i.target.checked;e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},B?e.selectedEl.style.boxShadow||(e.selectedEl.style.boxShadow="0 8px 24px rgba(0,0,0,0.25)"):delete e.selectedEl.style.boxShadow)})},null,40,Hs),t[159]||(t[159]=gr(" 启用 ",-1))])]),(qe=(Ir=e.selectedEl)==null?void 0:Ir.style)!=null&&qe.boxShadow?(A(),j("div",Ws,[r("input",{type:"text",value:((Fr=(Ct=e.selectedEl)==null?void 0:Ct.style)==null?void 0:Fr.boxShadow)||"",placeholder:"例如: 0 8px 24px rgba(0,0,0,0.25)",onInput:t[35]||(t[35]=i=>{const B=i.target.value;e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.boxShadow=B)}),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,_s),r("div",Js,[t[161]||(t[161]=r("label",{class:"block text-[11px] text-gray-400"},"X 偏移",-1)),r("div",qs,[r("input",{type:"range",min:"-64",max:"64",step:"1",value:K((tr=(Ar=e.selectedEl)==null?void 0:Ar.style)==null?void 0:tr.boxShadow).x,onInput:t[36]||(t[36]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se(B!=null?B:0,(ze=S.y)!=null?ze:0,(Oe=S.blur)!=null?Oe:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"flex-1"},null,40,Xs),r("input",{type:"number",value:K((nr=(rr=e.selectedEl)==null?void 0:rr.style)==null?void 0:nr.boxShadow).x,onInput:t[37]||(t[37]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se(B!=null?B:0,(ze=S.y)!=null?ze:0,(Oe=S.blur)!=null?Oe:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"w-20 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,Ys)])]),r("div",Ks,[t[162]||(t[162]=r("label",{class:"block text-[11px] text-gray-400"},"Y 偏移",-1)),r("div",Zs,[r("input",{type:"range",min:"-64",max:"64",step:"1",value:K((Gt=(jr=e.selectedEl)==null?void 0:jr.style)==null?void 0:Gt.boxShadow).y,onInput:t[38]||(t[38]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,B!=null?B:0,(Oe=S.blur)!=null?Oe:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"flex-1"},null,40,Qs),r("input",{type:"number",value:K((Pt=(Vt=e.selectedEl)==null?void 0:Vt.style)==null?void 0:Pt.boxShadow).y,onInput:t[39]||(t[39]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,B!=null?B:0,(Oe=S.blur)!=null?Oe:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"w-20 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,ea)])]),r("div",ta,[t[163]||(t[163]=r("label",{class:"block text-[11px] text-gray-400"},"模糊",-1)),r("div",ra,[r("input",{type:"range",min:"0",max:"128",step:"1",value:K((lr=(Ht=e.selectedEl)==null?void 0:Ht.style)==null?void 0:lr.boxShadow).blur,onInput:t[40]||(t[40]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,B!=null?B:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"flex-1"},null,40,na),r("input",{type:"number",value:K((zr=(or=e.selectedEl)==null?void 0:or.style)==null?void 0:zr.boxShadow).blur,onInput:t[41]||(t[41]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,B!=null?B:0,(Be=S.spread)!=null?Be:0,(De=S.color)!=null?De:"#000000")}),class:"w-20 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,la)])]),r("div",oa,[t[164]||(t[164]=r("label",{class:"block text-[11px] text-gray-400"},"扩散",-1)),r("div",sa,[r("input",{type:"range",min:"-64",max:"64",step:"1",value:K((dt=(sr=e.selectedEl)==null?void 0:sr.style)==null?void 0:dt.boxShadow).spread,onInput:t[42]||(t[42]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,(Be=S.blur)!=null?Be:0,B!=null?B:0,(De=S.color)!=null?De:"#000000")}),class:"flex-1"},null,40,aa),r("input",{type:"number",value:K((Or=(lt=e.selectedEl)==null?void 0:lt.style)==null?void 0:Or.boxShadow).spread,onInput:t[43]||(t[43]=i=>{var be,je,ze,Oe,Be,De;const B=Number(i.target.value)||0,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,(Be=S.blur)!=null?Be:0,B!=null?B:0,(De=S.color)!=null?De:"#000000")}),class:"w-20 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs"},null,40,ia)])])])):Y("",!0),r("div",da,[t[165]||(t[165]=r("label",{class:"block text-[11px] text-gray-400"},"阴影颜色",-1)),(Dr=(Br=e.selectedEl)==null?void 0:Br.style)!=null&&Dr.boxShadow?(A(),j("div",ua,[r("input",{type:"color",value:K((Lr=(Gr=e.selectedEl)==null?void 0:Gr.style)==null?void 0:Lr.boxShadow).color||"#000000",onInput:t[44]||(t[44]=i=>{var be,je,ze,Oe,Be,De;const B=i.target.value,S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,(Be=S.blur)!=null?Be:0,(De=S.spread)!=null?De:0,B||"#000000")}),class:"w-10 h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,40,ca),r("input",{type:"text",value:K((ar=(Ur=e.selectedEl)==null?void 0:Ur.style)==null?void 0:ar.boxShadow).color||"",placeholder:"#000000 或 rgba(...)",onInput:t[45]||(t[45]=i=>{var be,je,ze,Oe,Be,De;const B=i.target.value.trim(),S=K((je=(be=e.selectedEl)==null?void 0:be.style)==null?void 0:je.boxShadow);se((ze=S.x)!=null?ze:0,(Oe=S.y)!=null?Oe:0,(Be=S.blur)!=null?Be:0,(De=S.spread)!=null?De:0,B||"#000000")}),class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,pa)])):Y("",!0)]),t[166]||(t[166]=r("p",{class:"text-[11px] text-gray-500"},"支持滑动或数字输入；颜色可选色块与 HEX 文本。",-1))])])):Y("",!0),e.selectedEl&&e.selectedEl.type==="chart"?(A(),j("div",ga,[t[182]||(t[182]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"图表配置",-1)),r("div",fa,[r("button",{onClick:t[46]||(t[46]=i=>w.value="visual"),class:Ue(["px-3 py-1 rounded text-sm",w.value==="visual"?"bg-purple-600/60":"bg-gray-700"])},"可视化",2),r("button",{onClick:t[47]||(t[47]=i=>w.value="json"),class:Ue(["px-3 py-1 rounded text-sm",w.value==="json"?"bg-purple-600/60":"bg-gray-700"])},"JSON",2)]),w.value==="visual"?(A(),j("div",ma,[r("div",null,[t[168]||(t[168]=r("label",{class:"block text-xs text-gray-400 mb-1"},"图表类型",-1)),ut(It,{options:["line","bar","pie","mix"],modelValue:e.selectedEl.chartType||"line","onUpdate:modelValue":t[48]||(t[48]=i=>{e.selectedEl&&(e.selectedEl.chartType=i,e.selectedEl.chartOption=e.defaultChartOption(i),I.value=JSON.stringify(e.selectedEl.chartOption,null,2))})},null,8,["modelValue"])]),r("div",null,[t[169]||(t[169]=r("label",{class:"block text-xs text-gray-400 mb-1"},"标题",-1)),r("input",{value:((ir=(_t=(Wt=e.selectedEl)==null?void 0:Wt.chartOption)==null?void 0:_t.title)==null?void 0:ir.text)||"",onInput:t[49]||(t[49]=i=>Q(i.target.value)),type:"text",placeholder:"输入图表标题",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,ya)]),r("div",ba,[r("div",null,[t[170]||(t[170]=r("label",{class:"block text-xs text-gray-400 mb-1"},"颜色列表（逗号分隔）",-1)),r("input",{value:((Rr=(qt=(Jt=e.selectedEl)==null?void 0:Jt.chartOption)==null?void 0:qt.color)==null?void 0:Rr.join(","))||"",onInput:t[50]||(t[50]=i=>T(i.target.value)),type:"text",placeholder:"#42b883,#ff9800",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,xa)]),r("div",null,[t[172]||(t[172]=r("label",{class:"block text-xs text-gray-400 mb-1"},"显示图例",-1)),r("select",{value:(ur=(Tr=(dr=(Lt=e.selectedEl)==null?void 0:Lt.chartOption)==null?void 0:dr.legend)==null?void 0:Tr.show)==null||ur?"1":"0",onChange:t[51]||(t[51]=i=>J(i.target.value)),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},[...t[171]||(t[171]=[r("option",{value:"1"},"显示",-1),r("option",{value:"0"},"隐藏",-1)])],40,va)])]),e.selectedEl&&e.selectedEl.chartType!=="pie"?(A(),j("div",ha,[r("div",null,[t[173]||(t[173]=r("label",{class:"block text-xs text-gray-400 mb-1"},"Y轴最小值",-1)),r("input",{value:Array.isArray((cr=(Vr=e.selectedEl)==null?void 0:Vr.chartOption)==null?void 0:cr.yAxis)?(g=(u=(s=(l=(n=e.selectedEl)==null?void 0:n.chartOption)==null?void 0:l.yAxis)==null?void 0:s[0])==null?void 0:u.min)!=null?g:"":(N=(F=(M=(p=e.selectedEl)==null?void 0:p.chartOption)==null?void 0:M.yAxis)==null?void 0:F.min)!=null?N:"",onInput:t[52]||(t[52]=i=>{const B=i.target.value;if(!e.selectedEl)return;e.selectedEl.chartOption||(e.selectedEl.chartOption=e.defaultChartOption(e.selectedEl.chartType||"line"));const S=e.selectedEl.chartOption.yAxis,be=B===""?null:Number(B);Array.isArray(S)?(S[0]=S[0]||{},S[0].min=be):(e.selectedEl.chartOption.yAxis=S||{},e.selectedEl.chartOption.yAxis.min=be),I.value=JSON.stringify(e.selectedEl.chartOption,null,2)}),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,wa)]),r("div",null,[t[174]||(t[174]=r("label",{class:"block text-xs text-gray-400 mb-1"},"Y轴最大值",-1)),r("input",{value:Array.isArray((a=(m=e.selectedEl)==null?void 0:m.chartOption)==null?void 0:a.yAxis)?(Ie=(ge=(ue=(L=(E=e.selectedEl)==null?void 0:E.chartOption)==null?void 0:L.yAxis)==null?void 0:ue[0])==null?void 0:ge.max)!=null?Ie:"":(ee=(ce=(ve=(Me=e.selectedEl)==null?void 0:Me.chartOption)==null?void 0:ve.yAxis)==null?void 0:ce.max)!=null?ee:"",onInput:t[53]||(t[53]=i=>{const B=i.target.value;if(!e.selectedEl)return;e.selectedEl.chartOption||(e.selectedEl.chartOption=e.defaultChartOption(e.selectedEl.chartType||"line"));const S=e.selectedEl.chartOption.yAxis,be=B===""?null:Number(B);Array.isArray(S)?(S[0]=S[0]||{},S[0].max=be):(e.selectedEl.chartOption.yAxis=S||{},e.selectedEl.chartOption.yAxis.max=be),I.value=JSON.stringify(e.selectedEl.chartOption,null,2)}),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,40,$a)])])):Y("",!0),e.selectedEl&&(e.selectedEl.chartType==="line"||e.selectedEl.chartType==="mix")?(A(),j("div",ka,[r("div",null,[t[176]||(t[176]=r("label",{class:"block text-xs text-gray-400 mb-1"},"折线平滑",-1)),r("select",{value:"1",onChange:t[54]||(t[54]=i=>{const B=i.target.value==="1";e.selectedEl&&e.selectedEl.chartOption&&((e.selectedEl.chartOption.series||[]).forEach(S=>{S.type==="line"&&(S.smooth=B)}),I.value=JSON.stringify(e.selectedEl.chartOption,null,2))}),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},[...t[175]||(t[175]=[r("option",{value:"1"},"平滑",-1),r("option",{value:"0"},"不平滑",-1)])],32)]),r("div",null,[t[177]||(t[177]=r("label",{class:"block text-xs text-gray-400 mb-1"},"线宽",-1)),r("input",{value:2,onInput:t[55]||(t[55]=i=>{const B=Number(i.target.value)||2;e.selectedEl&&e.selectedEl.chartOption&&((e.selectedEl.chartOption.series||[]).forEach(S=>{S.type==="line"&&(S.lineStyle=S.lineStyle||{},S.lineStyle.width=B)}),I.value=JSON.stringify(e.selectedEl.chartOption,null,2))}),type:"number",min:"1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,32)])])):Y("",!0),e.selectedEl&&(e.selectedEl.chartType==="bar"||e.selectedEl.chartType==="mix")?(A(),j("div",Ea,[r("div",null,[t[178]||(t[178]=r("label",{class:"block text-xs text-gray-400 mb-1"},"柱状渐变起始色",-1)),r("input",{type:"color",value:"#42b883",onInput:t[56]||(t[56]=i=>{const B=i.target.value;U(B,"#0ea5e9")}),class:"w-full h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,32)]),r("div",null,[t[179]||(t[179]=r("label",{class:"block text-xs text-gray-400 mb-1"},"柱状渐变结束色",-1)),r("input",{type:"color",value:"#0ea5e9",onInput:t[57]||(t[57]=i=>{const B=i.target.value;U("#42b883",B)}),class:"w-full h-8 bg-gray-800/50 border border-purple-500/30 rounded"},null,32)]),r("div",null,[t[180]||(t[180]=r("label",{class:"block text-xs text-gray-400 mb-1"},"圆角",-1)),r("input",{value:4,onInput:t[58]||(t[58]=i=>{const B=Number(i.target.value)||0;e.selectedEl&&e.selectedEl.chartOption&&((e.selectedEl.chartOption.series||[]).forEach(S=>{S.type==="bar"&&(S.itemStyle=S.itemStyle||{},S.itemStyle.borderRadius=[B,B,0,0])}),I.value=JSON.stringify(e.selectedEl.chartOption,null,2))}),type:"number",min:"0",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm"},null,32)])])):Y("",!0)])):(A(),j("div",Sa,[t[181]||(t[181]=r("label",{class:"block text-xs text-gray-400 mb-1"},"ECharts Option JSON",-1)),me(r("textarea",{"onUpdate:modelValue":t[59]||(t[59]=i=>I.value=i),rows:"10",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs font-mono"},null,512),[[ke,I.value]]),r("div",Ma,[r("button",{onClick:t[60]||(t[60]=i=>d()),class:"px-3 py-1 bg-emerald-600 rounded text-sm"},"应用配置"),_.value?(A(),j("div",Ca,Qe(_.value),1)):Y("",!0)])]))])):Y("",!0),e.selectedEl&&e.selectedEl.type==="line"?(A(),j("div",Na,[t[190]||(t[190]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"线条设置",-1)),r("div",Ia,[t[183]||(t[183]=r("label",{class:"block text-xs text-gray-400 mb-1"},"颜色",-1)),r("div",Fa,[r("input",{value:e.safeHex(((ie=(ae=e.selectedEl)==null?void 0:ae.style)==null?void 0:ie.lineColor)||""),onInput:t[61]||(t[61]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineColor=i.target.value)}),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,40,Aa),r("input",{value:(f=(Ce=(de=e.selectedEl)==null?void 0:de.style)==null?void 0:Ce.lineColor)!=null?f:"#ffffff",onInput:t[62]||(t[62]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineColor=i.target.value)}),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"#ffffff"},null,40,ja)])]),r("div",za,[r("div",null,[t[184]||(t[184]=r("label",{class:"block text-xs text-gray-400 mb-1"},"方向",-1)),r("div",Oa,[r("button",{onClick:t[63]||(t[63]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineOrientation="horizontal")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((z=(h=e.selectedEl)==null?void 0:h.style)==null?void 0:z.lineOrientation)||"horizontal")==="horizontal"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"横向",2),r("button",{onClick:t[64]||(t[64]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineOrientation="vertical")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((O=($=e.selectedEl)==null?void 0:$.style)==null?void 0:O.lineOrientation)||"horizontal")==="vertical"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"纵向",2)])]),r("div",null,[t[185]||(t[185]=r("label",{class:"block text-xs text-gray-400 mb-1"},"粗细(px)",-1)),r("input",{value:(V=(x=(le=e.selectedEl)==null?void 0:le.style)==null?void 0:x.lineThickness)!=null?V:2,onInput:t[65]||(t[65]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineThickness=Number(i.target.value))}),type:"number",min:"1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,Ba)])]),r("div",Da,[r("div",null,[t[187]||(t[187]=r("label",{class:"block text-xs text-gray-400 mb-1"},"样式",-1)),r("select",{value:((te=(G=e.selectedEl)==null?void 0:G.style)==null?void 0:te.lineStyle)||"solid",onChange:t[66]||(t[66]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineStyle=i.target.value)}),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},[...t[186]||(t[186]=[r("option",{value:"solid"},"实线",-1),r("option",{value:"dashed"},"虚线",-1)])],40,Ga)]),((fe=(he=e.selectedEl)==null?void 0:he.style)==null?void 0:fe.lineStyle)==="dashed"?(A(),j("div",La,[t[188]||(t[188]=r("label",{class:"block text-xs text-gray-400 mb-1"},"虚线长度(px)",-1)),r("input",{value:(Pe=(Re=(Ee=e.selectedEl)==null?void 0:Ee.style)==null?void 0:Re.lineDashLength)!=null?Pe:6,onInput:t[67]||(t[67]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineDashLength=Number(i.target.value))}),type:"number",min:"1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,Ua)])):Y("",!0)]),((_e=(tt=e.selectedEl)==null?void 0:tt.style)==null?void 0:_e.lineStyle)==="dashed"?(A(),j("div",Ra,[r("div",null,[t[189]||(t[189]=r("label",{class:"block text-xs text-gray-400 mb-1"},"虚线间距(px)",-1)),r("input",{value:(ft=(Ze=(st=e.selectedEl)==null?void 0:st.style)==null?void 0:Ze.lineDashGap)!=null?ft:4,onInput:t[68]||(t[68]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineDashGap=Number(i.target.value))}),type:"number",min:"0",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,Ta)])])):Y("",!0)])):Y("",!0),e.selectedEl&&e.selectedEl.type==="text"?(A(),j("div",Va,[t[223]||(t[223]=r("h3",{class:"text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1"},"文本设置",-1)),r("div",Pa,[t[195]||(t[195]=r("label",{class:"block text-xs text-gray-400 mb-1"},"内容",-1)),me(r("textarea",{"onUpdate:modelValue":t[69]||(t[69]=i=>e.selectedEl.text=i),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200 resize-none",rows:"2"},null,512),[[ke,e.selectedEl.text]]),r("div",Ha,[t[194]||(t[194]=r("label",{class:"block text-xs text-gray-400 mb-1"},"动态值",-1)),r("div",Wa,[r("input",{type:"checkbox",checked:!!((Nt=(xt=e.selectedEl)==null?void 0:xt.dynamic)!=null&&Nt.enabled),onChange:t[70]||(t[70]=i=>{e.selectedEl&&(e.selectedEl.dynamic=e.selectedEl.dynamic||{enabled:!1,objectName:"",propertyPath:""},e.selectedEl.dynamic.enabled=i.target.checked)}),class:"rounded accent-purple-600"},null,40,_a),t[191]||(t[191]=r("span",{class:"text-xs text-gray-400"},"启用后从数据库对象绑定",-1))]),(tn=(Pr=e.selectedEl)==null?void 0:Pr.dynamic)!=null&&tn.enabled?(A(),j("div",Ja,[r("div",null,[t[192]||(t[192]=r("label",{class:"block text-xs text-gray-400 mb-1"},"选择对象",-1)),ut(It,{options:e.databaseObjects.map(i=>i.name),modelValue:((nn=(rn=e.selectedEl)==null?void 0:rn.dynamic)==null?void 0:nn.objectName)||"","onUpdate:modelValue":t[71]||(t[71]=i=>{e.selectedEl&&(e.selectedEl.dynamic=e.selectedEl.dynamic||{enabled:!0,objectName:"",propertyPath:""},e.selectedEl.dynamic.objectName=String(i||""))})},null,8,["options","modelValue"])]),r("div",null,[t[193]||(t[193]=r("label",{class:"block text-xs text-gray-400 mb-1"},"属性路径",-1)),ut(It,{options:oe.value,modelValue:((on=(ln=e.selectedEl)==null?void 0:ln.dynamic)==null?void 0:on.propertyPath)||"","onUpdate:modelValue":t[72]||(t[72]=i=>{e.selectedEl&&(e.selectedEl.dynamic=e.selectedEl.dynamic||{enabled:!0,objectName:"",propertyPath:""},e.selectedEl.dynamic.propertyPath=String(i||""))})},null,8,["options","modelValue"])]),r("div",qa,"预览值: "+Qe($e(e.selectedEl)),1)])):Y("",!0)])]),r("div",Xa,[t[196]||(t[196]=r("label",{class:"block text-xs text-gray-400 mb-1"},"尺寸模式",-1)),r("div",Ya,[r("button",{onClick:t[73]||(t[73]=()=>{const i=e.selectedEl;!i||i.type!=="text"||(i.autoSize=!0)}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",e.selectedEl.autoSize!==!1?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"自适应",2),r("button",{onClick:t[74]||(t[74]=()=>{const i=e.selectedEl;!i||i.type!=="text"||(i.autoSize=!1)}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",e.selectedEl.autoSize===!1?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"固定尺寸",2)])]),r("div",Ka,[r("div",null,[t[197]||(t[197]=r("label",{class:"block text-xs text-gray-400 mb-1"},"字号",-1)),ut(It,{options:e.fontSizeLibrary,modelValue:((sn=e.selectedEl.style)==null?void 0:sn.fontSize)||14,"onUpdate:modelValue":t[75]||(t[75]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.fontSize=i)}),numeric:!0},null,8,["options","modelValue"])]),r("div",null,[t[198]||(t[198]=r("label",{class:"block text-xs text-gray-400 mb-1"},"字体",-1)),ut(It,{options:e.fontLibrary,modelValue:((an=e.selectedEl.style)==null?void 0:an.fontFamily)||e.config.globalFontFamily,"onUpdate:modelValue":t[76]||(t[76]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.fontFamily=i)})},null,8,["options","modelValue"])])]),r("div",Za,[r("div",null,[t[199]||(t[199]=r("label",{class:"block text-xs text-gray-400 mb-1"},"粗细",-1)),ut(It,{options:e.fontWeightOptions,modelValue:((dn=e.selectedEl.style)==null?void 0:dn.fontWeight)||"400","onUpdate:modelValue":t[77]||(t[77]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.fontWeight=i)})},null,8,["options","modelValue"])]),r("div",null,[t[200]||(t[200]=r("label",{class:"block text-xs text-gray-400 mb-1"},"样式",-1)),ut(It,{options:e.fontStyleOptions,modelValue:((un=e.selectedEl.style)==null?void 0:un.fontStyle)||"normal","onUpdate:modelValue":t[78]||(t[78]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.fontStyle=i)})},null,8,["options","modelValue"])])]),r("div",Qa,[r("div",null,[t[201]||(t[201]=r("label",{class:"block text-xs text-gray-400 mb-1"},"字间距",-1)),r("input",{value:((cn=e.selectedEl.style)==null?void 0:cn.letterSpacing)||0,onInput:t[79]||(t[79]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.letterSpacing=Number(i.target.value))}),type:"number",step:"0.1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,ei)]),r("div",null,[t[202]||(t[202]=r("label",{class:"block text-xs text-gray-400 mb-1"},"行高",-1)),r("input",{value:((pn=e.selectedEl.style)==null?void 0:pn.lineHeight)||1.5,onInput:t[80]||(t[80]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.lineHeight=Number(i.target.value))}),type:"number",step:"0.1",min:"0.5",max:"3",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,40,ti)])]),r("div",ri,[t[203]||(t[203]=r("label",{class:"block text-xs text-gray-400 mb-1"},"颜色",-1)),r("div",ni,[r("input",{value:(fn=(gn=e.selectedEl)==null?void 0:gn.style)!=null&&fn.textGradient?"#000000":((yn=(mn=e.selectedEl)==null?void 0:mn.style)==null?void 0:yn.color)||e.config.globalColor,onInput:t[81]||(t[81]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.color=i.target.value)}),type:"color",disabled:!!((xn=(bn=e.selectedEl)==null?void 0:bn.style)!=null&&xn.textGradient),class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"},null,40,li),r("input",{value:(hn=(vn=e.selectedEl)==null?void 0:vn.style)!=null&&hn.textGradient?"transparent":(kn=($n=(wn=e.selectedEl)==null?void 0:wn.style)==null?void 0:$n.color)!=null?kn:e.config.globalColor,onInput:t[82]||(t[82]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.color=i.target.value)}),type:"text",disabled:!!((Sn=(En=e.selectedEl)==null?void 0:En.style)!=null&&Sn.textGradient),class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",placeholder:"#000000"},null,40,oi)]),(Cn=(Mn=e.selectedEl)==null?void 0:Mn.style)!=null&&Cn.textGradient?(A(),j("div",si,"文字渐变启用时，文字颜色自动设为透明")):Y("",!0)]),r("div",ai,[t[204]||(t[204]=r("label",{class:"block text-xs text-gray-400 mb-1"},"背景色",-1)),r("div",ii,[r("input",{value:e.safeHex(((In=(Nn=e.selectedEl)==null?void 0:Nn.style)==null?void 0:In.backgroundColor)||""),onInput:t[83]||(t[83]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.backgroundColor=i.target.value)}),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,40,di),r("input",{value:(jn=(An=(Fn=e.selectedEl)==null?void 0:Fn.style)==null?void 0:An.backgroundColor)!=null?jn:"transparent",onInput:t[84]||(t[84]=i=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.backgroundColor=i.target.value)}),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"transparent"},null,40,ui)])]),r("div",ci,[t[205]||(t[205]=r("label",{class:"block text-xs text-gray-400 mb-1"},"文本对齐",-1)),r("div",pi,[r("button",{onClick:t[85]||(t[85]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textAlign="left")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((zn=e.selectedEl.style)==null?void 0:zn.textAlign)||"left")==="left"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"左对齐",2),r("button",{onClick:t[86]||(t[86]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textAlign="center")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((On=e.selectedEl.style)==null?void 0:On.textAlign)||"left")==="center"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"居中",2),r("button",{onClick:t[87]||(t[87]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textAlign="right")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Bn=e.selectedEl.style)==null?void 0:Bn.textAlign)||"left")==="right"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"右对齐",2)])]),r("div",gi,[t[206]||(t[206]=r("label",{class:"block text-xs text-gray-400 mb-1"},"文本方向",-1)),r("div",fi,[r("button",{onClick:t[88]||(t[88]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textOrientation="horizontal")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Gn=(Dn=e.selectedEl)==null?void 0:Dn.style)==null?void 0:Gn.textOrientation)||"horizontal")==="horizontal"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"横向",2),r("button",{onClick:t[89]||(t[89]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textOrientation="vertical")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Un=(Ln=e.selectedEl)==null?void 0:Ln.style)==null?void 0:Un.textOrientation)||"horizontal")==="vertical"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"纵向",2)]),t[207]||(t[207]=r("p",{class:"text-[11px] text-gray-400"},"纵向使用 CSS writing-mode 展示，适合竖排文本。",-1))]),r("div",mi,[t[209]||(t[209]=r("label",{class:"block text-xs text-gray-400 mb-1"},"布局倾斜",-1)),r("div",yi,[me(r("input",{"onUpdate:modelValue":t[90]||(t[90]=i=>e.selectedEl.style.skewAngle=i),type:"range",min:"-45",max:"45",class:"flex-1"},null,512),[[ke,e.selectedEl.style.skewAngle,void 0,{number:!0}]]),me(r("input",{"onUpdate:modelValue":t[91]||(t[91]=i=>e.selectedEl.style.skewAngle=i),type:"number",min:"-45",max:"45",class:"w-16 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.style.skewAngle,void 0,{number:!0}]])]),r("div",bi,[t[208]||(t[208]=r("label",{class:"text-xs text-gray-400"},"布局倾斜跟随",-1)),r("button",{onClick:t[92]||(t[92]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.skewFlowEnabled=!0)}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(Tn=(Rn=e.selectedEl)==null?void 0:Rn.style)!=null&&Tn.skewFlowEnabled?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"开",2),r("button",{onClick:t[93]||(t[93]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.skewFlowEnabled=!1)}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(Pn=(Vn=e.selectedEl)==null?void 0:Vn.style)!=null&&Pn.skewFlowEnabled?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-purple-600 text-white"])},"关",2)]),t[210]||(t[210]=r("p",{class:"text-[11px] text-gray-400"},"调整整体容器的 X 轴倾斜角度（-45° ~ 45°）。启用“跟随”后，文本布局按父视图倾斜线性排布，字符保持正立，可与波形叠加。",-1))]),r("div",xi,[r("div",vi,[t[211]||(t[211]=r("label",{class:"text-xs text-gray-400"},"文本波形",-1)),r("div",hi,[(_n=(Wn=(Hn=e.selectedEl)==null?void 0:Hn.style)==null?void 0:Wn.textWave)!=null&&_n.enabled?(A(),j("button",{key:1,onClick:t[95]||(t[95]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textWave={enabled:!1})}),class:"px-2 py-1 bg-red-600/30 hover:bg-red-600/50 text-red-300 rounded text-xs transition-colors duration-200"},"关闭")):(A(),j("button",{key:0,onClick:t[94]||(t[94]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textWave={enabled:!0,amplitude:8,frequency:.5,phase:0})}),class:"px-2 py-1 bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded text-xs transition-colors duration-200"},"启用"))])]),(Xn=(qn=(Jn=e.selectedEl)==null?void 0:Jn.style)==null?void 0:qn.textWave)!=null&&Xn.enabled?(A(),j("div",wi,[r("div",$i,[t[212]||(t[212]=r("label",{class:"block text-xs text-gray-400 mb-1"},"幅度(px)",-1)),me(r("input",{"onUpdate:modelValue":t[96]||(t[96]=i=>e.selectedEl.style.textWave.amplitude=i),type:"number",min:"0",max:"100",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.style.textWave.amplitude,void 0,{number:!0}]])]),r("div",ki,[t[213]||(t[213]=r("label",{class:"block text-xs text-gray-400 mb-1"},"频率(rad/字)",-1)),me(r("input",{"onUpdate:modelValue":t[97]||(t[97]=i=>e.selectedEl.style.textWave.frequency=i),type:"number",step:"0.1",min:"0.1",max:"10",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.style.textWave.frequency,void 0,{number:!0}]])]),r("div",Ei,[t[214]||(t[214]=r("label",{class:"block text-xs text-gray-400 mb-1"},"相位(rad)",-1)),me(r("input",{"onUpdate:modelValue":t[98]||(t[98]=i=>e.selectedEl.style.textWave.phase=i),type:"number",step:"0.1",min:"-100",max:"100",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.style.textWave.phase,void 0,{number:!0}]])])])):Y("",!0),t[215]||(t[215]=r("p",{class:"text-[11px] text-gray-400"},"每个字符沿 Y 轴按正弦位移，字符保持正立。",-1))]),r("div",Si,[t[216]||(t[216]=r("label",{class:"block text-xs text-gray-400 mb-1"},"文本装饰",-1)),r("div",Mi,[r("button",{onClick:t[99]||(t[99]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textDecoration=e.selectedEl.style.textDecoration==="underline"?"none":"underline")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Yn=e.selectedEl.style)==null?void 0:Yn.textDecoration)||"none")==="underline"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"下划线",2),r("button",{onClick:t[100]||(t[100]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textDecoration=e.selectedEl.style.textDecoration==="line-through"?"none":"line-through")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Kn=e.selectedEl.style)==null?void 0:Kn.textDecoration)||"none")==="line-through"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"删除线",2),r("button",{onClick:t[101]||(t[101]=()=>{e.selectedEl&&(e.selectedEl.style=e.selectedEl.style||{},e.selectedEl.style.textDecoration="none")}),class:Ue(["px-2 py-1 text-xs rounded transition-colors duration-200",(((Zn=e.selectedEl.style)==null?void 0:Zn.textDecoration)||"none")==="none"?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"])},"无",2)])]),r("div",Ci,[r("div",Ni,[t[217]||(t[217]=r("label",{class:"text-xs text-gray-400"},"文本渐变",-1)),r("div",Ii,[(Qn=e.selectedEl.style)!=null&&Qn.textGradient?Y("",!0):(A(),j("button",{key:0,onClick:t[102]||(t[102]=i=>X(e.selectedEl)),class:"px-2 py-1 bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded text-xs transition-colors duration-200"},"启用")),(el=e.selectedEl.style)!=null&&el.textGradient?(A(),j("button",{key:1,onClick:t[103]||(t[103]=()=>{e.selectedEl&&e.selectedEl.style&&(e.selectedEl.style.textGradient=void 0)}),class:"px-2 py-1 bg-red-600/30 hover:bg-red-600/50 text-red-300 rounded text-xs transition-colors duration-200"},"关闭")):Y("",!0)])]),(tl=e.selectedEl.style)!=null&&tl.textGradient?(A(),j("div",Fi,[r("div",Ai,[r("div",null,[t[218]||(t[218]=r("label",{class:"block text-xs text-gray-400 mb-1"},"起始色",-1)),r("div",ji,[me(r("input",{"onUpdate:modelValue":t[104]||(t[104]=i=>e.selectedEl.style.textGradient.colors[0]=i),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,512),[[ke,e.selectedEl.style.textGradient.colors[0]]]),me(r("input",{"onUpdate:modelValue":t[105]||(t[105]=i=>e.selectedEl.style.textGradient.colors[0]=i),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"#DFDD5A"},null,512),[[ke,e.selectedEl.style.textGradient.colors[0]]])])]),r("div",null,[t[219]||(t[219]=r("label",{class:"block text-xs text-gray-400 mb-1"},"结束色",-1)),r("div",zi,[me(r("input",{"onUpdate:modelValue":t[106]||(t[106]=i=>e.selectedEl.style.textGradient.colors[1]=i),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,512),[[ke,e.selectedEl.style.textGradient.colors[1]]]),me(r("input",{"onUpdate:modelValue":t[107]||(t[107]=i=>e.selectedEl.style.textGradient.colors[1]=i),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"#FFFFFF"},null,512),[[ke,e.selectedEl.style.textGradient.colors[1]]])])])]),r("div",null,[r("label",Oi,"角度: "+Qe(e.selectedEl.style.textGradient.angle||0)+"°",1),me(r("input",{"onUpdate:modelValue":t[108]||(t[108]=i=>e.selectedEl.style.textGradient.angle=i),type:"range",min:"0",max:"360",class:"w-full"},null,512),[[ke,e.selectedEl.style.textGradient.angle,void 0,{number:!0}]])])])):Y("",!0)]),r("div",Bi,[r("div",Di,[t[220]||(t[220]=r("label",{class:"text-xs text-gray-400"},"背景渐变",-1)),r("div",Gi,[(rl=e.selectedEl.style)!=null&&rl.backgroundGradient?Y("",!0):(A(),j("button",{key:0,onClick:t[109]||(t[109]=i=>k(e.selectedEl)),class:"px-2 py-1 bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded text-xs transition-colors duration-200"},"启用")),(nl=e.selectedEl.style)!=null&&nl.backgroundGradient?(A(),j("button",{key:1,onClick:t[110]||(t[110]=()=>{e.selectedEl&&e.selectedEl.style&&(e.selectedEl.style.backgroundGradient=void 0)}),class:"px-2 py-1 bg-red-600/30 hover:bg-red-600/50 text-red-300 rounded text-xs transition-colors duration-200"},"关闭")):Y("",!0)])]),(ll=e.selectedEl.style)!=null&&ll.backgroundGradient?(A(),j("div",Li,[r("div",Ui,[r("div",null,[t[221]||(t[221]=r("label",{class:"block text-xs text-gray-400 mb-1"},"起始色",-1)),r("div",Ri,[me(r("input",{"onUpdate:modelValue":t[111]||(t[111]=i=>e.selectedEl.style.backgroundGradient.colors[0]=i),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,512),[[ke,e.selectedEl.style.backgroundGradient.colors[0]]]),me(r("input",{"onUpdate:modelValue":t[112]||(t[112]=i=>e.selectedEl.style.backgroundGradient.colors[0]=i),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"#00A3FF"},null,512),[[ke,e.selectedEl.style.backgroundGradient.colors[0]]])])]),r("div",null,[t[222]||(t[222]=r("label",{class:"block text-xs text-gray-400 mb-1"},"结束色",-1)),r("div",Ti,[me(r("input",{"onUpdate:modelValue":t[113]||(t[113]=i=>e.selectedEl.style.backgroundGradient.colors[1]=i),type:"color",class:"w-8 h-6 bg-gray-800/50 border border-purple-500/30 rounded cursor-pointer"},null,512),[[ke,e.selectedEl.style.backgroundGradient.colors[1]]]),me(r("input",{"onUpdate:modelValue":t[114]||(t[114]=i=>e.selectedEl.style.backgroundGradient.colors[1]=i),type:"text",class:"flex-1 px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-xs focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200",placeholder:"#ffffff"},null,512),[[ke,e.selectedEl.style.backgroundGradient.colors[1]]])])])]),r("div",null,[r("label",Vi,"角度: "+Qe(e.selectedEl.style.backgroundGradient.angle||0)+"°",1),me(r("input",{"onUpdate:modelValue":t[115]||(t[115]=i=>e.selectedEl.style.backgroundGradient.angle=i),type:"range",min:"0",max:"360",class:"w-full"},null,512),[[ke,e.selectedEl.style.backgroundGradient.angle,void 0,{number:!0}]])])])):Y("",!0)])])):Y("",!0),e.selectedEl&&e.selectedEl.type==="image"?(A(),j("div",Pi,[t[232]||(t[232]=Jr('<h3 class="text-sm font-medium text-purple-300 border-b border-purple-500/30 pb-1" data-v-e92e54ba>图片设置</h3><div class="space-y-2" data-v-e92e54ba><label class="block text-xs text-gray-400 mb-1" data-v-e92e54ba>图片来源</label><div class="grid grid-cols-2 gap-2" data-v-e92e54ba><button class="px-3 py-2 bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 rounded text-xs transition-colors duration-200" data-v-e92e54ba>上传文件</button><button class="px-3 py-2 bg-green-600/30 hover:bg-green-600/50 text-green-300 rounded text-xs transition-colors duration-200" data-v-e92e54ba>选择图标</button></div></div>',2)),r("div",Hi,[t[224]||(t[224]=r("label",{class:"block text-xs text-gray-400 mb-1"},"图片文件",-1)),r("input",{type:"file",onChange:we,accept:"image/*",class:"w-full text-xs text-gray-300 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:bg-purple-600 file:text-white hover:file:bg-purple-500 file:cursor-pointer"},null,32)]),e.iconLibrary.length>0?(A(),j("div",Wi,[t[225]||(t[225]=r("label",{class:"block text-xs text-gray-400 mb-1"},"选择图标",-1)),r("div",_i,[r("div",Ji,[(A(!0),j(Ft,null,Ut(e.iconLibrary,i=>(A(),j("div",{key:i.id,onClick:B=>W(i),class:"aspect-square bg-gray-700/50 rounded cursor-pointer hover:bg-gray-600/50 transition-colors duration-200 flex items-center justify-center p-1 border border-transparent hover:border-green-400/50"},[r("img",{src:i.url,alt:i.name,class:"max-w-full max-h-full object-contain",loading:"lazy"},null,8,Xi)],8,qi))),128))])]),e.iconLibrary.length===0?(A(),j("div",Yi,"暂无图标，请先在图标库管理中上传图标")):Y("",!0)])):Y("",!0),r("div",{class:"space-y-2"},[t[226]||(t[226]=r("label",{class:"block text-xs text-gray-400 mb-1"},"尺寸模式",-1)),r("div",{class:"grid grid-cols-2 gap-2"},[r("button",{onClick:D,class:Ue(["px-3 py-2 rounded text-xs transition-colors duration-200","bg-blue-600/30 hover:bg-blue-600/50 text-blue-300"])},"自适应（原始尺寸）"),r("button",{onClick:R,class:Ue(["px-3 py-2 rounded text-xs transition-colors duration-200","bg-purple-600/30 hover:bg-purple-600/50 text-purple-300"])},"固定大小")])]),r("div",Ki,[r("div",null,[t[227]||(t[227]=r("label",{class:"block text-xs text-gray-400 mb-1"},"宽度(px)",-1)),me(r("input",{"onUpdate:modelValue":t[116]||(t[116]=i=>e.selectedEl.width=i),type:"number",min:"1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.width,void 0,{number:!0}]])]),r("div",null,[t[228]||(t[228]=r("label",{class:"block text-xs text-gray-400 mb-1"},"高度(px)",-1)),me(r("input",{"onUpdate:modelValue":t[117]||(t[117]=i=>e.selectedEl.height=i),type:"number",min:"1",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.height,void 0,{number:!0}]])]),r("div",null,[t[230]||(t[230]=r("label",{class:"block text-xs text-gray-400 mb-1"},"对象适配",-1)),me(r("select",{"onUpdate:modelValue":t[118]||(t[118]=i=>e.selectedEl.style.objectFit=i),class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},[...t[229]||(t[229]=[Jr('<option value="contain" data-v-e92e54ba>contain（完整显示）</option><option value="cover" data-v-e92e54ba>cover（填充裁剪）</option><option value="fill" data-v-e92e54ba>fill（拉伸填充）</option><option value="scale-down" data-v-e92e54ba>scale-down（缩小适配）</option><option value="none" data-v-e92e54ba>none（不适配）</option>',5)])],512),[[sl,e.selectedEl.style.objectFit]])])]),r("div",Zi,[t[231]||(t[231]=r("label",{class:"block text-xs text-gray-400 mb-1"},"圆角",-1)),me(r("input",{"onUpdate:modelValue":t[119]||(t[119]=i=>e.selectedEl.style.borderRadius=i),type:"number",class:"w-full px-2 py-1 bg-gray-800/50 border border-purple-500/30 rounded text-gray-100 text-sm focus:border-purple-400 focus:ring-1 focus:ring-purple-400 focus:outline-none transition-all duration-200"},null,512),[[ke,e.selectedEl.style.borderRadius,void 0,{number:!0}]])])])):Y("",!0),r("div",Qi,[r("button",{onClick:t[120]||(t[120]=i=>c("saveSelectedAsComponent")),class:"w-full px-3 py-2 bg-gradient-to-r from-purple-600 to-fuchsia-600 hover:from-purple-500 hover:to-fuchsia-500 text-white rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-purple-500/25"},"保存为组件"),r("button",{onClick:t[121]||(t[121]=i=>c("duplicateSelected")),class:"w-full px-3 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-blue-500/25"},"复制元素"),r("button",{onClick:t[122]||(t[122]=i=>c("removeSelected")),class:"w-full px-3 py-2 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-500 hover:to-pink-500 text-white rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-red-500/25"},"删除元素")])])):Y("",!0),e.selectedEl?Y("",!0):(A(),j("div",ed,[...t[233]||(t[233]=[r("div",{class:"w-16 h-16 mx-auto mb-4 border-2 border-dashed border-gray-600 rounded-lg flex items-center justify-center"},[r("span",{class:"text-2xl"},"📝")],-1),r("p",{class:"text-sm"},"选择一个元素来编辑其属性",-1)])]))])}}}),nd=en(rd,[["__scopeId","data-v-e92e54ba"]]),ld={class:"h-full bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white relative overflow-hidden min-w-[1200px]"},od={class:"relative z-10 flex h-full min-h-[600px] gap-4 p-4"},sd={class:"flex-1 min-w-0 flex flex-col bg-gray-900/60 backdrop-blur-sm border border-purple-500/30 rounded-xl shadow-2xl shadow-purple-500/20"},ad={class:"flex items-center justify-between p-4 border-b border-purple-500/30 bg-gradient-to-r from-purple-600/20 to-pink-600/20 flex-shrink-0"},id={class:"flex gap-2"},dd={class:"relative"},ud={class:"grid grid-cols-2 gap-2"},cd={class:"flex items-center gap-2"},pd={class:"text-sm text-gray-400 min-w-[60px] text-center"},gd={key:0,class:"absolute inset-0 pointer-events-none z-50"},fd={key:1,class:"absolute inset-0 z-[9999] select-none pointer-events-none"},md={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},yd={class:"relative w-[800px] max-w-[90vw] bg-gray-900/90 backdrop-blur-md border border-fuchsia-500/40 rounded-xl shadow-2xl"},bd={class:"p-4 space-y-3"},xd={class:"flex items-center gap-2"},vd={key:0,class:"text-center text-sm text-gray-400 py-6"},hd={key:1},wd={key:0,class:"text-center text-sm text-gray-400 py-6"},$d={key:1,class:"grid grid-cols-3 gap-3"},kd={class:"aspect-video bg-gray-700/50 flex items-center justify-center"},Ed=["src"],Sd={key:1,class:"text-gray-400 text-xs"},Md={class:"p-3 space-y-1"},Cd={class:"flex items-center justify-between"},Nd=["title"],Id={class:"text-xs text-gray-500"},Fd={class:"flex flex-wrap gap-1 mt-1"},Ad={class:"pt-2"},jd=["onClick"],zd={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Od={class:"relative w-[600px] max-w-[90vw] bg-gray-900/90 backdrop-blur-md border border-cyan-500/40 rounded-xl shadow-2xl"},Bd={class:"flex items-center justify-between p-4 border-b border-cyan-500/30 bg-gradient-to-r from-cyan-600/20 to-blue-600/20"},Dd={class:"p-4 space-y-3 max-h-[50vh] overflow-y-auto"},Gd={key:0,class:"text-center text-sm text-gray-400 py-6"},Ld={key:1,class:"space-y-2"},Ud=["title"],Rd=["onClick"],Td=50,Vd=Et({__name:"LowCodeBuilder",props:{projectId:{},currentProject:{},isComponent:{type:Boolean}},setup(b){const o=b,e=Cl(),c=Fl(),w=Ge(()=>{var n;return(n=o.projectId)!=null?n:e.params.id?String(e.params.id):void 0}),I=xe(null);async function _(){if(w.value)try{const n=(await $e()).transaction(["projects"],"readonly").objectStore("projects").get(w.value);n.onsuccess=()=>{I.value=n.result}}catch(n){console.error("加载项目信息失败:",n)}}function oe(){if(!w.value)return;const n=o.isComponent?{path:`/project/${w.value}/preview`,query:{type:"component"}}:{path:`/project/${w.value}/preview`},l=c.resolve(n).href;window.open(l,"_blank")}async function $e(){return new Promise((n,l)=>{const s="lowcode-projects",u="projects",g=indexedDB.open(s);g.onerror=()=>l(g.error),g.onupgradeneeded=()=>{const p=g.result;p.objectStoreNames.contains(u)||p.createObjectStore(u,{keyPath:"id"})},g.onsuccess=()=>{const p=g.result;if(p.objectStoreNames.contains(u))n(p);else{const M=p.version+1;p.close();const F=indexedDB.open(s,M);F.onerror=()=>l(F.error),F.onupgradeneeded=()=>{const N=F.result;N.objectStoreNames.contains(u)||N.createObjectStore(u,{keyPath:"id"})},F.onsuccess=()=>n(F.result)}}})}const C=ol({width:1024,height:576,backgroundUrl:"",backgroundColor:"#000000",globalFontFamily:"Arial, Helvetica, sans-serif",globalFontSize:14,globalColor:"#FFFFFF"}),pe=xe("GeneratedComponent"),P=xe(["Arial, Helvetica, sans-serif","PingFang SC","Microsoft YaHei","Roboto","Inter"]),K=xe([8,9,10,11,12,14,16,18,20,24,28,32,36,48,64]),se=xe(["100","200","300","400","500","600","700","800","900"]),X=xe(["normal","italic","oblique"]),k=xe([]),d=xe(null),U=xe([]),H=xe({}),Q=xe(null),T=xe([]),J=xe(!1);function we(){try{const n=JSON.parse(JSON.stringify(k.value));T.value.push(n),T.value.length>Td&&T.value.shift()}catch(n){console.warn("pushHistory 序列化失败：",n)}}function W(){T.value.length!==0&&(k.value=T.value.pop(),d.value=null,re.value=!1)}function D(n){var p,M,F,N,m,a,E,L,ue,ge,Ie,Me,ve,ce,ee;function l(ae){var de;if(!ae)return!1;const ie=(de=ae.tagName)==null?void 0:de.toLowerCase();return ae.isContentEditable||!!ae.closest('[contenteditable="true"]')||ie==="input"||ie==="textarea"||ie==="select"}const s=document.activeElement;if(l(s)||l(n.target))return;const u=n.metaKey||n.ctrlKey,g=n.key.toLowerCase();if(g==="arrowleft"||g==="arrowright"||g==="arrowup"||g==="arrowdown"){if(!d.value)return;const{el:ae}=We(d.value);if(!ae)return;R.shift=n.shiftKey,g==="arrowleft"&&(R.left=!0),g==="arrowright"&&(R.right=!0),g==="arrowup"&&(R.up=!0),g==="arrowdown"&&(R.down=!0);const ie=n.shiftKey?10:1;ne(g==="arrowleft"?-ie:g==="arrowright"?ie:0,g==="arrowup"?-ie:g==="arrowdown"?ie:0),q!=null&&(clearTimeout(q),q=null),q=window.setTimeout(()=>{y()},220),n.preventDefault();return}if(u&&g==="c"){if($t.value){try{Q.value=JSON.parse(JSON.stringify($t.value))}catch{}n.preventDefault()}}else if(u&&g==="v"){if(Q.value){const ae=Q.value,ie=nr(ae),{parentGroup:de}=We(ae.id);if(de){const Ce=Number((M=(p=de.left)!=null?p:de.x)!=null?M:0),f=Number((N=(F=de.top)!=null?F:de.y)!=null?N:0),h=Number((m=de.width)!=null?m:0),z=Number((a=de.height)!=null?a:0),$=Ce+h,O=f+z,le=Number((E=ae.width)!=null?E:0),x=Number((L=ae.height)!=null?L:0);let V=le,G=x;if(!V||!G)if(ae.type==="text"){const tt=Number((ue=ae.fontSize)!=null?ue:16),_e=String((Ie=(ge=ae.text)!=null?ge:ae.content)!=null?Ie:"").trim();V=Math.max(le||50,Math.round((_e.length||2)*tt*.6)),G=Math.max(x||20,Math.round(tt*1.5))}else ae.type==="image"?(V=le||200,G=x||150):ae.type==="chart"?(V=le||240,G=x||160):ae.type==="line"?(V=le||200,G=x||2):(V=le||100,G=x||60);const te=10,he=Ce+h/2,fe=f+z/2;let Ee=!1,Re=$+te,Pe=Math.round(fe-G/2);if(!Ee&&Re+V<=C.width&&(ie.left=Math.max(0,Math.min(Re,Math.max(0,C.width-V))),ie.top=Math.max(0,Math.min(Pe,Math.max(0,C.height-G))),Ee=!0),Re=Ce-V-te,Pe=Math.round(fe-G/2),!Ee&&Re>=0&&(ie.left=Math.max(0,Math.min(Re,Math.max(0,C.width-V))),ie.top=Math.max(0,Math.min(Pe,Math.max(0,C.height-G))),Ee=!0),Re=Math.round(he-V/2),Pe=O+te,!Ee&&Pe+G<=C.height&&(ie.left=Math.max(0,Math.min(Re,Math.max(0,C.width-V))),ie.top=Math.max(0,Math.min(Pe,Math.max(0,C.height-G))),Ee=!0),Re=Math.round(he-V/2),Pe=f-G-te,!Ee&&Pe>=0&&(ie.left=Math.max(0,Math.min(Re,Math.max(0,C.width-V))),ie.top=Math.max(0,Math.min(Pe,Math.max(0,C.height-G))),Ee=!0),!Ee){const tt=Number((ve=(Me=ae.left)!=null?Me:ae.x)!=null?ve:0),_e=Number((ee=(ce=ae.top)!=null?ce:ae.y)!=null?ee:0),st=Ce+tt+te,Ze=f+_e+te;ie.left=Math.max(0,Math.min(Math.round(st),Math.max(0,C.width-V))),ie.top=Math.max(0,Math.min(Math.round(Ze),Math.max(0,C.height-G)))}ie.x=ie.left,ie.y=ie.top}we(),k.value.push(ie),d.value=ie.id,n.preventDefault()}}else if(g==="delete"||g==="backspace"){if(d.value){we();const{el:ae,parentGroup:ie}=We(d.value);ae&&ie&&Array.isArray(ie.children)?ie.children=ie.children.filter(de=>de.id!==ae.id):(k.value=k.value.filter(de=>de.id!==d.value),ae&&ae.type==="group"&&Xt(ae.id)),d.value=null,n.preventDefault()}}else u&&g==="z"&&(W(),n.preventDefault())}const R=ol({left:!1,right:!1,up:!1,down:!1,shift:!1});let Ae=null,v=0,q=null;function ne(n,l){var ve,ce,ee,ae,ie,de,Ce,f;const s=d.value;if(!s)return;const{el:u,parentGroup:g}=We(s);if(!u)return;const p=(ee=(ce=u.width)!=null?ce:(ve=H.value[s])==null?void 0:ve.width)!=null?ee:0,M=(de=(ie=u.height)!=null?ie:(ae=H.value[s])==null?void 0:ae.height)!=null?de:0;let F=C.width,N=C.height;g&&g.width&&g.height&&(F=Number(g.width)||F,N=Number(g.height)||N);let m=((Ce=u.left)!=null?Ce:0)+n,a=((f=u.top)!=null?f:0)+l;m=Math.round(m),a=Math.round(a),m=Math.max(0,Math.min(m,F-(p||0))),a=Math.max(0,Math.min(a,N-(M||0))),u.left=m,u.top=a,u.x=u.left,u.y=u.top;const E=u.left,L=u.top,ue=E+(p||0),ge=L+(M||0),Ie=E+(p||0)/2,Me=L+(M||0)/2;Le({left:E,top:L,right:ue,bottom:ge,centerX:Ie,centerY:Me})}function y(){if(Ae!=null)return;v=Date.now(),we();const n=()=>{if(!R.left&&!R.right&&!R.up&&!R.down){Ae!=null&&cancelAnimationFrame(Ae),Ae=null,at();return}const l=Date.now()-v,s=l>1500?8:l>800?4:l>300?2:1,u=(R.shift?10:1)*s,g=(R.left?-u:0)+(R.right?u:0),p=(R.up?-u:0)+(R.down?u:0);ne(g,p),Ae=requestAnimationFrame(n)};Ae=requestAnimationFrame(n)}function t(n){const l=n.key.toLowerCase();l==="shift"&&(R.shift=!1),l==="arrowleft"&&(R.left=!1),l==="arrowright"&&(R.right=!1),l==="arrowup"&&(R.up=!1),l==="arrowdown"&&(R.down=!1),q!=null&&(clearTimeout(q),q=null),!R.left&&!R.right&&!R.up&&!R.down&&Ae==null&&we(),!R.left&&!R.right&&!R.up&&!R.down&&at()}const re=xe(!1),Z=xe({left:0,top:0,right:0,bottom:0,centerX:0,centerY:0});function rt(n){H.value[n.id]=n}function Ve(n){return n==="pie"?{backgroundColor:"transparent",tooltip:{trigger:"item"},legend:{top:"5%",left:"center",textStyle:{color:"#fff"},show:!0},series:[{name:"分类占比",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:8,borderColor:"#111",borderWidth:2},label:{show:!0,color:"#fff"},labelLine:{show:!0},data:[{value:1048,name:"A"},{value:735,name:"B"},{value:580,name:"C"},{value:484,name:"D"},{value:300,name:"E"}]}]}:n==="mix"?{backgroundColor:"transparent",color:["#00bcd4","#ff9800"],tooltip:{trigger:"axis"},legend:{textStyle:{color:"#fff"},show:!0},xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},series:[{name:"销量",type:"bar",data:[120,200,150,80,70,110,130],itemStyle:{borderRadius:[4,4,0,0]}},{name:"均价",type:"line",smooth:!0,data:[30,40,45,50,49,60,70],lineStyle:{width:2}}]}:n==="bar"?{backgroundColor:"transparent",color:["#42b883"],tooltip:{trigger:"axis"},legend:{show:!0,textStyle:{color:"#fff"}},xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},series:[{name:"数量",type:"bar",data:[120,200,150,80,70,110,130],itemStyle:{borderRadius:[4,4,0,0]}}]}:{backgroundColor:"transparent",color:["#42b883"],tooltip:{trigger:"axis"},legend:{show:!0,textStyle:{color:"#fff"}},xAxis:{type:"category",data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#888"}},axisLabel:{color:"#ccc"}},series:[{name:"趋势",type:"line",smooth:!0,data:[150,230,224,218,135,147,260],lineStyle:{width:2}}]}}function He(n){var ae,ie;const l=`${n}-${Date.now()}`,s=Ct.value,u=qe.value||1,g=(ae=s==null?void 0:s.clientWidth)!=null?ae:0,p=(ie=s==null?void 0:s.clientHeight)!=null?ie:0,M=s?(s.scrollLeft+g/2)/u:20,F=s?(s.scrollTop+p/2)/u:20,N=n==="chart"?240:n==="image"||n==="line"?200:n==="container"?240:void 0,m=n==="chart"?160:n==="image"?150:n==="line"?2:n==="container"?160:void 0,a=Math.round(M-(N?N/2:10)),E=Math.round(F-(m?m/2:10)),L=Math.max(0,Math.min(a,Math.max(0,C.width-(N!=null?N:0)))),ue=Math.max(0,Math.min(E,Math.max(0,C.height-(m!=null?m:0)))),ge=(de,Ce,f,h)=>{const z=Math.max(0,Math.min(de,Math.max(0,C.width-(f!=null?f:0)))),$=Math.max(0,Math.min(Ce,Math.max(0,C.height-(h!=null?h:0))));return{cl:z,ct:$}},Ie=k.value.map(de=>{var $,O,le,x,V,G;const Ce=($=de.width)!=null?$:0,f=(O=de.height)!=null?O:0,h=Number((x=(le=de.left)!=null?le:de.x)!=null?x:0),z=Number((G=(V=de.top)!=null?V:de.y)!=null?G:0);return{l:h,t:z,r:h+Ce,b:z+f}}),Me=(de,Ce,f,h)=>{const z=de+(f!=null?f:0),$=Ce+(h!=null?h:0);for(const O of Ie)if(!(f===void 0||h===void 0)&&!(z<=O.l||$<=O.t||de>=O.r||Ce>=O.b))return!0;return!1},ve=24;let ce={cl:L,ct:ue};if(N&&m&&Me(ce.cl,ce.ct,N,m)){let de=!1;for(let Ce=1;Ce<=20&&!de;Ce++)for(const f of[[Ce,0],[0,Ce],[-Ce,0],[0,-Ce]]){const[h,z]=f,$=a+h*ve,O=E+z*ve,le=ge($,O,N,m);if(!Me(le.cl,le.ct,N,m)){ce=le,de=!0;break}}}const ee={id:l,type:n,left:ce.cl,top:ce.ct,autoSize:n==="text",width:N,height:m,text:n==="text"?"文字":n==="image"||n==="line"?"":"图表",className:"",zIndex:1,style:{}};n==="text"?Object.assign(ee,{content:"文字",fontSize:16,fontWeight:"400",fontFamily:"Arial, Helvetica, sans-serif",color:"#ffffff",letterSpacing:"0px",lineHeight:"1.5",fontStyle:"normal",useGradient:!1,gradientStart:"#00A3FF",gradientEnd:"#ffffff",gradientDirection:"to right",x:ce.cl,y:ce.ct}):n==="image"&&(Object.assign(ee,{src:"",borderRadius:0,x:ce.cl,y:ce.ct}),ee.style={...ee.style||{},objectFit:"contain"}),n==="chart"&&Object.assign(ee,{elementId:`chart-${Date.now()}`,chartType:"line",chartOption:Ve("line")}),n==="line"&&(ee.autoSize=!1,ee.style={...ee.style||{},lineColor:"#ffffff",lineThickness:2,lineOrientation:"horizontal",lineStyle:"solid",lineDashLength:6,lineDashGap:4}),n==="container"&&(ee.autoSize=!1,ee.text="",ee.elementId=`container-${Date.now()}`,ee.style={...ee.style||{},backgroundColor:"transparent",borderRadius:"6px"}),we(),k.value.push(ee),d.value=l}function Ye(n){const{el:l}=We(n.id);l&&(J.value||(we(),J.value=!0),l.left=n.left,l.top=n.top,l.x=n.left,l.y=n.top)}function Ke(n){const{el:l}=We(n.id);l&&(J.value||(we(),J.value=!0),l.width=n.width,l.height=n.height,n.left!==void 0&&(l.left=n.left,l.x=n.left),n.top!==void 0&&(l.top=n.top,l.y=n.top))}function nt(n){d.value=n,ct(),Yr(()=>{const l=document.querySelector(`[data-el-id="${n}"]`);l&&l.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}function vt(n,l){if(n===l||n<0||l<0||n>=k.value.length||l>=k.value.length)return;we();const[s]=k.value.splice(n,1);s&&(k.value.splice(l,0,s),d.value=s.id)}function ct(){if(et(),!gt.value)return;const n=d.value;if(!n)return;const l=Te.value.find(p=>p.id===n);if(!l)return;const s=Te.value.filter(p=>p.id!==n),u={left:l.left,top:l.top,right:l.right,bottom:l.bottom,centerX:l.centerX,centerY:l.centerY};Z.value={left:u.left,top:u.top,right:u.right,bottom:u.bottom,centerX:u.centerX,centerY:u.centerY},Fe.value={centerV:!1,centerH:!1,left:!1,right:!1,top:!1,bottom:!1};const g=4;for(const p of s)Math.abs(u.centerX-p.centerX)<=g&&p.w>0&&(Fe.value.centerV=!0,Z.value.centerX=p.centerX),Math.abs(u.centerY-p.centerY)<=g&&p.h>0&&(Fe.value.centerH=!0,Z.value.centerY=p.centerY),Math.abs(u.left-p.left)<=g&&(Fe.value.left=!0,Z.value.left=p.left),Math.abs(u.right-p.right)<=g&&p.w>0&&(Fe.value.right=!0,Z.value.right=p.right),Math.abs(u.top-p.top)<=g&&(Fe.value.top=!0,Z.value.top=p.top),Math.abs(u.bottom-p.bottom)<=g&&p.h>0&&(Fe.value.bottom=!0,Z.value.bottom=p.bottom);re.value=Object.values(Fe.value).some(Boolean)}function At(){d.value=null,at()}const Fe=xe({centerV:!1,centerH:!1,left:!1,right:!1,top:!1,bottom:!1}),ye=xe({left:null,right:null,up:null,down:null}),pt=xe(!0),gt=xe(!0),yt=xe(!1),St=Ge(()=>k.value.filter(n=>n.hidden));function jt(n){const l=k.value.find(s=>s.id===n);l&&(l.hidden=!1,d.value=n,Yr(()=>{const s=document.querySelector(`[data-el-id="${n}"]`);s&&s.scrollIntoView({behavior:"smooth",block:"center"}),yt.value=!1}))}const Se=xe(null),Ne=xe(null),Te=Ge(()=>k.value.map(n=>{var g,p;const l=H.value[n.id];if(l)return{id:n.id,left:l.left,top:l.top,right:l.right,bottom:l.bottom,centerX:l.centerX,centerY:l.centerY,w:l.width,h:l.height,type:n.type};const s=(g=n.width)!=null?g:0,u=(p=n.height)!=null?p:0;return{id:n.id,left:n.left,top:n.top,right:n.left+s,bottom:n.top+u,centerX:n.left+s/2,centerY:n.top+u/2,w:s,h:u,type:n.type}}));function Le(n){J.value||(we(),J.value=!0),Z.value={left:n.left,top:n.top,right:n.right,bottom:n.bottom,centerX:n.centerX,centerY:n.centerY},Fe.value={centerV:!1,centerH:!1,left:!1,right:!1,top:!1,bottom:!1},ye.value={left:null,right:null,up:null,down:null};const l=.5,s=d.value,u=Te.value;function g(m,a,E,L){const ue=Math.max(m,E);return Math.min(a,L)-ue}let p=null,M=null,F=null,N=null;for(const m of u)if(!(!s||m.id===s)){if(Math.abs(n.centerX-m.centerX)<=l&&m.w>0&&(Fe.value.centerV=!0,Z.value.centerX=m.centerX),Math.abs(n.centerY-m.centerY)<=l&&m.h>0&&(Fe.value.centerH=!0,Z.value.centerY=m.centerY),Math.abs(n.left-m.left)<=l&&(Fe.value.left=!0,Z.value.left=m.left),Math.abs(n.right-m.right)<=l&&m.w>0&&(Fe.value.right=!0,Z.value.right=m.right),Math.abs(n.top-m.top)<=l&&(Fe.value.top=!0,Z.value.top=m.top),Math.abs(n.bottom-m.bottom)<=l&&m.h>0&&(Fe.value.bottom=!0,Z.value.bottom=m.bottom),g(n.top,n.bottom,m.top,m.bottom)>0){const a=n.left-m.right;a>=0&&(!p||a<p.gap)&&(p={gap:a,m});const E=m.left-n.right;E>=0&&(!M||E<M.gap)&&(M={gap:E,m})}if(g(n.left,n.right,m.left,m.right)>0){const a=n.top-m.bottom;a>=0&&(!F||a<F.gap)&&(F={gap:a,m});const E=m.top-n.bottom;E>=0&&(!N||E<N.gap)&&(N={gap:E,m})}}if(re.value=Object.values(Fe.value).some(Boolean),!pt.value){ye.value={left:null,right:null,up:null,down:null};return}if(p){const m=p.m,a=(Math.max(n.left,m.left)+Math.min(n.right,m.right))/2,E=(Math.max(n.top,m.top)+Math.min(n.bottom,m.bottom))/2;ye.value.left={gap:Math.floor(p.gap),exact:p.gap,refId:m.id,x:Math.round(a),y:Math.round(E)}}if(M){const m=M.m,a=(Math.max(n.left,m.left)+Math.min(n.right,m.right))/2,E=(Math.max(n.top,m.top)+Math.min(n.bottom,m.bottom))/2;ye.value.right={gap:Math.floor(M.gap),exact:M.gap,refId:m.id,x:Math.round(a),y:Math.round(E)}}if(F){const m=F.m,a=(Math.max(n.left,m.left)+Math.min(n.right,m.right))/2,E=(m.bottom+n.top)/2;ye.value.up={gap:Math.floor(F.gap),exact:F.gap,refId:m.id,x:Math.round(a),y:Math.round(E)}}if(N){const m=N.m,a=(Math.max(n.left,m.left)+Math.min(n.right,m.right))/2,E=(n.bottom+m.top)/2;ye.value.down={gap:Math.floor(N.gap),exact:N.gap,refId:m.id,x:Math.round(a),y:Math.round(E)}}gt.value||(Fe.value={centerV:!1,centerH:!1,left:!1,right:!1,top:!1,bottom:!1},re.value=!1)}function et(){if(!pt.value){ye.value={left:null,right:null,up:null,down:null};return}const n=d.value;if(!n){ye.value={left:null,right:null,up:null,down:null};return}const l=Te.value.find(a=>a.id===n);if(!l){ye.value={left:null,right:null,up:null,down:null};return}const s={left:l.left,top:l.top,right:l.right,bottom:l.bottom,centerX:l.centerX,centerY:l.centerY},u=Te.value.filter(a=>a.id!==n);function g(a,E,L,ue){const ge=Math.max(a,L);return Math.min(E,ue)-ge}let p=null,M=null,F=null,N=null;for(const a of u){if(g(s.top,s.bottom,a.top,a.bottom)>0){const E=s.left-a.right;E>=0&&(!p||E<p.gap)&&(p={gap:E,m:a});const L=a.left-s.right;L>=0&&(!M||L<M.gap)&&(M={gap:L,m:a})}if(g(s.left,s.right,a.left,a.right)>0){const E=s.top-a.bottom;E>=0&&(!F||E<F.gap)&&(F={gap:E,m:a});const L=a.top-s.bottom;L>=0&&(!N||L<N.gap)&&(N={gap:L,m:a})}}const m={left:null,right:null,up:null,down:null};if(p){const a=p.m,E=(Math.max(s.left,a.left)+Math.min(s.right,a.right))/2,L=(Math.max(s.top,a.top)+Math.min(s.bottom,a.bottom))/2;m.left={gap:Math.floor(p.gap),exact:p.gap,refId:a.id,x:Math.round(E),y:Math.round(L)}}if(M){const a=M.m,E=(Math.max(s.left,a.left)+Math.min(s.right,a.right))/2,L=(Math.max(s.top,a.top)+Math.min(s.bottom,a.bottom))/2;m.right={gap:Math.floor(M.gap),exact:M.gap,refId:a.id,x:Math.round(E),y:Math.round(L)}}if(F){const a=F.m,E=(Math.max(s.left,a.left)+Math.min(s.right,a.right))/2,L=(a.bottom+s.top)/2;m.up={gap:Math.floor(F.gap),exact:F.gap,refId:a.id,x:Math.round(E),y:Math.round(L)}}if(N){const a=N.m,E=(Math.max(s.left,a.left)+Math.min(s.right,a.right))/2,L=(s.bottom+a.top)/2;m.down={gap:Math.floor(N.gap),exact:N.gap,refId:a.id,x:Math.round(E),y:Math.round(L)}}ye.value=m}function at(){J.value=!1,gt.value&&d.value?ct():re.value=!1,et()}function We(n){if(!n)return{el:null,parentGroup:null};const l=(s,u)=>{for(const g of s){if(g.id===n)return{el:g,parentGroup:u};if((g.type==="group"||g.type==="container")&&Array.isArray(g.children)){const p=l(g.children,g);if(p)return p}}return null};return l(k.value,null)||{el:null,parentGroup:null}}const Je=xe(null);function it(n,l){if(!n.children||!Array.isArray(n.children))return!1;const s=[...n.children];for(;s.length;){const u=s.pop();if((u==null?void 0:u.id)===l.id)return!0;u!=null&&u.children&&Array.isArray(u.children)&&s.push(...u.children)}return!1}function zt(n){var ue,ge,Ie,Me;const{id:l,globalLeft:s,globalTop:u}=n;if(!l)return;const g=(ue=Je.value)==null?void 0:ue.getBoundingClientRect();if(!g)return;const{el:p,parentGroup:M}=We(l);if(!p)return;const F=(((ge=H.value[l])==null?void 0:ge.width)||Number(p.width)||0)*qe.value,N=(((Ie=H.value[l])==null?void 0:Ie.height)||Number(p.height)||0)*qe.value,m=s+F/2,a=u+N/2,E=document.elementsFromPoint(m,a);let L=null;for(const ve of E){const ce=(Me=ve.closest("[data-box-id]"))==null?void 0:Me.getAttribute("data-box-id");if(ce&&ce!==l){const{el:ee}=We(ce);if(ee&&(ee.type==="container"||ee.type==="group")&&ee.id!==p.id&&!it(p,ee)){L=ce;break}}}if(M?Array.isArray(M.children)&&(M.children=M.children.filter(ve=>ve.id!==l)):k.value=k.value.filter(ve=>ve.id!==l),L){const{el:ve}=We(L);if(ve){const ce=document.querySelector(`[data-box-id="${L}"]`);if(ce){const ee=ce.getBoundingClientRect(),ae=(s-ee.left)/qe.value,ie=(u-ee.top)/qe.value;p.left=Math.round(ae),p.top=Math.round(ie),p.x=p.left,p.y=p.top,ve.children||(ve.children=[]),ve.children.push(p)}}}else{const ve=(s-g.left)/qe.value,ce=(u-g.top)/qe.value;p.left=Math.round(ve),p.top=Math.round(ce),p.x=p.left,p.y=p.top,k.value.push(p)}we(),Yr(()=>{d.value=l})}function ht(n){const l=ye.value[n];l&&(Se.value=n,Ne.value=l.gap)}function wt(){var F,N,m,a,E;if(!Se.value||Ne.value==null){Se.value=null,Ne.value=null;return}const n=Se.value,l=ye.value[n];if(!l){Se.value=null,Ne.value=null;return}const s=Te.value.find(L=>L.id===l.refId),u=Ne.value,g=$t.value;if(!s||!g){Se.value=null,Ne.value=null;return}we();const p=(F=l.exact)!=null?F:l.gap,M=u-p;n==="left"?g.left=Math.round(((N=g.left)!=null?N:0)+M):n==="right"?g.left=Math.round(((m=g.left)!=null?m:0)-M):n==="up"?g.top=Math.round(((a=g.top)!=null?a:0)+M):n==="down"&&(g.top=Math.round(((E=g.top)!=null?E:0)-M)),Se.value=null,Ne.value=null,et()}mt(d,()=>{J.value||et()}),mt(H,()=>{J.value||et()},{deep:!0}),mt(pt,n=>{n?et():(Se.value=null,Ne.value=null,ye.value={left:null,right:null,up:null,down:null})}),mt(gt,n=>{n?ct():(Fe.value={centerV:!1,centerH:!1,left:!1,right:!1,top:!1,bottom:!1},re.value=!1)});const $t=Ge(()=>d.value?We(d.value).el:null);async function fr(){return new Promise((n,l)=>{const s=indexedDB.open("lowcode-db",1);s.onupgradeneeded=()=>{const u=s.result;if(!u.objectStoreNames.contains("objects")){const g=u.createObjectStore("objects",{keyPath:"id"});try{g.createIndex("projectId","projectId",{unique:!1}),g.createIndex("name","name",{unique:!1})}catch{}}},s.onsuccess=()=>n(s.result),s.onerror=()=>l(s.error)})}async function mr(){try{const n=(await fr()).transaction(["objects"],"readonly").objectStore("objects").getAll();n.onsuccess=()=>{U.value=(n.result||[]).filter(l=>!l.projectId||l.projectId===(o.projectId||void 0))},n.onerror=()=>{console.warn("loadDatabaseObjects error",n.error)}}catch(n){console.warn("openDatabaseDB error",n)}}const yr=Ge(()=>{const n={};for(const l of U.value)l&&l.name&&(n[l.name]=l.content);return n}),Mt=xe({}),Ot=Ge(()=>{const n={...yr.value};for(const l in Mt.value)Object.assign(n,Mt.value[l]);return n});function br(n,l){const s={};for(const u of l)u&&u.name&&(s[u.name]=u.content);Mt.value[n]=s}function Xt(n){Mt.value[n]&&delete Mt.value[n];const l=`component-fonts-${n}`,s=document.getElementById(l);s&&s.parentNode&&s.parentNode.removeChild(s)}function xr(n,l="#000000"){try{const s=String(n||"").trim();return/^#([0-9a-fA-F]{6})$/.test(s)?s:l}catch{return l}}function vr(){if(!d.value)return;we();const{el:n,parentGroup:l}=We(d.value);n&&l&&Array.isArray(l.children)?l.children=l.children.filter(s=>s.id!==n.id):(k.value=k.value.filter(s=>s.id!==d.value),n&&n.type==="group"&&Xt(n.id)),d.value=null}function Yt(n){(!n.className||!n.className.trim())&&(n.className=`cls-${String(n.id).slice(0,8)}`)}function hr(n){try{Yt(n);const l=String(n.className||"").trim();String(n.customClassCss||"").trim()||(n.customClassCss=`.${l} {
  
}`)}catch{}}function wr(n){const l=String(n||"").trim();return l?l.split(";").map(s=>{const u=s.trim();return u?/!important\s*$/.test(u)?u+";":u+" !important;":""}).filter(Boolean).join(`
`):""}function $r(n){return String(n||"").replace(/\{([^}]*)\}/g,(l,s)=>`{
`+String(s||"").split(";").map(u=>{const g=u.trim();return g?g.startsWith("@")||!/:/.test(g)||/!important\s*$/.test(g)?g+";":g+" !important;":""}).filter(Boolean).join(`
`)+`
}`)}function kr(n){try{if(!n.enableClassStyle)return;Yt(n);const l=String(n.customClassCss||"").trim();if(!l)return;const s=`custom-class-${n.id}`;let u=document.getElementById(s);if(u||(u=document.createElement("style"),u.id=s,document.head.appendChild(u)),/{[^}]*}/.test(l)){u.textContent=$r(l);return}const g=wr(l);u.textContent=`.${String(n.className).trim()} {
${g}
}`}catch(l){console.warn("注入自定义类样式失败：",l)}}function Kt(n){try{const l=`custom-class-${n}`,s=document.getElementById(l);s&&s.remove()}catch{}}function Zt(n,l){for(const s of n)l(s),s.type==="group"&&Array.isArray(s.children)&&Zt(s.children,l)}let Rt=null;function Tt(){Rt&&clearTimeout(Rt),Rt=setTimeout(()=>{try{Zt(k.value,n=>{n.enableClassStyle&&n.customClassCss&&n.className?kr(n):Kt(n.id)})}catch(n){console.warn("刷新自定义类样式失败：",n)}},50)}async function Er(){var n,l,s,u,g,p,M,F,N,m;try{const a=$t.value;if(!a){alert("请先选中要保存的元素或分组");return}const E=pe.value||(a.type==="group"?"分组组件":"元素组件"),L=prompt("请输入组件名称",E);if(L===null)return;const ue=(L||E).trim()||"未命名组件";let ge=[];if(a.type==="group"&&Array.isArray(a.children)){const f=Number((l=(n=a.left)!=null?n:a.x)!=null?l:0),h=Number((u=(s=a.top)!=null?s:a.y)!=null?u:0);ge=a.children.map(z=>{var te,he,fe,Ee,Re,Pe;const $=JSON.parse(JSON.stringify(z)),O=Number((he=(te=$.left)!=null?te:$.x)!=null?he:0),le=Number((Ee=(fe=$.top)!=null?fe:$.y)!=null?Ee:0);$.left=f+O,$.top=h+le,$.x=$.left,$.y=$.top;const x=H.value[z.id],V=Number($.width||0),G=Number($.height||0);if(!(V>0)){const tt=(()=>{var _e,st,Ze,ft,xt;if($.type==="text"){const Nt=Number((_e=$.fontSize)!=null?_e:16),Pr=String((st=$.text)!=null?st:"").trim();return Math.max(50,Math.round((Pr.length||2)*Nt*.6))}if($.type==="image")return 100;if($.type==="chart")return 240;if($.type==="line"){const Nt=Number((ft=(Ze=$.style)==null?void 0:Ze.lineThickness)!=null?ft:2);return(((xt=$.style)==null?void 0:xt.lineOrientation)||"horizontal")==="vertical"?Nt:100}return 50})();$.width=Math.max(1,Math.round((Re=x==null?void 0:x.width)!=null?Re:tt))}if(!(G>0)){const tt=(()=>{var _e,st,Ze,ft;if($.type==="text"){const xt=Number((_e=$.fontSize)!=null?_e:16);return Math.max(20,Math.round(xt*1.5))}if($.type==="image")return 100;if($.type==="chart")return 160;if($.type==="line"){const xt=Number((Ze=(st=$.style)==null?void 0:st.lineThickness)!=null?Ze:2);return(((ft=$.style)==null?void 0:ft.lineOrientation)||"horizontal")==="vertical"?100:xt}return 20})();$.height=Math.max(1,Math.round((Pe=x==null?void 0:x.height)!=null?Pe:tt))}return $.id=`${$.type}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,$})}else{const f=JSON.parse(JSON.stringify(a)),h=Number((p=(g=f.left)!=null?g:f.x)!=null?p:0),z=Number((F=(M=f.top)!=null?M:f.y)!=null?F:0);f.left=h,f.top=z,f.x=f.left,f.y=f.top;const $=H.value[a.id],O=Number(f.width||0),le=Number(f.height||0);if(!(O>0)){const x=(()=>{var V,G,te,he,fe;if(f.type==="text"){const Ee=Number((V=f.fontSize)!=null?V:16),Re=String((G=f.text)!=null?G:"").trim();return Math.max(50,Math.round((Re.length||2)*Ee*.6))}if(f.type==="image")return 100;if(f.type==="chart")return 240;if(f.type==="line"){const Ee=Number((he=(te=f.style)==null?void 0:te.lineThickness)!=null?he:2);return(((fe=f.style)==null?void 0:fe.lineOrientation)||"horizontal")==="vertical"?Ee:100}return 50})();f.width=Math.max(1,Math.round((N=$==null?void 0:$.width)!=null?N:x))}if(!(le>0)){const x=(()=>{var V,G,te,he;if(f.type==="text"){const fe=Number((V=f.fontSize)!=null?V:16);return Math.max(20,Math.round(fe*1.5))}if(f.type==="image")return 100;if(f.type==="chart")return 160;if(f.type==="line"){const fe=Number((te=(G=f.style)==null?void 0:G.lineThickness)!=null?te:2);return(((he=f.style)==null?void 0:he.lineOrientation)||"horizontal")==="vertical"?100:fe}return 20})();f.height=Math.max(1,Math.round((m=$==null?void 0:$.height)!=null?m:x))}f.id=`${f.type}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,ge=[f]}const Ie=Math.min(...ge.map(f=>{var h,z;return Number((z=(h=f.left)!=null?h:f.x)!=null?z:0)})),Me=Math.min(...ge.map(f=>{var h,z;return Number((z=(h=f.top)!=null?h:f.y)!=null?z:0)})),ve=Math.max(...ge.map(f=>{var h,z,$;return Number((z=(h=f.left)!=null?h:f.x)!=null?z:0)+Number(($=f.width)!=null?$:0)})),ce=Math.max(...ge.map(f=>{var h,z,$;return Number((z=(h=f.top)!=null?h:f.y)!=null?z:0)+Number(($=f.height)!=null?$:0)})),ee=Math.max(1,Math.round(ve-Ie)),ae=Math.max(1,Math.round(ce-Me));ge=ge.map(f=>{var O,le,x,V;const h=JSON.parse(JSON.stringify(f)),z=Number((le=(O=h.left)!=null?O:h.x)!=null?le:0)-Ie,$=Number((V=(x=h.top)!=null?x:h.y)!=null?V:0)-Me;return h.left=Math.max(0,Math.round(z)),h.top=Math.max(0,Math.round($)),h.x=h.left,h.y=h.top,h});const ie={width:ee,height:ae,backgroundUrl:"",backgroundColor:"transparent",globalFontFamily:C.globalFontFamily,globalFontSize:C.globalFontSize,globalColor:C.globalColor},de=`${Date.now()}${Math.random().toString(36).slice(2,9)}`,Ce={id:de,name:ue,description:"",tags:[],elements:ge,config:ie,usageCount:0,createdAt:Date.now(),updatedAt:Date.now()};await Xe.init(),await Xe.saveComponent(JSON.parse(JSON.stringify(Ce))),await _t(`component-${de}`,{config:ie,elements:ge,exportName:ue}),alert("组件已保存到组件库")}catch(a){console.warn("保存组件失败：",a),alert("保存组件失败，请稍后重试")}}const Sr=xe(null);function Mr(n){var u;const l=(u=n.target.files)==null?void 0:u[0];if(!l)return;const s=new FileReader;s.onload=()=>{const g=String(s.result);C.backgroundUrl=g;const p=new Image;p.onload=()=>{Sr.value={width:p.naturalWidth,height:p.naturalHeight},C.width=p.naturalWidth,C.height=p.naturalHeight},p.src=g},s.readAsDataURL(l)}function Bt(n){var l;return n&&((l=n.split(",")[0])!=null?l:"").trim().replace(/^['"]|['"]$/g,"")||null}function bt(n){return{"image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/webp":"webp","image/gif":"gif","image/svg+xml":"svg","image/avif":"avif","image/apng":"apng","image/x-icon":"ico","image/vnd.microsoft.icon":"ico","font/ttf":"ttf","font/otf":"otf","font/woff":"woff","font/woff2":"woff2","application/font-ttf":"ttf","application/font-otf":"otf","application/font-woff":"woff","application/font-woff2":"woff2","application/x-font-ttf":"ttf","application/x-font-otf":"otf","application/x-font-woff":"woff","application/x-font-woff2":"woff2","application/vnd.ms-fontobject":"eot","application/octet-stream":"bin"}[n]||"bin"}function Qt(n){var u;const l=/\.([A-Za-z0-9]+)$/.exec(n||"");if(!l)return null;const s=((u=l[1])!=null?u:"").toLowerCase();return s?["png","jpg","jpeg","gif","svg","webp","avif","apng","ico"].includes(s)?s==="jpeg"?"jpg":s:["ttf","otf","woff","woff2","eot"].includes(s)?s:null:null}async function Dt(n){try{const l="lowcode-icons",s="icons",u=await new Promise((g,p)=>{const M=indexedDB.open(l);M.onsuccess=()=>{const F=M.result;if(F.objectStoreNames.contains(s))g(F);else{const N=F.version+1;F.close();const m=indexedDB.open(l,N);m.onupgradeneeded=()=>{const a=m.result;a.objectStoreNames.contains(s)||a.createObjectStore(s,{keyPath:"id"})},m.onsuccess=()=>g(m.result),m.onerror=()=>p(m.error)}},M.onerror=()=>p(M.error)});return await new Promise((g,p)=>{const M=u.transaction(s,"readonly").objectStore(s).get(n);M.onsuccess=()=>g(M.result||null),M.onerror=()=>p(M.error)})}catch{return null}}function er(n){var l,s,u,g,p,M,F,N;try{const m=new Uint8Array(n),a=String.fromCharCode((l=m[0])!=null?l:0,(s=m[1])!=null?s:0,(u=m[2])!=null?u:0,(g=m[3])!=null?g:0);return a==="wOFF"?"woff":a==="wOF2"?"woff2":a==="OTTO"?"otf":(((p=m[0])!=null?p:0)===0&&((M=m[1])!=null?M:0)===1&&((F=m[2])!=null?F:0)===0&&((N=m[3])!=null?N:0)===0||a==="true"||a==="typ1","ttf")}catch{return"ttf"}}async function Cr(n){const l=prompt("请输入导出名称",pe.value||"GeneratedComponent");if(l===null)return;const s=l.trim()||"GeneratedComponent";pe.value=s;function u(f){const h=new Set,z={};function $(le){let x=Date.now(),V=`${le}-${x}`;for(;h.has(V);)x+=1,V=`${le}-${x}`;return V}function O(le){const x=JSON.parse(JSON.stringify(le)),V=String(x.id);let G=V;return h.has(G)&&(G=$(String(x.type||"el"))),h.add(G),z[V]=G,x.id=G,x.type==="group"&&Array.isArray(x.children)&&(x.children=x.children.map(te=>O(te))),x}return{normalized:f.map(le=>O(le)),remap:z}}const{normalized:g}=u(k.value),p=[],M=f=>{for(const h of f)h.type==="group"&&Array.isArray(h.children)?M(h.children):h.type==="image"&&(h.src||h.iconId)&&p.push(h)};M(g);const F={},N=new Map;let m=0;for(const f of p)try{let h;if(f.src)h=await(await fetch(String(f.src))).blob();else if(f.iconId){const x=f.iconId,V=await Dt(x);if(!V)throw new Error("icon record missing: "+x);h=new Blob([V.buffer],{type:String(V.mime||"image/png")})}else continue;let z=bt(h.type);if(z==="bin"&&f.iconId){const x=f.iconId,V=await Dt(x);if(V){const G=bt(String(V.mime||"")),te=Qt(String(V.originalName||""));z=G!=="bin"?G:te||z}z==="bin"&&(z="png")}const $=await h.arrayBuffer(),O=await crypto.subtle.digest("SHA-256",$),le=Array.from(new Uint8Array(O)).map(x=>x.toString(16).padStart(2,"0")).join("");if(N.has(le)){const{fileName:x}=N.get(le);F[f.id]=x}else{const x=`${s}_img_${m}.${z}`;N.set(le,{fileName:x,blob:h}),m++,F[f.id]=x}}catch(h){console.warn("导出图片失败：",h)}const a=Array.from(N.values());let E=null,L=null;if(C.backgroundUrl)try{const f=await(await fetch(String(C.backgroundUrl))).blob(),h=bt(f.type);E=`${s}_bg.${h}`,L=f}catch(f){console.warn("导出背景图片失败：",f)}const ue=new Set,ge=Bt(C.globalFontFamily);ge&&ue.add(ge);const Ie=f=>{var h;for(const z of f)if(z.type==="group"&&Array.isArray(z.children))Ie(z.children);else if(z.type==="text"){const $=Bt((h=z.style)==null?void 0:h.fontFamily);$&&ue.add($)}};Ie(k.value);const Me=[],ve=[];if(ue.size>0)try{const f="lowcode-fonts",h="fonts",z=await new Promise((x,V)=>{const G=indexedDB.open(f);G.onsuccess=()=>{const te=G.result;if(te.objectStoreNames.contains(h))x(te);else{const he=te.version+1;te.close();const fe=indexedDB.open(f,he);fe.onupgradeneeded=()=>{const Ee=fe.result;Ee.objectStoreNames.contains(h)||Ee.createObjectStore(h,{keyPath:"id"})},fe.onsuccess=()=>x(fe.result),fe.onerror=()=>V(fe.error)}},G.onerror=()=>V(G.error)}),$=await new Promise((x,V)=>{const G=z.transaction(h,"readonly").objectStore(h).getAll();G.onsuccess=()=>x(G.result),G.onerror=()=>V(G.error)}),O=w.value,le=O?$.filter(x=>x.projectId===O):$.filter(x=>!x.projectId);for(const x of le)if(ue.has(x.name)){const V=new Blob([x.buffer],{type:x.mime});let G=bt(x.mime);if(G==="bin")try{G=er(x.buffer)}catch{G="ttf"}const te=x.name.replace(/[^A-Za-z0-9_\-]/g,"_"),he=`${s}_${te}.${G}`;Me.push({family:x.name,file:he}),ve.push({file:he,blob:V})}}catch(f){console.warn("读取字体库失败：",f)}const ce=new gl.default,ee=ce.folder(s),ae=ee.folder("imgs");for(const f of a)ae.file(f.fileName,f.blob);L&&E&&ae.file(E,L);const ie=ee.folder("fonts");for(const f of ve)ie.file(f.file,f.blob);let de="";n==="vue2"?(de=al(s,C,g,{imageFileNames:a.map(f=>f.fileName),imageFileMap:F,backgroundFileName:L&&E?E:null,fontFaces:Me,hideDirective:"if"},Ot.value),ee.file("index.vue",de)):n==="vue3"?(de=il(s,C,g,{imageFileNames:a.map(f=>f.fileName),imageFileMap:F,backgroundFileName:L&&E?E:null,fontFaces:Me,hideDirective:"if"}),ee.file("index.vue",de)):n==="react"?(de=cl(s,C,g,{imageFileNames:a.map(f=>f.fileName),imageFileMap:F,backgroundFileName:L&&E?E:null,fontFaces:Me}),ee.file("index.jsx",de),ee.file("README.md","# React 导出使用说明\n\n- 将本目录的 `imgs/` 与 `fonts/` 拷贝到 React 项目 `public/` 根目录：\n  - `public/imgs`\n  - `public/fonts`\n- 组件中图片路径为 `/imgs/...`，字体为 `/fonts/...`，确保开发与生产可访问。\n\n可选方案：若不使用 `public`，需自行改为通过打包管道解析资源（如 `new URL(path, import.meta.url).href` 或 import）。")):(de=dl(s,C,g,{imageFileNames:a.map(f=>f.fileName),imageFileMap:F,backgroundFileName:L&&E?E:null,fontFaces:Me}),ee.file("index.html",de));const Ce=await ce.generateAsync({type:"blob"});(0,pl.saveAs)(Ce,`${s}.zip`)}async function Nr(){const n=prompt("请输入导出名称",pe.value||"GeneratedComponent");if(n===null)return;const l=n.trim()||"GeneratedComponent";pe.value=l;const s=[],u=f=>{for(const h of f)h.type==="group"&&Array.isArray(h.children)?u(h.children):h.type==="image"&&h.src&&s.push(h)};u(k.value);const g={},p=new Map;let M=0;for(const f of s)try{let h;if(f.src)h=await(await fetch(String(f.src))).blob();else if(f.iconId){const x=f.iconId,V=await Dt(x);if(!V)throw new Error("icon record missing: "+x);h=new Blob([V.buffer],{type:String(V.mime||"image/png")})}else continue;let z=bt(h.type);if(z==="bin"&&f.iconId){const x=f.iconId,V=await Dt(x);if(V){const G=bt(String(V.mime||"")),te=Qt(String(V.originalName||""));z=G!=="bin"?G:te||z}z==="bin"&&(z="png")}const $=await h.arrayBuffer(),O=await crypto.subtle.digest("SHA-256",$),le=Array.from(new Uint8Array(O)).map(x=>x.toString(16).padStart(2,"0")).join("");if(p.has(le)){const{fileName:x}=p.get(le);g[f.id]=x}else{const x=`${l}_img_${M}.${z}`;p.set(le,{fileName:x,blob:h}),M++,g[f.id]=x}}catch(h){console.warn("导出图片失败：",h)}const F=Array.from(p.values());let N=null,m=null;if(C.backgroundUrl)try{const f=await(await fetch(String(C.backgroundUrl))).blob(),h=bt(f.type);N=`${l}_bg.${h}`,m=f}catch(f){console.warn("导出背景图片失败：",f)}const a=new Set,E=Bt(C.globalFontFamily);E&&a.add(E);const L=f=>{var h;for(const z of f)if(z.type==="group"&&Array.isArray(z.children))L(z.children);else if(z.type==="text"){const $=Bt((h=z.style)==null?void 0:h.fontFamily);$&&a.add($)}};L(k.value);const ue=[],ge=[];if(a.size>0)try{const f="lowcode-fonts",h="fonts",z=await new Promise((x,V)=>{const G=indexedDB.open(f);G.onsuccess=()=>{const te=G.result;if(te.objectStoreNames.contains(h))x(te);else{const he=te.version+1;te.close();const fe=indexedDB.open(f,he);fe.onupgradeneeded=()=>{const Ee=fe.result;Ee.objectStoreNames.contains(h)||Ee.createObjectStore(h,{keyPath:"id"})},fe.onsuccess=()=>x(fe.result),fe.onerror=()=>V(fe.error)}},G.onerror=()=>V(G.error)}),$=await new Promise((x,V)=>{const G=z.transaction(h,"readonly").objectStore(h).getAll();G.onsuccess=()=>x(G.result),G.onerror=()=>V(G.error)}),O=w.value,le=O?$.filter(x=>x.projectId===O):$.filter(x=>!x.projectId);for(const x of le)if(a.has(x.name)){const V=new Blob([x.buffer],{type:x.mime});let G=bt(x.mime);if(G==="bin")try{G=er(x.buffer)}catch{G="ttf"}const te=x.name.replace(/[^A-Za-z0-9_\-]/g,"_"),he=`${l}_${te}.${G}`;ue.push({family:x.name,file:he}),ge.push({file:he,blob:V})}}catch(f){console.warn("读取字体库失败：",f)}const Ie=new gl.default,Me=Ie.folder(`${l}_all`),ve=[],ce={imageFileNames:F.map(f=>f.fileName),imageFileMap:g,backgroundFileName:m&&N?N:null,fontFaces:ue,hideDirective:"if"},ee=al(l,C,k.value,ce,Ot.value);ve.push({key:"vue2",file:"index.vue",content:ee});const ae=il(l,C,k.value,ce);ve.push({key:"vue3",file:"index.vue",content:ae});const ie=cl(l,C,k.value,ce);ve.push({key:"react",file:"index.jsx",content:ie});const de=dl(l,C,k.value,ce);ve.push({key:"html",file:"index.html",content:de});for(const f of ve){const h=Me.folder(f.key);h.file(f.file,f.content),f.key==="react"&&h.file("README.md","# React 导出使用说明\n\n- 将本目录的 `imgs/` 与 `fonts/` 拷贝到 React 项目 `public/` 根目录：\n  - `public/imgs`\n  - `public/fonts`\n- 组件中图片路径为 `/imgs/...`，字体为 `/fonts/...`，确保开发与生产可访问。\n\n可选方案：若不使用 `public`，需自行改为通过打包管道解析资源（如 `new URL(path, import.meta.url).href` 或 import）。");const z=h.folder("imgs");for(const O of F)z.file(O.fileName,O.blob);m&&N&&z.file(N,m);const $=h.folder("fonts");for(const O of ge)$.file(O.file,O.blob)}const Ce=await Ie.generateAsync({type:"blob"});(0,pl.saveAs)(Ce,`${l}-all.zip`)}function Ir(){confirm("确认清空当前画布与元素吗？")&&(k.value=[],d.value=null)}const qe=xe(1),Ct=xe(null);function Fr(){qe.value=Math.min(2,+(qe.value+.1).toFixed(2))}function Ar(){qe.value=Math.max(.2,+(qe.value-.1).toFixed(2))}function tr(){const n=Ct.value;if(!n)return;const l=n.clientWidth-16,s=n.clientHeight-16,u=l/C.width,g=s/C.height;qe.value=+Math.max(.2,Math.min(2,Math.min(u,g))).toFixed(2)}Zr(async()=>{tr(),await mr()});const rr=xe([]);function nr(n){const l=JSON.parse(JSON.stringify(n));let s=Date.now();function u(p){return s+=1,`${p}-${s}`}function g(p){p.id=u(String(p.type||"el")),p.type==="chart"&&p.elementId&&(p.elementId=String(p.elementId)+"_"+String(s%1e3)),p.type==="group"&&Array.isArray(p.children)&&p.children.forEach(M=>g(M))}return g(l),l.left=(n.left||0)+10,l.top=(n.top||0)+10,l.x=l.left,l.y=l.top,l.zIndex=(n.zIndex||1)+1,l}function jr(){var g,p,M,F,N,m,a,E,L,ue,ge,Ie,Me,ve,ce;if(!$t.value)return;let n=$t.value;const l=We(n.id);l.parentGroup&&(n=l.parentGroup);const s=nr(n),{parentGroup:u}=We(n.id);if(u){const ee=Number((p=(g=u.left)!=null?g:u.x)!=null?p:0),ae=Number((F=(M=u.top)!=null?M:u.y)!=null?F:0),ie=Number((N=u.width)!=null?N:0),de=Number((m=u.height)!=null?m:0),Ce=ee+ie,f=ae+de,h=Number((a=n.width)!=null?a:0),z=Number((E=n.height)!=null?E:0);let $=h,O=z;if(!$||!O)if(n.type==="text"){const fe=Number((L=n.fontSize)!=null?L:16),Ee=String((ge=(ue=n.text)!=null?ue:n.content)!=null?ge:"").trim();$=Math.max(h||50,Math.round((Ee.length||2)*fe*.6)),O=Math.max(z||20,Math.round(fe*1.5))}else n.type==="image"?($=h||200,O=z||150):n.type==="chart"?($=h||240,O=z||160):n.type==="line"?($=h||200,O=z||2):($=h||100,O=z||60);const le=10,x=ee+ie/2,V=ae+de/2;let G=!1,te=Ce+le,he=Math.round(V-O/2);if(!G&&te+$<=C.width&&(s.left=Math.max(0,Math.min(te,Math.max(0,C.width-$))),s.top=Math.max(0,Math.min(he,Math.max(0,C.height-O))),G=!0),te=ee-$-le,he=Math.round(V-O/2),!G&&te>=0&&(s.left=Math.max(0,Math.min(te,Math.max(0,C.width-$))),s.top=Math.max(0,Math.min(he,Math.max(0,C.height-O))),G=!0),te=Math.round(x-$/2),he=f+le,!G&&he+O<=C.height&&(s.left=Math.max(0,Math.min(te,Math.max(0,C.width-$))),s.top=Math.max(0,Math.min(he,Math.max(0,C.height-O))),G=!0),te=Math.round(x-$/2),he=ae-O-le,!G&&he>=0&&(s.left=Math.max(0,Math.min(te,Math.max(0,C.width-$))),s.top=Math.max(0,Math.min(he,Math.max(0,C.height-O))),G=!0),!G){const fe=Number((Me=(Ie=n.left)!=null?Ie:n.x)!=null?Me:0),Ee=Number((ce=(ve=n.top)!=null?ve:n.y)!=null?ce:0),Re=ee+fe+le,Pe=ae+Ee+le;s.left=Math.max(0,Math.min(Math.round(Re),Math.max(0,C.width-$))),s.top=Math.max(0,Math.min(Math.round(Pe),Math.max(0,C.height-O)))}s.x=s.left,s.y=s.top}we(),k.value.push(s),d.value=s.id}const Gt=xe(!1),Vt=xe([]),Pt=xe(""),Ht=xe(!1),lr=Ge(()=>{const n=Pt.value.trim().toLowerCase();return n?Vt.value.filter(l=>l.name.toLowerCase().includes(n)||(l.description||"").toLowerCase().includes(n)||Array.isArray(l.tags)&&l.tags.some(s=>s.toLowerCase().includes(n))):Vt.value});async function or(){try{Ht.value=!0,await Xe.init(),Vt.value=(await Xe.getAllComponents()||[]).sort((n,l)=>(l.updatedAt||0)-(n.updatedAt||0))}catch(n){console.warn("加载组件缓存失败：",n)}finally{Ht.value=!1}}async function zr(){await or(),Gt.value=!0}function sr(){Gt.value=!1}const dt=xe(!1);let lt=null;function Or(){dt.value=!0,lt&&(clearTimeout(lt),lt=null)}function Br(){lt&&clearTimeout(lt),lt=setTimeout(()=>{dt.value=!1,lt=null},120)}function Dr(){dt.value=!0,lt&&(clearTimeout(lt),lt=null)}function Gr(){dt.value=!1,lt&&(clearTimeout(lt),lt=null)}function Lr(n){const l=[],s=[],u=[],g=[];function p(a){var ue,ge,Ie,Me,ve;const E=Number(a.width||0),L=Number(a.height||0);if(E>0&&L>0)return{w:E,h:L};if(a.type==="text"){const ce=Number((ue=a.fontSize)!=null?ue:16),ee=String((ge=a.text)!=null?ge:"").trim(),ae=Math.max(50,Math.round((ee.length||2)*ce*.6)),ie=Math.max(20,Math.round(ce*1.5));return{w:E||ae,h:L||ie}}if(a.type==="image")return{w:E||100,h:L||100};if(a.type==="chart")return{w:E||240,h:L||160};if(a.type==="line"){const ce=Number((Me=(Ie=a.style)==null?void 0:Ie.lineThickness)!=null?Me:2);return(((ve=a.style)==null?void 0:ve.lineOrientation)||"horizontal")==="vertical"?{w:E||ce,h:L||100}:{w:E||100,h:L||ce}}return{w:E||50,h:L||20}}for(const a of n){const E=Number(a.left||a.x||0),L=Number(a.top||a.y||0),{w:ue,h:ge}=p(a);l.push(E),s.push(L),u.push(E+(ue||0)),g.push(L+(ge||0))}const M=l.length?Math.min(...l):0,F=s.length?Math.min(...s):0,N=u.length?Math.max(...u):M,m=g.length?Math.max(...g):F;return{minX:M,minY:F,maxX:N,maxY:m,width:Math.max(0,N-M),height:Math.max(0,m-F)}}async function Ur(n){var l,s,u,g,p,M,F,N,m,a;try{const E=await ir(`component-${n.id}`),L=JSON.parse(JSON.stringify((E==null?void 0:E.elements)||n.elements||[]));if(!L||L.length===0){console.warn("该组件没有可插入的元素");return}const ue=Ct.value,ge=qe.value||1,Ie=(l=ue==null?void 0:ue.clientWidth)!=null?l:0,Me=(s=ue==null?void 0:ue.clientHeight)!=null?s:0,ve=ue?(ue.scrollLeft+Ie/2)/ge:20,ce=ue?(ue.scrollTop+Me/2)/ge:20,ee=Lr(L),ae=ee.minX+ee.width/2,ie=ee.minY+ee.height/2,de=Math.round(ve-ae),Ce=Math.round(ce-ie),f=k.value.reduce((z,$)=>Math.max(z,Number($.zIndex||0)),0);let h=null;if(L.length===1){const z=L[0];if(!z){console.warn("单元素组件插入失败：源元素不存在");return}const $=z,O=JSON.parse(JSON.stringify($));O.id=`${$.type}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;const le=Number((g=(u=O.left)!=null?u:O.x)!=null?g:0),x=Number((M=(p=O.top)!=null?p:O.y)!=null?M:0);O.left=Math.round(le+de),O.top=Math.round(x+Ce),O.x=O.left,O.y=O.top;const{w:V,h:G}=(function(){var fe,Ee,Re,Pe,tt;const te=Number(O.width||0),he=Number(O.height||0);if(te>0&&he>0)return{w:te,h:he};if(O.type==="text"){const _e=Number((fe=O.fontSize)!=null?fe:16),st=String((Ee=O.text)!=null?Ee:"").trim(),Ze=Math.max(50,Math.round((st.length||2)*_e*.6)),ft=Math.max(20,Math.round(_e*1.5));return{w:te||Ze,h:he||ft}}if(O.type==="image")return{w:te||100,h:he||100};if(O.type==="chart")return{w:te||240,h:he||160};if(O.type==="line"){const _e=Number((Pe=(Re=O.style)==null?void 0:Re.lineThickness)!=null?Pe:2);return(((tt=O.style)==null?void 0:tt.lineOrientation)||"horizontal")==="vertical"?{w:te||_e,h:he||100}:{w:te||100,h:he||_e}}return{w:te||50,h:he||20}})();if(O.width=V,O.height=G,O.type==="image"&&!(O.src||"").startsWith("data:")&&O.iconId)try{Lt(O.iconId).then(te=>{te&&(O.src=te)}).catch(()=>{})}catch{}O.zIndex=Math.max(1,f+1),we(),k.value=k.value.concat(O),d.value=O.id,h=O.id}else{const z=`group-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,$=[];for(const le of L){const x=JSON.parse(JSON.stringify(le));x.id=`${le.type}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;const V=Number((N=(F=x.left)!=null?F:x.x)!=null?N:0),G=Number((a=(m=x.top)!=null?m:x.y)!=null?a:0);x.left=Math.round(V-ee.minX),x.top=Math.round(G-ee.minY),x.x=x.left,x.y=x.top;const{w:te,h:he}=(function(){var Re,Pe,tt,_e,st;const fe=Number(x.width||0),Ee=Number(x.height||0);if(fe>0&&Ee>0)return{w:fe,h:Ee};if(x.type==="text"){const Ze=Number((Re=x.fontSize)!=null?Re:16),ft=String((Pe=x.text)!=null?Pe:"").trim(),xt=Math.max(50,Math.round((ft.length||2)*Ze*.6)),Nt=Math.max(20,Math.round(Ze*1.5));return{w:fe||xt,h:Ee||Nt}}if(x.type==="image")return{w:fe||100,h:Ee||100};if(x.type==="chart")return{w:fe||240,h:Ee||160};if(x.type==="line"){const Ze=Number((_e=(tt=x.style)==null?void 0:tt.lineThickness)!=null?_e:2);return(((st=x.style)==null?void 0:st.lineOrientation)||"horizontal")==="vertical"?{w:fe||Ze,h:Ee||100}:{w:fe||100,h:Ee||Ze}}return{w:fe||50,h:Ee||20}})();if(x.width=te,x.height=he,x.type==="image"&&!(x.src||"").startsWith("data:")&&x.iconId)try{Lt(x.iconId).then(fe=>{fe&&(x.src=fe)}).catch(()=>{})}catch{}$.push(x)}const O={id:z,type:"group",left:Math.round(ee.minX+de),top:Math.round(ee.minY+Ce),width:Math.max(1,Math.round(ee.width)),height:Math.max(1,Math.round(ee.height)),zIndex:Math.max(1,f+1),className:n.name?`component-${n.name.replace(/[^A-Za-z0-9_-]/g,"-")}`:void 0,children:$,componentId:n.id,editable:!0,style:{backgroundColor:"transparent"}};we(),k.value=k.value.concat(O),d.value=O.id,h=z}try{if(h){const z=await Xe.getFontsByComponentId(n.id);if(Array.isArray(z)&&z.length>0){let $=document.getElementById(`component-fonts-${h}`);$||($=document.createElement("style"),$.id=`component-fonts-${h}`,document.head.appendChild($));const O=[];for(const le of z){const x=String(le.name||"").replace(/[^A-Za-z0-9_\-]/g,"_"),V=le.bufferBase64;V&&O.push(`@font-face { font-family: '${x}'; src: url('${V}'); font-weight: normal; font-style: normal; font-display: swap; }`)}$.textContent=O.join(`
`)}}}catch(z){console.warn("注入组件字体失败：",z)}try{if(h){const z=await Xe.getDatabaseObjectsByComponentId(n.id);Array.isArray(z)&&z.length>0&&br(h,z.map($=>({name:$.name,content:$.content})))}}catch(z){console.warn("注入组件数据库对象失败：",z)}await Xe.incrementUsageCount(n.id),Gt.value=!1}catch(E){console.warn("插入组件失败：",E)}}const ar=()=>w.value?`lowcode-builder-state-${w.value}`:"lowcode-builder-state-v1",Wt=()=>w.value?o.isComponent?`component-${w.value}`:`project-${w.value}`:"default";async function _t(n,l){try{const s=JSON.parse(JSON.stringify(l));if(n.startsWith("component-")){const u=n.replace(/^component-/,"");await Xe.saveBuilderStateForComponent(u,s)}else if(n.startsWith("project-")){const u=n.replace(/^project-/,"");await Xe.saveBuilderStateForProject(u,s)}else await Xe.saveBuilderStateForProject(n,s)}catch(s){console.warn("保存构建器状态失败：",s)}}async function ir(n){try{if(n.startsWith("component-")){const l=n.replace(/^component-/,"");return await Xe.getBuilderStateForComponent(l)}else if(n.startsWith("project-")){const l=n.replace(/^project-/,"");return await Xe.getBuilderStateForProject(l)}return await Xe.getBuilderStateForProject(n)}catch(l){return console.warn("恢复构建器状态失败：",l),null}}let Jt=null;function qt(){Jt&&clearTimeout(Jt),Jt=setTimeout(()=>{const n={config:C,elements:k.value,exportName:pe.value};try{const l=async()=>{if(await _t(Wt(),n),o.isComponent&&w.value)try{const s=String(w.value),u=await Xe.getComponent(s),g={id:s,name:pe.value||(u==null?void 0:u.name)||"未命名组件",description:(u==null?void 0:u.description)||"",tags:(u==null?void 0:u.tags)||[],elements:k.value,config:C,usageCount:(u==null?void 0:u.usageCount)||0,createdAt:(u==null?void 0:u.createdAt)||Date.now(),updatedAt:Date.now()};await Xe.saveComponent(JSON.parse(JSON.stringify(g))),cr()}catch(s){console.warn("同步保存组件记录失败：",s)}};typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{l()}):l()}catch(l){console.warn("保存失败：",l)}},400)}mt(C,qt,{deep:!0}),mt(k,qt,{deep:!0}),mt(pe,qt),mt(k,()=>{Tt()},{deep:!0});async function Rr(){try{const n="lowcode-icons",l="icons",s=await new Promise((p,M)=>{const F=indexedDB.open(n);F.onsuccess=()=>{const N=F.result;if(N.objectStoreNames.contains(l))p(N);else{const m=N.version+1;N.close();const a=indexedDB.open(n,m);a.onupgradeneeded=()=>{const E=a.result;E.objectStoreNames.contains(l)||E.createObjectStore(l,{keyPath:"id"})},a.onsuccess=()=>p(a.result),a.onerror=()=>M(a.error)}},F.onerror=()=>M(F.error)}),u=await new Promise((p,M)=>{const F=s.transaction(l,"readonly").objectStore(l).getAll();F.onsuccess=()=>p(F.result),F.onerror=()=>M(F.error)}),g=w.value;rr.value=(g?u.filter(p=>p.projectId===g):u.filter(p=>!p.projectId)).map(p=>{const M=new Blob([p.buffer],{type:p.mime}),F=URL.createObjectURL(M);return{id:p.id,url:F,name:p.name}})}catch(n){console.warn("图标库初始化失败：",n)}}async function Lt(n){try{const l="lowcode-icons",s="icons",u=await new Promise((M,F)=>{const N=indexedDB.open(l);N.onsuccess=()=>{const m=N.result;if(m.objectStoreNames.contains(s))M(m);else{const a=m.version+1;m.close();const E=indexedDB.open(l,a);E.onupgradeneeded=()=>{const L=E.result;L.objectStoreNames.contains(s)||L.createObjectStore(s,{keyPath:"id"})},E.onsuccess=()=>M(E.result),E.onerror=()=>F(E.error)}},N.onerror=()=>F(N.error)}),g=await new Promise((M,F)=>{const N=u.transaction(s,"readonly").objectStore(s).get(n);N.onsuccess=()=>M(N.result),N.onerror=()=>F(N.error)});if(!g||!g.buffer)return null;const p=new Blob([g.buffer],{type:g.mime||"application/octet-stream"});return await new Promise((M,F)=>{const N=new FileReader;N.onload=()=>M(String(N.result)),N.onerror=()=>F(N.error),N.readAsDataURL(p)})}catch(l){return console.warn("读取图标数据失败：",l),null}}async function dr(){const n=k.value.filter(l=>l.type==="image");for(const l of n){if((l.src||"").startsWith("data:")||!l.iconId)continue;const s=await Lt(l.iconId);s&&(l.src=s)}}async function Tr(){try{const n="lowcode-fonts",l="fonts",s=await new Promise((g,p)=>{const M=indexedDB.open(n);M.onsuccess=()=>{const F=M.result;if(F.objectStoreNames.contains(l))g(F);else{const N=F.version+1;F.close();const m=indexedDB.open(n,N);m.onupgradeneeded=()=>{const a=m.result;a.objectStoreNames.contains(l)||a.createObjectStore(l,{keyPath:"id"})},m.onsuccess=()=>g(m.result),m.onerror=()=>p(m.error)}},M.onerror=()=>p(M.error)}),u=await new Promise((g,p)=>{const M=s.transaction(l,"readonly").objectStore(l).getAll();M.onsuccess=()=>g(M.result),M.onerror=()=>p(M.error)});if(u.length>0){let g=document.querySelector("style[data-font-lib]");g||(g=document.createElement("style"),g.setAttribute("data-font-lib",""),document.head.appendChild(g));const p=[],M=[],F=w.value,N=F?u.filter(a=>a.projectId===F):u.filter(a=>!a.projectId);for(const a of N){const E=new Blob([a.buffer],{type:a.mime}),L=URL.createObjectURL(E),ue=a.name;M.push(ue),p.push(`@font-face { font-family: '${ue}'; src: url('${L}'); font-weight: normal; font-style: normal; }`)}g.textContent=p.join(`
`);const m=new Set([...P.value,...M]);P.value=Array.from(m)}}catch(n){console.warn("字体库初始化失败：",n)}}Zr(async()=>{await _(),await Tr(),await Rr();try{if(o.isComponent&&w.value){const n=String(w.value);if(!await Xe.getComponent(n)){const l={id:n,name:pe.value||"未命名组件",description:"",tags:[],elements:[],config:C,usageCount:0,createdAt:Date.now(),updatedAt:Date.now()};await Xe.saveComponent(JSON.parse(JSON.stringify(l)))}}}catch(n){console.warn("预创建组件记录失败：",n)}try{const n=await ir(Wt());if(n){n.config&&Object.assign(C,n.config),Array.isArray(n.elements)&&(k.value=n.elements),typeof n.exportName=="string"&&n.exportName&&(pe.value=n.exportName),await dr();try{k.value=k.value.map(l=>{if(l.type==="chart"&&l.style&&typeof l.style.border=="string"&&l.style.border.includes("dashed")){const s={...l,style:{...l.style}};return delete s.style.border,s}return l})}catch{}}else{const l=localStorage.getItem(ar());if(l){const s=JSON.parse(l);s&&s.config&&Object.assign(C,s.config),Array.isArray(s==null?void 0:s.elements)&&(k.value=s.elements),typeof(s==null?void 0:s.exportName)=="string"&&s.exportName&&(pe.value=s.exportName),await dr();try{k.value=k.value.map(u=>{if(u.type==="chart"&&u.style&&typeof u.style.border=="string"&&u.style.border.includes("dashed")){const g={...u,style:{...u.style}};return delete g.style.border,g}return u})}catch{}await _t(Wt(),{config:C,elements:k.value,exportName:pe.value});try{localStorage.removeItem(ar())}catch{}}}}catch(n){console.warn("恢复失败：",n)}Tt(),window.addEventListener("keydown",D),window.addEventListener("keyup",t)}),Qr(()=>{window.removeEventListener("keydown",D),window.removeEventListener("keyup",t),cr()});let ur=0;async function Vr(n,l){var s,u,g;try{const p=C.width||n.clientWidth||800,M=C.height||n.clientHeight||600,F=(s=l==null?void 0:l.maxWidth)!=null?s:420,N=(u=l==null?void 0:l.scale)!=null?u:Math.min(1,F/p),m=(g=l==null?void 0:l.quality)!=null?g:.85,a=n.cloneNode(!0);a.style.transform="none",a.style.transformOrigin="top left",a.style.width=`${p}px`,a.style.height=`${M}px`;const E=new XMLSerializer().serializeToString(a),L=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${Math.round(p*N)}" height="${Math.round(M*N)}">
  <foreignObject width="100%" height="100%">
    <div xmlns="http://www.w3.org/1999/xhtml" style="transform: scale(${N}); transform-origin: top left;">${E}</div>
  </foreignObject>
</svg>`,ue="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(L),ge=new Image;return await new Promise(Ie=>{ge.onload=()=>{try{const Me=document.createElement("canvas");Me.width=ge.width,Me.height=ge.height;const ve=Me.getContext("2d");if(!ve)return Ie(null);ve.drawImage(ge,0,0);const ce=Me.toDataURL("image/jpeg",m);Ie(ce)}catch{Ie(null)}},ge.onerror=()=>Ie(null),ge.src=ue})}catch{return null}}async function cr(){try{const n=Date.now();if(n-ur<5e3||(ur=n,!o.isComponent||!w.value))return;const l=Ct.value;if(!l)return;const s=l.firstElementChild;if(!s)return;const u=await Vr(s,{maxWidth:420,quality:.8});if(!u)return;const g=String(w.value),p=await Xe.getComponent(g);if(!p)return;const M={...p,previewDataUrl:u,updatedAt:Date.now()};await Xe.saveComponent(JSON.parse(JSON.stringify(M)))}catch(n){console.warn("生成缩略图失败：",n)}}return(n,l)=>{var s,u,g,p,M,F,N,m;return A(),j(Ft,null,[r("div",ld,[l[32]||(l[32]=Jr('<div class="absolute inset-0 opacity-10" data-v-c566e658><div class="absolute top-10 left-10 w-32 h-32 border border-cyan-400 rotate-45 animate-pulse" data-v-c566e658></div><div class="absolute top-32 right-20 w-24 h-24 border border-purple-400 rounded-full animate-spin" style="animation-duration:20s;" data-v-c566e658></div><div class="absolute bottom-20 left-1/4 w-40 h-40 border border-blue-400 rotate-12 animate-bounce" style="animation-duration:3s;" data-v-c566e658></div><div class="absolute bottom-32 right-1/3 w-28 h-28 border border-green-400 rounded-lg rotate-45 animate-pulse" style="animation-delay:1s;" data-v-c566e658></div></div><div class="absolute inset-0 opacity-5" style="background-image:linear-gradient(cyan 1px, transparent 1px), linear-gradient(90deg, cyan 1px, transparent 1px);background-size:50px 50px;" data-v-c566e658></div>',2)),r("div",od,[ut(Ao,{exportName:pe.value,config:C,fontLibrary:P.value,spacingEnabled:pt.value,alignmentEnabled:gt.value,"onUpdate:exportName":l[0]||(l[0]=a=>pe.value=a),"onUpdate:configWidth":l[1]||(l[1]=a=>C.width=a),"onUpdate:configHeight":l[2]||(l[2]=a=>C.height=a),"onUpdate:backgroundColor":l[3]||(l[3]=a=>C.backgroundColor=a),"onUpdate:globalFontFamily":l[4]||(l[4]=a=>C.globalFontFamily=a),"onUpdate:globalFontSize":l[5]||(l[5]=a=>C.globalFontSize=a),"onUpdate:globalColor":l[6]||(l[6]=a=>C.globalColor=a),"onUpdate:spacingEnabled":l[7]||(l[7]=a=>pt.value=a),"onUpdate:alignmentEnabled":l[8]||(l[8]=a=>gt.value=a),onBackgroundFileChange:Mr,onOpenPreview:oe,onDownloadByFormat:l[9]||(l[9]=a=>Cr(a)),onDownloadAllFormats:Nr,onResetCanvas:Ir,elements:k.value,selectedId:d.value,onSelectElement:l[10]||(l[10]=a=>nt(a)),onReorderTopElements:l[11]||(l[11]=a=>vt(a.from,a.to))},null,8,["exportName","config","fontLibrary","spacingEnabled","alignmentEnabled","elements","selectedId"]),r("div",sd,[r("div",ad,[r("div",id,[r("div",dd,[r("button",{onMouseenter:Or,onMouseleave:Br,onClick:l[12]||(l[12]=a=>dt.value=!0),class:"px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-cyan-500/25"}," 插入元素 ",32),me(r("div",{onMouseenter:Dr,onMouseleave:Gr,class:"absolute left-0 top-full w-72 p-3 bg-gray-900/95 backdrop-blur-md border border-cyan-500/40 rounded-xl shadow-2xl z-50"},[r("div",ud,[r("button",{onClick:l[13]||(l[13]=a=>{He("text"),dt.value=!1}),class:"px-3 py-2 text-xs bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded"},"文本"),r("button",{onClick:l[14]||(l[14]=a=>{He("image"),dt.value=!1}),class:"px-3 py-2 text-xs bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white rounded"},"图片"),r("button",{onClick:l[15]||(l[15]=a=>{He("chart"),dt.value=!1}),class:"px-3 py-2 text-xs bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white rounded"},"图表"),r("button",{onClick:l[16]||(l[16]=a=>{He("line"),dt.value=!1}),class:"px-3 py-2 text-xs bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded"},"线条"),r("button",{onClick:l[17]||(l[17]=a=>{He("container"),dt.value=!1}),class:"px-3 py-2 text-xs bg-gradient-to-r from-slate-600 to-gray-700 hover:from-slate-500 hover:to-gray-600 text-white rounded col-span-2"},"容器")])],544),[[Nl,dt.value]])]),r("button",{onClick:l[18]||(l[18]=a=>yt.value=!0),class:"px-4 py-2 bg-gradient-to-r from-gray-600 to-slate-700 hover:from-gray-500 hover:to-slate-600 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-gray-500/25"}," 隐藏元素 "),r("button",{onClick:zr,class:"px-4 py-2 bg-gradient-to-r from-pink-600 to-fuchsia-600 hover:from-pink-500 hover:to-fuchsia-500 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-lg shadow-pink-500/25"}," 插入组件 ")]),r("div",cd,[r("button",{onClick:Ar,class:"p-2 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg transition-colors duration-200"},[...l[30]||(l[30]=[r("span",{class:"text-gray-300"},"-",-1)])]),r("span",pd,Qe(Math.round(qe.value*100))+"%",1),r("button",{onClick:Fr,class:"p-2 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg transition-colors duration-200"},[...l[31]||(l[31]=[r("span",{class:"text-gray-300"},"+",-1)])]),r("button",{onClick:tr,class:"px-3 py-2 bg-gray-700/50 hover:bg-gray-600/50 rounded-lg text-xs text-gray-300 transition-colors duration-200"}," 适应 ")])]),r("div",{ref_key:"canvasScrollRef",ref:Ct,class:"flex-1 overflow-auto bg-gray-800/30 p-4 min-h-0 custom-scrollbar"},[r("div",{ref_key:"canvasContentRef",ref:Je,class:"relative border border-gray-600/50 bg-gray-100 shadow-2xl mx-auto",onMousedown:yl(At,["self"]),style:ot({width:`${C.width}px`,height:`${C.height}px`,backgroundColor:C.backgroundColor||"transparent",backgroundImage:C.backgroundUrl?`url(${C.backgroundUrl})`:"none",backgroundSize:"cover",backgroundPosition:"center",transform:`scale(${qe.value})`,transformOrigin:"top left"})},[re.value?(A(),j("div",gd,[Fe.value.left?(A(),j("div",{key:0,class:"absolute top-0 bottom-0 border-l border-dashed border-orange-400/70",style:ot([{"border-width":"0.5px"},{left:`${Z.value.left}px`}])},null,4)):Y("",!0),Fe.value.right?(A(),j("div",{key:1,class:"absolute top-0 bottom-0 border-l border-dashed border-orange-400/70",style:ot([{"border-width":"0.5px"},{left:`${Z.value.right}px`}])},null,4)):Y("",!0),Fe.value.top?(A(),j("div",{key:2,class:"absolute left-0 right-0 border-t border-dashed border-orange-400/70",style:ot([{"border-width":"0.5px"},{top:`${Z.value.top}px`}])},null,4)):Y("",!0),Fe.value.bottom?(A(),j("div",{key:3,class:"absolute left-0 right-0 border-t border-dashed border-orange-400/70",style:ot([{"border-width":"0.5px"},{top:`${Z.value.bottom}px`}])},null,4)):Y("",!0),Fe.value.centerV?(A(),j("div",{key:4,class:"absolute top-0 bottom-0 border-l border-dashed border-blue-400/60",style:ot([{"border-width":"0.5px"},{left:`${Z.value.centerX}px`}])},null,4)):Y("",!0),Fe.value.centerH?(A(),j("div",{key:5,class:"absolute left-0 right-0 border-t border-dashed border-blue-400/60",style:ot([{"border-width":"0.5px"},{top:`${Z.value.centerY}px`}])},null,4)):Y("",!0)])):Y("",!0),pt.value&&(ye.value.left||ye.value.right||ye.value.up||ye.value.down)?(A(),j("div",fd,[ye.value.left&&Se.value!=="left"?(A(),j("div",{key:0,class:"absolute text-[10px] px-1.5 py-0.5 rounded bg-gray-900/80 border border-orange-400/60 text-orange-200 cursor-pointer pointer-events-auto",style:ot({left:`${ye.value.left.x-14}px`,top:`${ye.value.left.y-14}px`}),onDblclick:l[19]||(l[19]=a=>ht("left"))},Qe(ye.value.left.gap)+"px ",37)):Y("",!0),ye.value.right&&Se.value!=="right"?(A(),j("div",{key:1,class:"absolute text-[10px] px-1.5 py-0.5 rounded bg-gray-900/80 border border-orange-400/60 text-orange-200 cursor-pointer pointer-events-auto",style:ot({left:`${ye.value.right.x-14}px`,top:`${ye.value.right.y-14}px`}),onDblclick:l[20]||(l[20]=a=>ht("right"))},Qe(ye.value.right.gap)+"px ",37)):Y("",!0),ye.value.up&&Se.value!=="up"?(A(),j("div",{key:2,class:"absolute text-[10px] px-1.5 py-0.5 rounded bg-gray-900/80 border border-orange-400/60 text-orange-200 cursor-pointer pointer-events-auto",style:ot({left:`${ye.value.up.x-14}px`,top:`${ye.value.up.y-18}px`}),onDblclick:l[21]||(l[21]=a=>ht("up"))},Qe(ye.value.up.gap)+"px ",37)):Y("",!0),ye.value.down&&Se.value!=="down"?(A(),j("div",{key:3,class:"absolute text-[10px] px-1.5 py-0.5 rounded bg-gray-900/80 border border-orange-400/60 text-orange-200 cursor-pointer pointer-events-auto",style:ot({left:`${ye.value.down.x-14}px`,top:`${ye.value.down.y-18}px`}),onDblclick:l[22]||(l[22]=a=>ht("down"))},Qe(ye.value.down.gap)+"px ",37)):Y("",!0),Se.value==="left"?me((A(),j("input",{key:4,type:"number",class:"absolute w-14 h-6 px-1 text-[10px] rounded bg-gray-900/90 border border-orange-400/80 text-orange-100 focus:outline-none pointer-events-auto",style:ot({left:`${(((s=ye.value.left)==null?void 0:s.x)||0)-28}px`,top:`${(((u=ye.value.left)==null?void 0:u.y)||0)-14}px`}),"onUpdate:modelValue":l[23]||(l[23]=a=>Ne.value=a),onKeydown:Hr(wt,["enter"])},null,36)),[[ke,Ne.value,void 0,{number:!0}]]):Y("",!0),Se.value==="right"?me((A(),j("input",{key:5,type:"number",class:"absolute w-14 h-6 px-1 text-[10px] rounded bg-gray-900/90 border border-orange-400/80 text-orange-100 focus:outline-none pointer-events-auto",style:ot({left:`${(((g=ye.value.right)==null?void 0:g.x)||0)-28}px`,top:`${(((p=ye.value.right)==null?void 0:p.y)||0)-14}px`}),"onUpdate:modelValue":l[24]||(l[24]=a=>Ne.value=a),onKeydown:Hr(wt,["enter"])},null,36)),[[ke,Ne.value,void 0,{number:!0}]]):Y("",!0),Se.value==="up"?me((A(),j("input",{key:6,type:"number",class:"absolute w-14 h-6 px-1 text-[10px] rounded bg-gray-900/90 border border-orange-400/80 text-orange-100 focus:outline-none pointer-events-auto",style:ot({left:`${(((M=ye.value.up)==null?void 0:M.x)||0)-28}px`,top:`${(((F=ye.value.up)==null?void 0:F.y)||0)-18}px`}),"onUpdate:modelValue":l[25]||(l[25]=a=>Ne.value=a),onKeydown:Hr(wt,["enter"])},null,36)),[[ke,Ne.value,void 0,{number:!0}]]):Y("",!0),Se.value==="down"?me((A(),j("input",{key:7,type:"number",class:"absolute w-14 h-6 px-1 text-[10px] rounded bg-gray-900/90 border border-orange-400/80 text-orange-100 focus:outline-none pointer-events-auto",style:ot({left:`${(((N=ye.value.down)==null?void 0:N.x)||0)-28}px`,top:`${(((m=ye.value.down)==null?void 0:m.y)||0)-18}px`}),"onUpdate:modelValue":l[26]||(l[26]=a=>Ne.value=a),onKeydown:Hr(wt,["enter"])},null,36)),[[ke,Ne.value,void 0,{number:!0}]]):Y("",!0)])):Y("",!0),(A(!0),j(Ft,null,Ut(k.value,a=>(A(),Xr(Al,{key:a.id,element:a,selected:a.id===d.value,"selected-id":d.value,config:C,zoom:qe.value,dbMap:Ot.value,"metrics-map":H.value,onSelect:nt,"onUpdate:position":Ye,"onUpdate:size":Ke,onShowGuidelines:Le,onHideGuidelines:at,onReportMetrics:rt,onDragEnd:zt},null,8,["element","selected","selected-id","config","zoom","dbMap","metrics-map"]))),128))],36)],512)]),ut(nd,{selectedEl:$t.value,config:C,fontLibrary:P.value,fontSizeLibrary:K.value,fontWeightOptions:se.value,fontStyleOptions:X.value,databaseObjects:U.value,dbMap:Ot.value,iconLibrary:rr.value,defaultChartOption:Ve,safeHex:xr,initCustomClassSkeleton:hr,refreshAllCustomClassCss:Tt,removeCustomClassCssForElement:Kt,getIconDataUrlById:Lt,onDuplicateSelected:jr,onRemoveSelected:vr,onSaveSelectedAsComponent:Er},null,8,["selectedEl","config","fontLibrary","fontSizeLibrary","fontWeightOptions","fontStyleOptions","databaseObjects","dbMap","iconLibrary"])])]),Gt.value?(A(),j("div",md,[r("div",{class:"absolute inset-0 bg-black/60",onClick:sr}),r("div",yd,[r("div",{class:"flex items-center justify-between p-4 border-b border-fuchsia-500/30 bg-gradient-to-r from-fuchsia-600/20 to-pink-600/20"},[l[33]||(l[33]=r("h3",{class:"text-lg font-bold text-pink-300"},"插入组件",-1)),r("button",{onClick:sr,class:"px-3 py-1 bg-gray-700/60 hover:bg-gray-600/60 rounded text-sm text-gray-200"},"关闭")]),r("div",bd,[r("div",xd,[me(r("input",{"onUpdate:modelValue":l[27]||(l[27]=a=>Pt.value=a),type:"text",placeholder:"搜索名称、描述或标签",class:"flex-1 px-3 py-2 bg-gray-800/60 border border-fuchsia-500/30 rounded-lg text-gray-100 placeholder-gray-400 focus:border-fuchsia-400 focus:ring-1 focus:ring-fuchsia-400 focus:outline-none transition-all duration-200"},null,512),[[ke,Pt.value]]),r("button",{onClick:or,class:"px-3 py-2 bg-pink-600/70 hover:bg-pink-600 text-white rounded"},"刷新")]),Ht.value?(A(),j("div",vd,"正在加载组件...")):(A(),j("div",hd,[lr.value.length===0?(A(),j("div",wd,"暂无匹配的组件")):(A(),j("div",$d,[(A(!0),j(Ft,null,Ut(lr.value,a=>(A(),j("div",{key:a.id,class:"bg-gray-800/60 border border-pink-500/20 rounded-lg overflow-hidden"},[r("div",kd,[a.previewDataUrl?(A(),j("img",{key:0,src:a.previewDataUrl,alt:"预览",class:"max-w-full max-h-full object-contain"},null,8,Ed)):(A(),j("div",Sd,"无预览"))]),r("div",Md,[r("div",Cd,[r("div",{class:"text-sm text-gray-100 font-medium truncate",title:a.name},Qe(a.name),9,Nd),r("div",Id,Qe(a.usageCount||0)+" 次",1)]),r("div",Fd,[(A(!0),j(Ft,null,Ut(a.tags||[],E=>(A(),j("span",{key:E,class:"px-1.5 py-0.5 text-[10px] rounded bg-pink-600/30 text-pink-200"},Qe(E),1))),128))]),r("div",Ad,[r("button",{onClick:E=>Ur(a),class:"w-full px-3 py-1.5 bg-gradient-to-r from-pink-600 to-fuchsia-600 hover:from-pink-500 hover:to-fuchsia-500 text-white rounded text-sm transition"}," 插入到画布 ",8,jd)])])]))),128))]))]))])])])):Y("",!0),yt.value?(A(),j("div",zd,[r("div",{class:"absolute inset-0 bg-black/60",onClick:l[28]||(l[28]=a=>yt.value=!1)}),r("div",Od,[r("div",Bd,[l[34]||(l[34]=r("h3",{class:"text-lg font-bold text-cyan-300"},"隐藏元素列表",-1)),r("button",{onClick:l[29]||(l[29]=a=>yt.value=!1),class:"px-3 py-1 bg-gray-700/60 hover:bg-gray-600/60 rounded text-sm text-gray-200"},"关闭")]),r("div",Dd,[St.value.length===0?(A(),j("div",Gd,"暂无隐藏元素")):(A(),j("div",Ld,[(A(!0),j(Ft,null,Ut(St.value,a=>(A(),j("div",{key:a.id,class:"flex items-center justify-between bg-gray-800/60 border border-cyan-500/20 rounded-lg px-3 py-2"},[r("div",{class:"text-sm text-gray-100 truncate",title:a.hiddenLabel||a.className||a.id},Qe(a.hiddenLabel||a.className||a.id),9,Ud),r("button",{onClick:E=>jt(a.id),class:"px-3 py-1 bg-cyan-600/70 hover:bg-cyan-600 text-white rounded text-sm"},"取消隐藏并定位",8,Rd)]))),128))]))])])])):Y("",!0)],64)}}}),Pd=en(Vd,[["__scopeId","data-v-c566e658"]]),Hd=Et({__name:"index",props:{projectId:{},currentProject:{},isComponent:{type:Boolean}},setup(b){const o=b;return(e,c)=>(A(),Xr(Pd,{"project-id":o.projectId,"current-project":o.currentProject,"is-component":o.isComponent},null,8,["project-id","current-project","is-component"]))}}),Zd=Hd;export{Zd as default};
