import{i as R}from"./rolldown-runtime-CKFmjIRy.js";import{E as x,R as _,_ as st,d as M,f as D,l as a,lt as T,m as S,st as at,w as ot}from"./codemirror-B25QCqWr.js";import{n as it,r as nt,s as rt}from"./vendor-vue-C93_ecI2.js";import{t as dt}from"./index-Dz3DFcMx.js";var q=R(nt()),lt=R(it()),ct={class:"dashboard"},ut={key:0,class:"settings-overlay"},vt={class:"settings-panel"},ft={class:"settings-header"},pt={class:"settings-body"},mt={class:"ios-section"},bt={class:"ios-list"},wt={class:"ios-item"},gt={class:"ios-item-meta"},ht={class:"ios-item"},yt=["disabled"],kt={class:"ios-section"},Ct={class:"ios-list"},_t={key:0,class:"busy-tip"},F=1,St=st({__name:"Dashboard",setup(At){const z=rt(),E=()=>{z.push("/projects")},H=()=>{z.push("/components")},A=_(!1),$=_({usage:0}),b=_(!1),I=_(null),k=_({show:!1,msg:"",kind:""});function O(s){const e=["B","KB","MB","GB"];let t=s,o=0;for(;t>=1024&&o<e.length-1;)t/=1024,o++;return`${t.toFixed(t>=1024?1:0)} ${e[o]}`}async function B(){var s,e;try{$.value={usage:(await((e=(s=navigator.storage)==null?void 0:s.estimate)==null?void 0:e.call(s))||{usage:0,quota:0}).usage||0}}catch{$.value={usage:0}}}function Z(s,e){const t=new Uint8Array(s);let o="";const n=32768;for(let i=0;i<t.length;i+=n)o+=String.fromCharCode.apply(null,Array.from(t.subarray(i,i+n)));const d=btoa(o);return e?`data:${e};base64,${d}`:d}function U(s){try{let e=s,t="application/octet-stream";const o=/^data:(.*?);base64,(.*)$/.exec(s);o&&o[1]&&o[2]&&(t=o[1],e=o[2]);const n=atob(e),d=n.length,i=new Uint8Array(d);for(let u=0;u<d;u++)i[u]=n.charCodeAt(u);return{mime:t,buffer:i.buffer}}catch{return{mime:"application/octet-stream",buffer:new ArrayBuffer(0)}}}async function L(s){return await new Promise((e,t)=>{const o=indexedDB.open(s);o.onerror=()=>t(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>e(o.result)})}async function J(s,e){return await new Promise((t,o)=>{const n=s.transaction(e,"readonly").objectStore(e).getAll();n.onsuccess=()=>{const d=(n.result||[]).map(i=>{const u={...i};return i&&i.buffer&&i.buffer.byteLength!==void 0&&(u.bufferBase64=Z(i.buffer,i.mime),delete u.buffer),u});t(d)},n.onerror=()=>o(n.error)})}async function G(){const s=[{db:"vue-tools-components-db",stores:["components"]},{db:"lowcode-projects",stores:["projects"]},{db:"lowcode-builder",stores:["states"]},{db:"lowcode-fonts",stores:["fonts"]},{db:"lowcode-icons",stores:["icons"]},{db:"lowcode-db",stores:["objects"]}],e={meta:{time:Date.now(),origin:location.origin,schemaVersion:F},data:{}};for(const t of s)try{const o=await L(t.db);e.data[t.db]={};for(const n of t.stores)o.objectStoreNames.contains(n)&&(e.data[t.db][n]=await J(o,n));o.close()}catch{}return e}async function K(){b.value=!0;try{const s=await G(),e=new q.default;e.file("backup.json",JSON.stringify(s));const t=await e.generateAsync({type:"blob"}),o=new Date().toISOString().replace(/[-:]/g,"").replace("T","_").slice(0,15);(0,lt.saveAs)(t,`vue-tools_backup_${o}.zip`),P("导出成功","success")}finally{b.value=!1}}function Q(s,e,t,o){var n,d,i,u,w,g,p,c,l,r,v,f,h,m;return s==="vue-tools-components-db"&&e==="components"?(t.name=t.name||"未命名组件",t.createdAt=(n=t.createdAt)!=null?n:Date.now(),t.updatedAt=(d=t.updatedAt)!=null?d:Date.now(),t.elements=(i=t.elements)!=null?i:[],t.config=(u=t.config)!=null?u:{}):s==="lowcode-projects"&&e==="projects"?(t.name=t.name||"未命名项目",t.createdAt=(w=t.createdAt)!=null?w:Date.now(),t.updatedAt=(g=t.updatedAt)!=null?g:Date.now()):s==="lowcode-builder"&&e==="states"?(t.config=(p=t.config)!=null?p:{},t.elements=(c=t.elements)!=null?c:[]):s==="lowcode-fonts"&&e==="fonts"?(t.name=t.name||"font",t.mime=t.mime||"application/octet-stream"):s==="lowcode-icons"&&e==="icons"?(t.name=t.name||"icon",t.mime=t.mime||"application/octet-stream",t.width=(l=t.width)!=null?l:0,t.height=(r=t.height)!=null?r:0,t.size=(v=t.size)!=null?v:0):s==="lowcode-db"&&e==="objects"&&(t.name=t.name||"object",t.createdAt=(f=t.createdAt)!=null?f:Date.now(),t.updatedAt=(h=t.updatedAt)!=null?h:Date.now(),t.content=(m=t.content)!=null?m:{}),t.id=t.id||`${Date.now()}-${Math.random().toString(36).slice(2)}`,t}async function W(s,e,t,o,n){const d=s.transaction(t,"readwrite").objectStore(t),i=await new Promise((c,l)=>{const r=d.getAll();r.onsuccess=()=>c(r.result||[]),r.onerror=()=>l(r.error)}),u=new Set(i.map(c=>c.id)),w={};for(const c of i)c&&typeof c.name=="string"&&c.name&&(w[c.name]=c.id);let g=0,p=0;for(const c of o){const l={...c};if(l.bufferBase64){const f=U(l.bufferBase64);l.buffer=f.buffer,l.mime=f.mime,delete l.bufferBase64}const r=Q(e,t,l,n);let v=r.id;u.has(v)?p++:r.name&&w[r.name]?(v=w[r.name],r.id=v,p++):g++,await new Promise((f,h)=>{const m=d.put(r);m.onsuccess=()=>f(),m.onerror=()=>h(m.error)})}return{added:g,updated:p,total:o.length}}async function X(s){var e,t;b.value=!0;try{const o=(await q.default.loadAsync(s)).file("backup.json");if(!o)return;const n=await o.async("string"),d=JSON.parse(n),i=d.data||{},u=(t=(e=d.meta)==null?void 0:e.schemaVersion)!=null?t:0,w=u<F;let g=0,p=0,c=0;for(const l of Object.keys(i)){let r=await L(l);for(const v of Object.keys(i[l])){r.objectStoreNames.contains(v)||(r.close(),r=await new Promise((h,m)=>{const C=indexedDB.open(l);C.onsuccess=()=>{const et=C.result.version+1;C.result.close();const y=indexedDB.open(l,et);y.onupgradeneeded=()=>{const V=y.result;V.objectStoreNames.contains(v)||V.createObjectStore(v,{keyPath:"id"})},y.onsuccess=()=>h(y.result),y.onerror=()=>m(y.error)},C.onerror=()=>m(C.error)}));const f=await W(r,l,v,i[l][v]||[],u);g+=f.total,p+=f.added,c+=f.updated}r.close()}P(`导入完成：合并 ${g} 条，新增 ${p}，更新 ${c}${w?"（已兼容旧版）":""}`,"success")}finally{b.value=!1,await B()}}function Y(){var s;(s=I.value)==null||s.click()}function N(s){const e=s.target,t=e.files&&e.files[0];t&&X(t),e.value=""}async function j(){b.value=!0;try{for(const s of[{db:"vue-tools-components-db",stores:["components"]},{db:"lowcode-projects",stores:["projects"]},{db:"lowcode-builder",stores:["states"]},{db:"lowcode-fonts",stores:["fonts"]},{db:"lowcode-icons",stores:["icons"]},{db:"lowcode-db",stores:["objects"]}])try{const e=await L(s.db);for(const t of s.stores)if(e.objectStoreNames.contains(t)){const o=e.transaction(t,"readwrite").objectStore(t);try{await new Promise((n,d)=>{const i=o.clear();i.onsuccess=()=>n(),i.onerror=()=>d(i.error)})}catch{}}e.close()}catch{}}finally{b.value=!1,await B()}}function tt(){window.confirm("此操作将删除本地所有缓存数据，且不可恢复。若需保留数据请先导出备份。是否继续？")&&j()}ot(()=>{B()});function P(s,e="success"){k.value={show:!0,msg:s,kind:e},window.setTimeout(()=>{k.value.show=!1},2e3)}return(s,e)=>(x(),D("div",ct,[a("button",{class:"settings-btn",onClick:e[0]||(e[0]=t=>A.value=!0),"aria-label":"settings"},[...e[3]||(e[3]=[a("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{fill:"currentColor",d:"M12 8a4 4 0 100 8 4 4 0 000-8zm9.4 4a7.4 7.4 0 00-.2-1.7l2.2-1.7-2-3.4-2.7 1a7.7 7.7 0 00-2.3-1.3l-.4-2.8H10l-.4 2.8a7.7 7.7 0 00-2.3 1.3l-2.7-1-2 3.4 2.2 1.7c-.1.5-.2 1.1-.2 1.7s.1 1.2.2 1.7L2.6 15l2 3.4 2.7-1a7.7 7.7 0 002.3 1.3l.4 2.8h4.6l.4-2.8a7.7 7.7 0 002.3-1.3l2.7 1 2-3.4-2.2-1.7c.1-.5.2-1.1.2-1.7z"})],-1)])]),A.value?(x(),D("div",ut,[a("div",vt,[a("div",ft,[e[4]||(e[4]=a("div",{class:"settings-title"},"系统设置",-1)),a("button",{class:"close-btn",onClick:e[1]||(e[1]=t=>A.value=!1)},"✕")]),a("div",pt,[a("div",mt,[e[6]||(e[6]=a("div",{class:"ios-title"},"存储",-1)),a("div",bt,[a("div",wt,[e[5]||(e[5]=a("div",{class:"ios-item-label"},"缓存大小",-1)),a("div",gt,T(O($.value.usage)),1)]),a("div",ht,[a("button",{class:"ios-inline-btn",onClick:B,disabled:b.value},"刷新缓存大小",8,yt)])])]),a("div",kt,[e[10]||(e[10]=a("div",{class:"ios-title"},"备份与恢复",-1)),a("div",Ct,[a("div",{class:"ios-item",onClick:K},[...e[7]||(e[7]=[a("div",{class:"ios-item-label"},"导出本地数据（ZIP）",-1),a("div",{class:"ios-item-meta"},"打包备份",-1)])]),a("div",{class:"ios-item",onClick:Y},[e[8]||(e[8]=a("div",{class:"ios-item-label"},"导入数据（ZIP）",-1)),e[9]||(e[9]=a("div",{class:"ios-item-meta"},"恢复缓存",-1)),a("input",{ref_key:"importInput",ref:I,type:"file",accept:".zip",class:"hidden-file",onChange:N},null,544)])])]),a("div",{class:"ios-section"},[e[12]||(e[12]=a("div",{class:"ios-title"},"数据管理",-1)),a("div",{class:"ios-list"},[a("div",{class:"ios-item ios-item-danger",onClick:tt},[...e[11]||(e[11]=[a("div",{class:"ios-item-label"},"清除本地所有数据",-1),a("div",{class:"ios-item-meta"},"不可恢复",-1)])])])]),b.value?(x(),D("div",_t,"处理中...")):M("",!0),k.value.show?(x(),D("div",{key:1,class:at(["toast",k.value.kind==="error"?"toast-error":"toast-success"])},T(k.value.msg),3)):M("",!0)])]),a("div",{class:"settings-mask",onClick:e[2]||(e[2]=t=>A.value=!1)})])):M("",!0),e[17]||(e[17]=S('<div class="background-animation" data-v-689b703d><div class="floating-shapes" data-v-689b703d><div class="shape shape-1" data-v-689b703d></div><div class="shape shape-2" data-v-689b703d></div><div class="shape shape-3" data-v-689b703d></div><div class="shape shape-4" data-v-689b703d></div><div class="shape shape-5" data-v-689b703d></div></div></div>',1)),a("div",{class:"dashboard-content"},[e[15]||(e[15]=S('<div class="header-section" data-v-689b703d><h1 class="main-title" data-v-689b703d><span class="title-gradient" data-v-689b703d>简易大屏定位</span><span class="title-normal" data-v-689b703d>可视化构建</span></h1><p class="subtitle" data-v-689b703d>固定分辨率画布 · 背景图对齐 · 组件导出二次开发</p></div>',1)),a("div",{class:"cards-container"},[a("div",{class:"feature-card project-card",onClick:E},[...e[13]||(e[13]=[S('<div class="card-icon" data-v-689b703d><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-689b703d><path d="M3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7Z" stroke="currentColor" stroke-width="2" data-v-689b703d></path><path d="M8 11L12 15L16 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-689b703d></path></svg></div><h3 class="card-title" data-v-689b703d>项目画布</h3><p class="card-description" data-v-689b703d>进入固定分辨率画布，加载背景图进行元素定位与导出页面代码</p><div class="card-arrow" data-v-689b703d>→</div>',4)])]),a("div",{class:"feature-card component-card",onClick:H},[...e[14]||(e[14]=[S('<div class="card-icon" data-v-689b703d><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-689b703d><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-689b703d></path><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-689b703d></path><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-689b703d></path></svg></div><h3 class="card-title" data-v-689b703d>组件库</h3><p class="card-description" data-v-689b703d>维护复用组件，支持导入/导出，并在画布中快速复用与定位</p><div class="card-arrow" data-v-689b703d>→</div>',4)])])]),e[16]||(e[16]=S('<div class="features" data-v-689b703d><div class="feature-item" data-v-689b703d><div class="fi-title" data-v-689b703d>背景图定位</div><div class="fi-desc" data-v-689b703d>在固定分辨率画布上对齐元素，减少手写 CSS 定位</div></div><div class="feature-item" data-v-689b703d><div class="fi-title" data-v-689b703d>多格式导出</div><div class="fi-desc" data-v-689b703d>导出 Vue2/Vue3/React/HTML，便于二次开发与集成</div></div><div class="feature-item" data-v-689b703d><div class="fi-title" data-v-689b703d>本地备份</div><div class="fi-desc" data-v-689b703d>一键备份与恢复 IndexedDB，保障编辑与迭代安全</div></div></div>',1))])]))}}),Lt=dt(St,[["__scopeId","data-v-689b703d"]]);export{Lt as default};
