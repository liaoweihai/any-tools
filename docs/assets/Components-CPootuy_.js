import{E as n,I as G,O as x,R as v,_ as K,c as A,d as S,f as a,h as k,l as t,lt as d,m as W,o as L,st as E,w as X}from"./codemirror-B25QCqWr.js";import{f as Y,h as M,s as ee}from"./vendor-vue-C93_ecI2.js";import{n as u,t as te}from"./index-Dltv_GnR.js";import{t as C}from"./componentStorage-DB4dbTb9.js";var oe={class:"components-manager"},re={class:"header"},se={class:"header-actions"},ne=["disabled"],ae={class:"filters"},le={class:"search-box"},ie={class:"filter-tags"},de=["onClick"],ue={key:0,class:"components-grid"},ce=["onClick"],pe={class:"selection-checkbox"},ve=["checked","onChange"],ke={class:"component-preview"},he=["src"],we={key:1,class:"preview-placeholder"},Ce={class:"component-info"},fe={class:"component-name"},ge={class:"component-description"},me={key:0,class:"component-tags"},_e={class:"component-stats"},ye={class:"stat-item"},be={class:"stat-value"},xe={class:"stat-item"},Le={class:"stat-value"},Me={class:"stat-item"},je={class:"stat-value"},Ve={class:"component-actions"},Be=["onClick"],$e=["onClick"],De={key:1,class:"empty-state"},He={key:0,class:"empty-actions"},Ae=K({__name:"index",setup(Se){const g=ee(),m=v(),_=v([]),c=v(""),p=v([]),l=v([]),f=v(!1),O=A(()=>{const r=new Set;return _.value.forEach(e=>{var o;(o=e.tags)==null||o.forEach(s=>r.add(s))}),Array.from(r).sort()}),j=A(()=>{let r=_.value;if(c.value){const e=c.value.toLowerCase();r=r.filter(o=>{var s,i;return o.name.toLowerCase().includes(e)||((s=o.description)==null?void 0:s.toLowerCase().includes(e))||((i=o.tags)==null?void 0:i.some(h=>h.toLowerCase().includes(e)))})}return p.value.length>0&&(r=r.filter(e=>p.value.every(o=>{var s;return(s=e.tags)==null?void 0:s.includes(o)}))),r.sort((e,o)=>o.updatedAt-e.updatedAt)}),T=()=>{g.push("/low-code")},y=async()=>{try{f.value=!0,_.value=await C.getAllComponents()}catch(r){console.error("加载组件失败:",r),u("加载组件失败，请刷新页面重试","error")}finally{f.value=!1}},V=async()=>{const r="component_"+Date.now();try{const e={id:r,name:"未命名组件",description:"",tags:[],elements:[],config:{},usageCount:0,createdAt:Date.now(),updatedAt:Date.now()};await C.saveComponent(e)}catch(e){console.warn("预创建组件失败:",e)}g.push({path:`/project/${r}/builder`,query:{type:"component"}})},N=r=>{g.push({path:`/project/${r.id}/builder`,query:{type:"component"}})},R=async r=>{if(confirm(`确定要删除组件"${r.name}"吗？此操作不可恢复。`))try{await C.deleteComponent(r.id),await y();const e=l.value.indexOf(r.id);e>-1&&l.value.splice(e,1),u("组件删除成功","success")}catch(e){console.error("删除组件失败:",e),u("删除组件失败，请重试","error")}},U=r=>{B(r)},B=r=>{const e=l.value.indexOf(r);e>-1?l.value.splice(e,1):l.value.push(r)},I=r=>{const e=p.value.indexOf(r);e>-1?p.value.splice(e,1):p.value.push(r)},Z=async()=>{if(l.value.length!==0)try{const r=await C.exportComponents(l.value),e=JSON.stringify(r,null,2),o=new Blob([e],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=`components-${Date.now()}.json`,s.click(),URL.revokeObjectURL(s.href),l.value=[],u("组件导出成功","success")}catch(r){console.error("导出组件失败:",r),u("导出组件失败，请重试","error")}},$=()=>{var r;(r=m.value)==null||r.click()},q=async r=>{const e=r.target.files;if(e)try{f.value=!0;let o=0;const s=[];for(const i of Array.from(e)){const h=new FileReader;await new Promise((z,b)=>{h.onload=async J=>{var D;try{const w=(D=J.target)==null?void 0:D.result;if(!w||typeof w!="string"){b(new Error("文件读取失败"));return}const H=JSON.parse(w);if(Array.isArray(H)){const{success:P,errors:Q}=await C.importComponents(H);o+=P,s.push(...Q)}else s.push(`文件 "${i.name}" 格式不正确`);z()}catch(w){b(w)}},h.onerror=()=>b(new Error("文件读取失败")),h.readAsText(i)})}await y(),s.length>0?(console.error("导入错误:",s),u(`导入完成：成功 ${o} 个，失败 ${s.length} 个`,"warning")):u(`成功导入 ${o} 个组件`,"success")}catch(o){console.error("导入组件失败:",o),u("导入失败，请检查文件格式","error")}finally{f.value=!1;const o=m.value;o&&(o.value="")}},F=r=>{const e=new Date(r),o=new Date().getTime()-e.getTime();return o<6e4?"刚刚":o<36e5?`${Math.floor(o/6e4)}分钟前`:o<864e5?`${Math.floor(o/36e5)}小时前`:o<6048e5?`${Math.floor(o/864e5)}天前`:e.toLocaleDateString("zh-CN")};return X(()=>{y()}),(r,e)=>(n(),a("div",oe,[t("div",re,[t("div",{class:"header-left"},[t("button",{class:"back-btn",onClick:T},[...e[2]||(e[2]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),k(" 返回 ",-1)])]),e[3]||(e[3]=t("h1",{class:"page-title"},"组件管理",-1))]),t("div",se,[t("button",{class:"action-btn import-btn",onClick:$},[...e[4]||(e[4]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M7 10L12 15L17 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M12 15V3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),k(" 导入组件 ",-1)])]),t("button",{class:"action-btn export-btn",onClick:Z,disabled:l.value.length===0},[e[5]||(e[5]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M12 3V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),k(" 导出组件 ("+d(l.value.length)+") ",1)],8,ne),t("button",{class:"action-btn create-btn",onClick:V},[...e[6]||(e[6]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),k(" 新建组件 ",-1)])])])]),t("div",ae,[t("div",le,[e[7]||(e[7]=t("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M21 21L16.65 16.65",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),type:"text",placeholder:"搜索组件名称、描述或标签...",class:"search-input"},null,512),[[Y,c.value]])]),t("div",ie,[(n(!0),a(L,null,x(O.value,o=>(n(),a("button",{key:o,class:E(["tag-filter",{active:p.value.includes(o)}]),onClick:s=>I(o)},d(o),11,de))),128))])]),j.value.length>0?(n(),a("div",ue,[(n(!0),a(L,null,x(j.value,o=>{var s;return n(),a("div",{key:o.id,class:E(["component-card",{selected:l.value.includes(o.id)}]),onClick:i=>U(o.id)},[t("div",pe,[t("input",{type:"checkbox",checked:l.value.includes(o.id),onChange:i=>B(o.id),onClick:e[1]||(e[1]=M(()=>{},["stop"]))},null,40,ve)]),t("div",ke,[o.previewDataUrl?(n(),a("img",{key:0,src:o.previewDataUrl,alt:"组件缩略图",class:"preview-image"},null,8,he)):(n(),a("div",we,[...e[8]||(e[8]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",stroke:"currentColor","stroke-width":"2","stroke-linejoin":"round"}),t("path",{d:"M2 17L12 22L22 17",stroke:"currentColor","stroke-width":"2","stroke-linejoin":"round"}),t("path",{d:"M2 12L12 17L22 12",stroke:"currentColor","stroke-width":"2","stroke-linejoin":"round"})],-1)])]))]),t("div",Ce,[t("h3",fe,d(o.name),1),t("p",ge,d(o.description||"暂无描述"),1),o.tags&&o.tags.length>0?(n(),a("div",me,[(n(!0),a(L,null,x(o.tags,i=>(n(),a("span",{key:i,class:"tag"},d(i),1))),128))])):S("",!0),t("div",_e,[t("div",ye,[e[9]||(e[9]=t("span",{class:"stat-label"},"元素",-1)),t("span",be,d(((s=o.elements)==null?void 0:s.length)||0),1)]),t("div",xe,[e[10]||(e[10]=t("span",{class:"stat-label"},"使用次数",-1)),t("span",Le,d(o.usageCount||0),1)]),t("div",Me,[e[11]||(e[11]=t("span",{class:"stat-label"},"更新时间",-1)),t("span",je,d(F(o.updatedAt)),1)])])]),t("div",Ve,[t("button",{class:"action-btn-small edit-btn",onClick:M(i=>N(o),["stop"]),title:"编辑"},[...e[12]||(e[12]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M18.5 2.50023C18.8978 2.1024 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.1024 21.5 2.50023C21.8978 2.89805 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.1024 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Be),t("button",{class:"action-btn-small delete-btn",onClick:M(i=>R(o),["stop"]),title:"删除"},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3 6H5H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,$e)])],10,ce)}),128))])):(n(),a("div",De,[e[16]||(e[16]=W('<div class="empty-icon" data-v-447b05f1><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-447b05f1><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-447b05f1></path><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-447b05f1></path><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-447b05f1></path></svg></div>',1)),t("h3",null,d(c.value?"没有找到匹配的组件":"暂无组件"),1),t("p",null,d(c.value?"请调整搜索条件后再试":"创建或导入组件以开始构建"),1),c.value?S("",!0):(n(),a("div",He,[t("button",{class:"create-btn-large",onClick:V},[...e[14]||(e[14]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),k(" 创建组件 ",-1)])]),t("button",{class:"import-btn-large",onClick:$},[...e[15]||(e[15]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M7 10L12 15L17 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M12 15V3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),k(" 导入组件 ",-1)])])]))])),t("input",{ref_key:"fileInput",ref:m,type:"file",accept:".json",multiple:"",style:{display:"none"},onChange:q},null,544)]))}}),Re=te(Ae,[["__scopeId","data-v-447b05f1"]]);export{Re as default};
